<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UMM FinOps Dashboard v3 - University of Michigan Medicine</title>
    <meta name="description" content="FinOps Cloud Cost Management Dashboard for University of Michigan Medicine Research Computing">
    <meta name="data-source" content="ServiceNow + Azure Cost Management">
    <meta name="last-verified" content="2026-01-13">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"
            crossorigin="anonymous"
            onerror="handleChartJSLoadError()"></script>
    <script>
        function handleChartJSLoadError() {
            console.error('[SECURITY] Chart.js failed to load from CDN');
            document.getElementById('chart-error').style.display = 'block';
            document.querySelectorAll('.chart-container').forEach(c => {
                c.innerHTML = '<div style="padding:40px;text-align:center;color:#666;">Chart unavailable</div>';
            });
        }
        window.addEventListener('load', function() {
            if (typeof Chart === 'undefined') handleChartJSLoadError();
        });
    </script>
    <style>
        :root {
            --umm-blue: #00274C;
            --umm-maize: #FFCB05;
            --umm-blue-light: #2F65A7;
            --umm-teal: #00B2A9;
            --umm-red: #9A3324;
            --umm-tan: #CFC096;
            --umm-sage: #75988D;
            --bg-light: #F5F7FA;
            --border-color: #E1E5EB;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-light);
            color: var(--umm-blue);
        }

        .header {
            background: linear-gradient(135deg, var(--umm-blue) 0%, #003366 100%);
            color: white;
            padding: 16px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .header-left { display: flex; align-items: center; gap: 16px; }

        .logo-placeholder {
            width: 50px; height: 50px;
            background: var(--umm-maize);
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; color: var(--umm-blue);
            font-size: 11px; text-align: center; line-height: 1.2;
        }

        .header-title h1 { font-size: 20px; font-weight: 600; }
        .header-title p { font-size: 12px; opacity: 0.85; }

        .header-right { display: flex; align-items: center; gap: 24px; }
        .header-info { font-size: 13px; text-align: right; }

        .persona-selector {
            display: flex; align-items: center; gap: 16px;
            background: var(--umm-maize);
            padding: 16px 28px; border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.25);
            margin-left: 40px;
        }
        .persona-selector label {
            font-size: 18px;
            font-weight: 800;
            text-transform: uppercase;
            color: var(--umm-blue);
            letter-spacing: 1px;
        }
        .persona-selector select {
            padding: 14px 24px;
            border: 3px solid var(--umm-blue);
            border-radius: 8px;
            font-size: 20px;
            font-weight: 700;
            background: white;
            color: var(--umm-blue);
            cursor: pointer;
            min-width: 320px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2300274C' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 20px;
            padding-right: 45px;
        }
        .persona-selector select:focus {
            outline: none;
            box-shadow: 0 0 0 4px rgba(0,39,76,0.3);
        }
        .persona-selector select option {
            font-size: 18px;
            padding: 16px 20px;
            font-weight: 600;
            background: white;
            color: var(--umm-blue);
            line-height: 2;
        }
        .persona-selector select option:hover,
        .persona-selector select option:checked {
            background: var(--umm-maize);
            color: var(--umm-blue);
        }

        /* Global Filter Bar */
        .global-filter-bar {
            background: var(--umm-blue);
            padding: 12px 32px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
            border-bottom: 3px solid var(--umm-maize);
        }

        .global-filter-bar .filter-group {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .global-filter-bar .filter-group label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            color: rgba(255,255,255,0.7);
        }

        .global-filter-bar .filter-group select {
            padding: 6px 10px;
            border: 1px solid rgba(255,255,255,0.3);
            border-radius: 4px;
            font-size: 12px;
            min-width: 160px;
            background: rgba(255,255,255,0.95);
            color: var(--umm-blue);
        }

        .global-filter-bar .filter-reset {
            padding: 6px 14px;
            background: var(--umm-maize);
            color: var(--umm-blue);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            font-weight: 600;
            margin-top: 14px;
        }

        .global-filter-bar .filter-reset:hover {
            background: #e6b800;
        }

        .active-filters-display {
            background: rgba(255,203,5,0.15);
            padding: 8px 32px;
            font-size: 12px;
            color: var(--umm-blue);
            display: none;
        }

        .active-filters-display.visible {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-tag {
            background: var(--umm-maize);
            color: var(--umm-blue);
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .filter-tag .remove {
            cursor: pointer;
            font-weight: bold;
        }

        .nav-tabs {
            background: white;
            padding: 0 32px;
            display: flex;
            gap: 0;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-tab {
            padding: 14px 24px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 14px;
            font-weight: 500;
            color: var(--umm-blue);
            opacity: 0.7;
            transition: all 0.2s;
            border-bottom: 3px solid transparent;
            margin-bottom: -1px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab:hover { opacity: 1; background: rgba(0, 39, 76, 0.05); }

        .nav-tab.active {
            opacity: 1;
            border-bottom-color: var(--umm-blue);
            background: rgba(255, 203, 5, 0.1);
        }

        .nav-tab .audience-hint {
            font-size: 10px; padding: 2px 6px; border-radius: 3px;
            background: var(--bg-light); color: #666; font-weight: normal;
        }

        .nav-tab.active .audience-hint {
            background: var(--umm-maize); color: var(--umm-blue);
        }

        .main-content { padding: 24px 32px; max-width: 1600px; margin: 0 auto; }

        .page { display: none; }
        .page.active { display: block; }

        .page-header {
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .page-header-left h2 { font-size: 24px; color: var(--umm-blue); margin-bottom: 4px; }
        .page-header-left p { color: #666; font-size: 14px; }

        .audience-badge {
            display: inline-flex; align-items: center; gap: 6px;
            padding: 8px 14px; border-radius: 20px;
            font-size: 12px; font-weight: 500;
        }

        .audience-badge.leadership { background: #E3F2FD; color: #1565C0; border: 1px solid #90CAF9; }
        .audience-badge.pi { background: #E8F5E9; color: #2E7D32; border: 1px solid #A5D6A7; }
        .audience-badge.ops { background: #FFF3E0; color: #E65100; border: 1px solid #FFCC80; }
        .audience-badge.governance { background: #F3E5F5; color: #7B1FA2; border: 1px solid #CE93D8; }

        .pi-context-banner {
            background: linear-gradient(135deg, #E8F5E9 0%, #C8E6C9 100%);
            border: 1px solid #A5D6A7;
            border-radius: 8px;
            padding: 16px 20px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pi-context-info { display: flex; align-items: center; gap: 16px; }

        .pi-avatar {
            width: 48px; height: 48px; border-radius: 50%;
            background: var(--umm-blue); color: white;
            display: flex; align-items: center; justify-content: center;
            font-weight: 600; font-size: 18px;
        }

        .pi-details h3 { font-size: 16px; color: var(--umm-blue); }
        .pi-details p { font-size: 13px; color: #666; }

        .pi-context-note {
            font-size: 12px; color: #666; font-style: italic;
            max-width: 300px; text-align: right;
        }

        .kpi-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .kpi-card {
            background: white;
            padding: 20px 24px;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border-left: 4px solid var(--umm-maize);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .kpi-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.12); }
        .kpi-card.alert { border-left-color: var(--umm-red); }
        .kpi-card.success { border-left-color: var(--umm-teal); }
        .kpi-card.info { border-left-color: var(--umm-blue-light); }
        .kpi-card.critical { border-left-color: #C62828; background: #FFEBEE; }

        .kpi-label { font-size: 12px; color: #666; text-transform: uppercase; font-weight: 600; margin-bottom: 8px; }
        .kpi-value { font-size: 28px; font-weight: 700; color: var(--umm-blue); }
        .kpi-subtext { font-size: 12px; color: #888; margin-top: 4px; }

        .kpi-trend {
            display: inline-flex; align-items: center;
            font-size: 12px; margin-top: 6px;
            padding: 2px 8px; border-radius: 12px;
        }
        .kpi-trend.up { background: #FFEBEE; color: var(--umm-red); }
        .kpi-trend.down { background: #E8F5E9; color: #2E7D32; }

        .card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            margin-bottom: 24px;
        }

        .card-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border-color);
            font-weight: 600;
            color: var(--umm-blue);
            font-size: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header .badge {
            background: var(--umm-maize);
            color: var(--umm-blue);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .card-body { padding: 20px; }

        .data-table { width: 100%; border-collapse: collapse; font-size: 13px; }

        .data-table th {
            text-align: left;
            padding: 12px 16px;
            background: var(--bg-light);
            font-weight: 600;
            color: var(--umm-blue);
            border-bottom: 2px solid var(--umm-maize);
            font-size: 11px;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .data-table td { padding: 12px 16px; border-bottom: 1px solid var(--border-color); }
        .data-table tr:hover { background: rgba(255, 203, 5, 0.05); }
        .data-table .text-right { text-align: right; }

        .status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-active { background: #E8F5E9; color: #2E7D32; }
        .status-completed { background: #E3F2FD; color: #1565C0; }
        .status-expiring { background: #FFF3E0; color: #E65100; }
        .status-expired { background: #FFEBEE; color: #C62828; }
        .status-open { background: #FFEBEE; color: #C62828; }
        .status-closed { background: #E8F5E9; color: #2E7D32; }
        .status-pending { background: #FFF3E0; color: #E65100; }

        .budget-status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .budget-overspend { background: #C62828; color: white; }
        .budget-atrisk { background: #E65100; color: white; }
        .budget-ontrack { background: #2E7D32; color: white; }
        .budget-underutilized { background: #1565C0; color: white; }

        .severity-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .severity-critical { background: #C62828; color: white; }
        .severity-high { background: #E65100; color: white; }
        .severity-medium { background: #F9A825; color: #333; }
        .severity-low { background: #9E9E9E; color: white; }

        .issue-type-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .issue-security { background: #C62828; color: white; }
        .issue-cost { background: #1565C0; color: white; }
        .issue-hygiene { background: #6A1B9A; color: white; }

        .env-type-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .env-ave { background: var(--umm-blue); color: white; }
        .env-standard { background: var(--umm-blue-light); color: white; }

        .servicenow-ticket {
            display: inline-block;
            padding: 4px 10px;
            background: #E3F2FD;
            color: #1565C0;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            font-family: 'Consolas', 'Monaco', monospace;
            border: 1px solid #90CAF9;
        }

        .grant-name {
            display: inline-block;
            padding: 4px 10px;
            background: #FFF3E0;
            color: #E65100;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            border: 1px solid #FFCC80;
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .irb-number {
            display: inline-block;
            padding: 4px 10px;
            background: #F3E5F5;
            color: #7B1FA2;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            font-family: 'Consolas', 'Monaco', monospace;
            border: 1px solid #CE93D8;
        }

        .irb-status-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }

        .irb-approved { background: #E8F5E9; color: #2E7D32; border: 1px solid #A5D6A7; }
        .irb-pending { background: #FFF8E1; color: #F57F17; border: 1px solid #FFE082; }
        .irb-under-review { background: #E3F2FD; color: #1565C0; border: 1px solid #90CAF9; }
        .irb-exempt { background: #ECEFF1; color: #546E7A; border: 1px solid #B0BEC5; }
        .irb-closed { background: #FAFAFA; color: #757575; border: 1px solid #E0E0E0; }

        .progress-bar {
            height: 8px;
            background: #E1E5EB;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 4px;
        }

        .progress-fill { height: 100%; border-radius: 4px; transition: width 0.3s; }
        .progress-fill.good { background: var(--umm-teal); }
        .progress-fill.warning { background: #FF9800; }
        .progress-fill.danger { background: var(--umm-red); }

        .grid-2 { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; }
        .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; }

        @media (max-width: 1200px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
        }

        .chart-container { position: relative; height: 300px; }
        .chart-container.tall { height: 350px; }

        .matrix-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .matrix-table th, .matrix-table td {
            padding: 10px 14px;
            text-align: right;
            border: 1px solid var(--border-color);
        }
        .matrix-table th { background: var(--umm-blue); color: white; font-weight: 600; }
        .matrix-table th:first-child, .matrix-table td:first-child { text-align: left; }
        .matrix-table .row-header { background: var(--bg-light); font-weight: 600; }
        .matrix-table .subtotal { background: rgba(255, 203, 5, 0.15); font-weight: 600; }

        .variance-positive { color: var(--umm-teal); }
        .variance-negative { color: var(--umm-red); }

        .expandable-row { cursor: pointer; }
        .expandable-row:hover { background: rgba(0, 39, 76, 0.05); }
        .expand-icon { display: inline-block; width: 16px; transition: transform 0.2s; }
        .expand-icon.expanded { transform: rotate(90deg); }
        .child-row { display: none; }
        .child-row.visible { display: table-row; }

        .config-notice {
            background: #F3E5F5;
            border: 1px solid #CE93D8;
            border-radius: 8px;
            padding: 12px 16px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #7B1FA2;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-switch { display: flex; align-items: center; gap: 8px; font-size: 13px; }
        .toggle-switch input[type="checkbox"] {
            width: 40px; height: 20px;
            appearance: none;
            background: #ccc;
            border-radius: 10px;
            position: relative;
            cursor: pointer;
            transition: background 0.2s;
        }
        .toggle-switch input[type="checkbox"]:checked { background: var(--umm-teal); }
        .toggle-switch input[type="checkbox"]::before {
            content: '';
            position: absolute;
            width: 16px; height: 16px;
            background: white;
            border-radius: 50%;
            top: 2px; left: 2px;
            transition: left 0.2s;
        }
        .toggle-switch input[type="checkbox"]:checked::before { left: 22px; }

        .footer {
            text-align: center;
            padding: 20px;
            color: #888;
            font-size: 12px;
            border-top: 1px solid var(--border-color);
            margin-top: 40px;
        }

        .table-scroll { max-height: 400px; overflow-y: auto; }

        .traceability-bar {
            background: #E8F5E9;
            border-bottom: 1px solid #C8E6C9;
            padding: 8px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #2E7D32;
        }

        .trace-item { display: flex; align-items: center; gap: 6px; }
        .trace-icon {
            width: 16px; height: 16px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px;
        }
        .trace-icon.verified { background: #2E7D32; color: white; }
        .trace-icon.synced { background: #1565C0; color: white; }
        .trace-icon.approved { background: #6A1B9A; color: white; }

        .data-freshness {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 2px 8px; background: white;
            border-radius: 4px; font-weight: 500;
        }

        .freshness-dot {
            width: 8px; height: 8px; border-radius: 50%;
            background: #4CAF50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        .loading-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.9);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        .loading-spinner {
            width: 48px; height: 48px;
            border: 4px solid var(--umm-maize);
            border-top-color: var(--umm-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }
        .loading-text { margin-top: 16px; color: var(--umm-blue); font-weight: 500; }

        #chart-error {
            display: none;
            background: #FFF3E0;
            border: 1px solid #FFB74D;
            padding: 16px; margin: 16px;
            border-radius: 8px;
            color: #E65100;
            text-align: center;
        }

        .triage-summary {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .triage-card {
            background: white;
            border-radius: 8px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            border-top: 4px solid;
        }

        .triage-card.critical { border-color: #C62828; }
        .triage-card.high { border-color: #E65100; }
        .triage-card.medium { border-color: #F9A825; }
        .triage-card.low { border-color: #9E9E9E; }

        .triage-count { font-size: 36px; font-weight: 700; color: var(--umm-blue); }
        .triage-label { font-size: 12px; color: #666; text-transform: uppercase; font-weight: 600; }

        @media print {
            .nav-tabs, .global-filter-bar, .traceability-bar, .persona-selector { display: none; }
            .page { display: block !important; page-break-after: always; }
        }

        /* ============================================ */
        /* RESEARCH GRANTS CONTEXT STYLES               */
        /* ============================================ */
        .demo-banner {
            background: linear-gradient(135deg, #E8EEF5 0%, #D6E3F4 100%);
            border: 1px solid #A8C4E0;
            border-left: 4px solid var(--umm-maize);
            border-radius: 8px;
            padding: 12px 20px;
            margin-bottom: 20px;
            font-size: 13px;
            color: var(--umm-blue);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .offline-toggle {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 16px;
            padding: 10px 16px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .offline-toggle label { font-weight: 600; color: var(--umm-blue); font-size: 13px; }

        .institution-checkboxes-wrapper {
            margin-bottom: 20px;
            padding: 12px 16px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        .institution-checkboxes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .institution-checkboxes-header span {
            font-weight: 600;
            font-size: 13px;
            color: var(--umm-blue);
        }
        .institution-toggle-link {
            font-size: 12px;
            color: var(--umm-blue-light);
            cursor: pointer;
            text-decoration: underline;
            border: none;
            background: none;
            font-weight: 500;
        }
        .institution-toggle-link:hover { color: var(--umm-blue); }

        .institution-checkboxes {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
        }

        .institution-checkboxes label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--umm-blue);
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 4px;
            transition: background 0.15s;
        }
        .institution-checkboxes label:hover { background: rgba(255,203,5,0.15); }
        .institution-checkboxes label.umm-highlight {
            background: rgba(255,203,5,0.12);
            border: 1px solid rgba(255,203,5,0.5);
            font-weight: 600;
        }
        .institution-checkboxes input[type="checkbox"] { accent-color: var(--umm-blue); }

        .grants-filter-bar {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: flex-end;
            margin-bottom: 20px;
            padding: 12px 16px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }

        .grants-filter-bar .filter-group {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .grants-filter-bar .filter-group label {
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            color: #666;
        }

        .grants-filter-bar .filter-group input,
        .grants-filter-bar .filter-group select {
            padding: 6px 10px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 12px;
            min-width: 130px;
            color: var(--umm-blue);
        }

        .sub-tab {
            display: inline-flex;
            padding: 14px 28px;
            cursor: pointer;
            border: none;
            background: transparent;
            font-size: 13px;
            font-weight: 500;
            color: var(--umm-blue);
            opacity: 0.7;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        .sub-tab:hover { opacity: 1; background: rgba(0,39,76,0.05); }
        .sub-tab.active { opacity: 1; border-bottom-color: var(--umm-blue); background: rgba(0,39,76,0.06); color: var(--umm-blue); font-weight: 600; }

        .sub-tab-bar {
            display: flex;
            gap: 0;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .sub-tab-content { display: none; }
        .sub-tab-content.active { display: block; }

        .confidence-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
        }
        .confidence-high { background: #E8F5E9; color: #2E7D32; }
        .confidence-medium { background: #FFF3E0; color: #E65100; }
        .confidence-low { background: #FFEBEE; color: #C62828; }

        .grants-progress {
            padding: 12px 20px;
            background: #E3F2FD;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 13px;
            color: #1565C0;
            display: none;
        }

        .export-btn {
            padding: 8px 18px;
            background: var(--umm-maize);
            color: var(--umm-blue);
            border: 2px solid var(--umm-blue);
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 700;
            transition: all 0.2s;
        }
        .export-btn:hover { background: var(--umm-blue); color: white; }

        /* Table alternating row stripes */
        .data-table tbody tr:nth-child(even) { background: rgba(0,39,76,0.02); }
        .data-table tbody tr:nth-child(even):hover { background: rgba(255,203,5,0.05); }

        /* Grants KPI maize accent */
        #grants-kpi-row .kpi-card { border-top: 3px solid var(--umm-maize); }

        /* Grants section footer branding */
        .grants-footer-branding {
            text-align: center;
            padding: 16px 20px;
            margin-top: 24px;
            font-size: 11px;
            color: #999;
            border-top: 1px solid var(--border-color);
        }
        .grants-footer-branding strong { color: var(--umm-blue); }

        @media (max-width: 1200px) {
            .institution-checkboxes { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 768px) {
            .institution-checkboxes { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Loading dashboard data...</div>
    </div>

    <div id="chart-error">Charts could not load. Please check your internet connection.</div>

    <header class="header">
        <div class="header-left">
            <div class="logo-placeholder">Michigan<br>Medicine</div>
            <div class="header-title">
                <h1>FinOps Cloud Cost Management</h1>
                <p>University of Michigan Medicine - Research Computing</p>
            </div>
            <div class="persona-selector">
                <label>VIEW AS:</label>
                <select id="persona-select" onchange="switchPersona()">
                    <option value="finance">Finance & Research Operations</option>
                    <option value="pi">Principal Investigator (PI)</option>
                    <option value="cloudops">Cloud Operations / FinOps</option>
                    <option value="governance">Governance (Dept. Admin)</option>
                    <option value="grants" selected>Grant Administrator</option>
                </select>
            </div>
        </div>
        <div class="header-right">
            <div class="header-info">
                <div>Report Generated: <span id="currentDate"></span></div>
                <div>Data Source: Azure Cost Management + ServiceNow</div>
            </div>
        </div>
    </header>

    <div class="traceability-bar">
        <div class="trace-item">
            <span class="trace-icon verified"><span class="material-icons" style="font-size:14px;">verified</span></span>
            <span><strong>Data Sources:</strong> ServiceNow CMDB + Azure Cost Management + NIH RePORTER API + USAspending API</span>
        </div>
        <div class="trace-item">
            <span class="trace-icon synced"><span class="material-icons" style="font-size:14px;">sync</span></span>
            <span><strong>Last Sync:</strong> <span id="lastSyncTime">--</span></span>
            <span class="data-freshness"><span class="freshness-dot"></span> Live</span>
        </div>
        <div class="trace-item">
            <span class="trace-icon approved"><span class="material-icons" style="font-size:14px;">check_circle</span></span>
            <span><strong>Approved By:</strong> FinOps Team | <span id="approvalDate">--</span></span>
        </div>
    </div>

    <!-- Global Filter Bar -->
    <div class="global-filter-bar">
        <div class="filter-group">
            <label>Department</label>
            <select id="global-filter-dept" onchange="applyGlobalFilters()">
                <option value="all">All Departments</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Principal Investigator</label>
            <select id="global-filter-pi" onchange="applyGlobalFilters()">
                <option value="all">All PIs</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Project Status</label>
            <select id="global-filter-status" onchange="applyGlobalFilters()">
                <option value="all">All Statuses</option>
                <option value="Active">Active</option>
                <option value="Completed">Completed</option>
                <option value="Expiring">Expiring Soon</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Budget Status</label>
            <select id="global-filter-budget" onchange="applyGlobalFilters()">
                <option value="all">All Budget Statuses</option>
                <option value="overspend">Over Budget</option>
                <option value="atrisk">At Risk (>80%)</option>
                <option value="ontrack">On Track</option>
                <option value="underutilized">Underutilized (<30%)</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Environment Type</label>
            <select id="global-filter-env" onchange="applyGlobalFilters()">
                <option value="all">All Types</option>
                <option value="AVE">AVE (PHI)</option>
                <option value="Standard">Standard</option>
            </select>
        </div>
        <button class="filter-reset" onclick="resetGlobalFilters()">Reset All Filters</button>
    </div>

    <!-- Active Filters Display -->
    <div class="active-filters-display" id="active-filters-display">
        <strong>Active Filters:</strong>
        <span id="active-filter-tags"></span>
    </div>

    <nav class="nav-tabs" id="nav-tabs"></nav>

    <main class="main-content">
        <!-- PAGE: Finance & Research Operations -->
        <div id="page-finance" class="page">
            <div class="page-header">
                <div class="page-header-left">
                    <h2>Finance & Research Operations</h2>
                    <p>Central oversight of cloud spending across departments, divisions, and PIs</p>
                </div>
                <div class="audience-badge leadership">
                    <span class="material-icons" style="font-size:16px;">business_center</span> For: CIO / CMIO / CRO / Research Administration
                </div>
            </div>

            <div class="kpi-row">
                <div class="kpi-card">
                    <div class="kpi-label">Total YTD Spend</div>
                    <div class="kpi-value" id="kpi-finance-ytd">--</div>
                    <div class="kpi-trend up" id="kpi-finance-trend">+12% vs prior</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Total Budget</div>
                    <div class="kpi-value" id="kpi-finance-budget">--</div>
                    <div class="kpi-subtext">Across all grants</div>
                </div>
                <div class="kpi-card success">
                    <div class="kpi-label">Budget Variance</div>
                    <div class="kpi-value" id="kpi-finance-variance">--</div>
                    <div class="kpi-subtext" id="kpi-finance-variance-sub">Under budget</div>
                </div>
                <div class="kpi-card alert">
                    <div class="kpi-label">Over Budget PIs</div>
                    <div class="kpi-value" id="kpi-finance-overspend">--</div>
                    <div class="kpi-subtext">Requires attention</div>
                </div>
                <div class="kpi-card info">
                    <div class="kpi-label">Completed Projects</div>
                    <div class="kpi-value" id="kpi-finance-completed">--</div>
                    <div class="kpi-subtext">This fiscal year</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    Cost by Department / PI
                    <span class="badge" id="finance-matrix-badge">Drill-down Enabled</span>
                </div>
                <div class="card-body">
                    <div class="table-scroll">
                        <table class="matrix-table" id="finance-matrix-table">
                            <thead>
                                <tr>
                                    <th>Department / PI</th>
                                    <th>Total Cost</th>
                                    <th>Budget</th>
                                    <th>Variance</th>
                                    <th>% Used</th>
                                    <th>Budget Status</th>
                                    <th>Projects</th>
                                </tr>
                            </thead>
                            <tbody id="finance-matrix-tbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">Monthly Spend Trend</div>
                    <div class="card-body">
                        <div class="chart-container tall"><canvas id="financeSpendTrendChart"></canvas></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">Budget vs Actuals by Department</div>
                    <div class="card-body">
                        <div class="chart-container tall"><canvas id="financeBudgetChart"></canvas></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    All Projects Detail
                    <span class="badge" id="finance-projects-badge">0 Projects</span>
                </div>
                <div class="card-body">
                    <div class="table-scroll">
                        <table class="data-table" id="finance-projects-table">
                            <thead>
                                <tr>
                                    <th>ServiceNow #</th>
                                    <th>Project Name</th>
                                    <th>Grant</th>
                                    <th>IRB #</th>
                                    <th>IRB Status</th>
                                    <th>PI</th>
                                    <th>Department</th>
                                    <th>Type</th>
                                    <th class="text-right">Monthly Cost</th>
                                    <th>Budget Status</th>
                                    <th>End Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="finance-projects-tbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- PAGE: PI Personal View -->
        <div id="page-pi" class="page">
            <div class="page-header">
                <div class="page-header-left">
                    <h2>My Research Computing</h2>
                    <p>Your personal cloud environments, costs, and grant budget status</p>
                </div>
                <div class="audience-badge pi">
                    <span class="material-icons" style="font-size:16px;">science</span> For: Principal Investigators
                </div>
            </div>

            <div class="pi-context-banner">
                <div class="pi-context-info">
                    <div class="pi-avatar" id="pi-avatar">SC</div>
                    <div class="pi-details">
                        <h3 id="pi-name">Dr. Sarah Chen</h3>
                        <p id="pi-dept">Department of Cardiology</p>
                    </div>
                </div>
                <div class="pi-context-note">
                    Viewing only your projects and grants. Contact Research Admin for cross-PI reporting.
                </div>
            </div>

            <div class="kpi-row">
                <div class="kpi-card">
                    <div class="kpi-label">My Total Spend (YTD)</div>
                    <div class="kpi-value" id="kpi-pi-spend">--</div>
                    <div class="kpi-subtext">Across all my grants</div>
                </div>
                <div class="kpi-card success">
                    <div class="kpi-label">Budget Remaining</div>
                    <div class="kpi-value" id="kpi-pi-remaining">--</div>
                    <div class="kpi-subtext" id="kpi-pi-pct">--</div>
                </div>
                <div class="kpi-card alert">
                    <div class="kpi-label">Expiring Soon</div>
                    <div class="kpi-value" id="kpi-pi-expiring">--</div>
                    <div class="kpi-subtext">Within 30 days</div>
                </div>
                <div class="kpi-card info">
                    <div class="kpi-label">Active Projects</div>
                    <div class="kpi-value" id="kpi-pi-projects">--</div>
                    <div class="kpi-subtext">Cloud environments</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    My Research Projects
                    <span class="badge" id="pi-project-count">0 Projects</span>
                </div>
                <div class="card-body">
                    <div class="table-scroll">
                        <table class="data-table" id="pi-projects-table">
                            <thead>
                                <tr>
                                    <th>ServiceNow #</th>
                                    <th>Project Name</th>
                                    <th>Grant</th>
                                    <th>IRB #</th>
                                    <th>IRB Status</th>
                                    <th>Type</th>
                                    <th class="text-right">Monthly Cost</th>
                                    <th>Budget Usage</th>
                                    <th>End Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="pi-projects-tbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">My Grants Summary</div>
                <div class="card-body">
                    <table class="data-table" id="pi-grants-table">
                        <thead>
                            <tr>
                                <th>Grant Name</th>
                                <th class="text-right">Spent</th>
                                <th class="text-right">Budget</th>
                                <th class="text-right">Remaining</th>
                                <th>Usage</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="pi-grants-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- PAGE: Cloud Operations -->
        <div id="page-cloudops" class="page">
            <div class="page-header">
                <div class="page-header-left">
                    <h2>Cloud Operations & Compliance</h2>
                    <p>Compliance triage and remediation for IT, security, and FinOps teams</p>
                </div>
                <div class="audience-badge ops">
                    <span class="material-icons" style="font-size:16px;">cloud</span> For: Cloud Ops / IT / Security
                </div>
            </div>

            <div class="triage-summary">
                <div class="triage-card critical">
                    <div class="triage-count" id="triage-critical">0</div>
                    <div class="triage-label">Critical</div>
                </div>
                <div class="triage-card high">
                    <div class="triage-count" id="triage-high">0</div>
                    <div class="triage-label">High</div>
                </div>
                <div class="triage-card medium">
                    <div class="triage-count" id="triage-medium">0</div>
                    <div class="triage-label">Medium</div>
                </div>
                <div class="triage-card low">
                    <div class="triage-count" id="triage-low">0</div>
                    <div class="triage-label">Low</div>
                </div>
            </div>

            <div class="kpi-row">
                <div class="kpi-card alert">
                    <div class="kpi-label">Open Issues</div>
                    <div class="kpi-value" id="kpi-ops-issues">--</div>
                    <div class="kpi-subtext">Requires remediation</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Total Environments</div>
                    <div class="kpi-value" id="kpi-ops-envs">--</div>
                    <div class="kpi-subtext">Active</div>
                </div>
                <div class="kpi-card success">
                    <div class="kpi-label">Compliance Rate</div>
                    <div class="kpi-value" id="kpi-ops-rate">--</div>
                    <div class="kpi-subtext">In compliance</div>
                </div>
                <div class="kpi-card info">
                    <div class="kpi-label">Est. Savings</div>
                    <div class="kpi-value" id="kpi-ops-savings">--</div>
                    <div class="kpi-subtext">From remediation</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    Compliance Issues - Triage View
                    <span class="badge" id="ops-compliance-badge">0 Open</span>
                </div>
                <div class="card-body">
                    <div class="table-scroll">
                        <table class="data-table" id="ops-compliance-table">
                            <thead>
                                <tr>
                                    <th>ServiceNow #</th>
                                    <th>Grant</th>
                                    <th>IRB #</th>
                                    <th>IRB Status</th>
                                    <th>Severity</th>
                                    <th>Type</th>
                                    <th>Environment</th>
                                    <th>PI</th>
                                    <th>Violation</th>
                                    <th class="text-right">Impact/Mo</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="ops-compliance-tbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">Issues by Type</div>
                    <div class="card-body">
                        <div class="chart-container"><canvas id="opsIssueTypeChart"></canvas></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">Issues by Severity</div>
                    <div class="card-body">
                        <div class="chart-container"><canvas id="opsSeverityChart"></canvas></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PAGE: Governance -->
        <div id="page-governance" class="page">
            <div class="page-header">
                <div class="page-header-left">
                    <h2>Department Governance</h2>
                    <p>Department-level oversight with optional PI comparisons</p>
                </div>
                <div class="audience-badge governance">
                    <span class="material-icons" style="font-size:16px;">assignment</span> For: Department Chairs / Division Chiefs
                </div>
            </div>

            <div class="config-notice">
                <span class="material-icons" style="font-size:16px;">settings</span>
                <span><strong>Configurable:</strong> PI comparisons are optional. Use the toggle below to enable/disable.</span>
            </div>

            <div style="margin-bottom: 20px;">
                <div class="toggle-switch">
                    <input type="checkbox" id="toggle-comparisons" onchange="toggleComparisons()">
                    <label for="toggle-comparisons">Show PI Comparisons</label>
                </div>
            </div>

            <div class="kpi-row">
                <div class="kpi-card">
                    <div class="kpi-label">Dept Total Spend</div>
                    <div class="kpi-value" id="kpi-gov-spend">--</div>
                    <div class="kpi-subtext">Year to Date</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Dept Budget</div>
                    <div class="kpi-value" id="kpi-gov-budget">--</div>
                    <div class="kpi-subtext">Annual</div>
                </div>
                <div class="kpi-card success">
                    <div class="kpi-label">PIs in Dept</div>
                    <div class="kpi-value" id="kpi-gov-pis">--</div>
                    <div class="kpi-subtext">Active</div>
                </div>
                <div class="kpi-card info">
                    <div class="kpi-label">Compliance</div>
                    <div class="kpi-value" id="kpi-gov-compliance">--</div>
                    <div class="kpi-subtext">Dept average</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    PIs in Department
                    <span class="badge" id="gov-pi-badge">--</span>
                </div>
                <div class="card-body">
                    <div class="table-scroll">
                        <table class="data-table" id="gov-pi-table">
                            <thead>
                                <tr>
                                    <th>PI Name</th>
                                    <th>Division</th>
                                    <th class="text-right">YTD Spend</th>
                                    <th class="text-right">Budget</th>
                                    <th>Usage</th>
                                    <th>Budget Status</th>
                                    <th>Projects</th>
                                </tr>
                            </thead>
                            <tbody id="gov-pi-tbody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="comparison-section" style="display: none;">
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">PI Spend Distribution</div>
                        <div class="card-body">
                            <div class="chart-container"><canvas id="govSpendChart"></canvas></div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">Budget Utilization by PI</div>
                        <div class="card-body">
                            <div class="chart-container"><canvas id="govBudgetChart"></canvas></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PAGE: Grant Administrator -->
        <div id="page-grants" class="page">
            <div class="page-header">
                <div class="page-header-left">
                    <h2>University of Michigan Medicine &mdash; Grant Administrator</h2>
                    <p style="color:var(--umm-blue);font-weight:500;">Federally funded research awards &bull; NIH RePORTER &amp; USAspending data</p>
                </div>
                <div class="audience-badge" style="background:#E8EAF6;color:#283593;border:1px solid #9FA8DA;">
                    <span class="material-icons" style="font-size:16px;">account_balance</span> For: Research Administration / Grants Office
                </div>
            </div>

            <div class="demo-banner">
                <span class="material-icons" style="font-size:18px;">bar_chart</span>
                <span><strong>Sample Data Preview:</strong> Showing embedded sample data for demonstration. Toggle <em>Live API</em> for real-time results from NIH RePORTER and USAspending APIs.</span>
            </div>

            <div class="offline-toggle">
                <label>Data Mode:</label>
                <div class="toggle-switch">
                    <input type="checkbox" id="grants-live-toggle" onchange="toggleGrantsMode()">
                    <label for="grants-live-toggle">Live API (requires internet &amp; may encounter CORS)</label>
                </div>
                <button class="export-btn" onclick="exportGrantsCSV()" style="margin-left:auto;">Export CSV</button>
            </div>

            <div class="grants-progress" id="grants-progress">Fetching data...</div>

            <!-- Institution filter removed: UMM-only by default -->

            <div class="grants-filter-bar" id="grants-filter-bar">
                <div class="filter-group">
                    <label>PI Name</label>
                    <input type="text" id="grants-filter-pi" placeholder="Search PI..." oninput="applyGrantsFilters()">
                </div>
                <div class="filter-group">
                    <label>Fiscal Year</label>
                    <select id="grants-filter-fy" onchange="applyGrantsFilters()">
                        <option value="all">All Years</option>
                        <option value="2023">2023</option>
                        <option value="2024">2024</option>
                        <option value="2025">2025</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Award Type / Activity</label>
                    <select id="grants-filter-type" onchange="applyGrantsFilters()">
                        <option value="all">All Types</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Keyword</label>
                    <input type="text" id="grants-filter-keyword" placeholder="cancer, neural..." oninput="applyGrantsFilters()">
                </div>
                <div class="filter-group">
                    <label>Min Amount ($)</label>
                    <input type="number" id="grants-filter-min" placeholder="0" oninput="applyGrantsFilters()">
                </div>
                <div class="filter-group">
                    <label>Max Amount ($)</label>
                    <input type="number" id="grants-filter-max" placeholder="10000000" oninput="applyGrantsFilters()">
                </div>
                <button class="filter-reset" onclick="resetGrantsFilters()" style="margin-top:14px;">Reset</button>
            </div>

            <div class="kpi-row" id="grants-kpi-row">
                <div class="kpi-card">
                    <div class="kpi-label">Total Awards</div>
                    <div class="kpi-value" id="kpi-grants-total">--</div>
                    <div class="kpi-subtext">Across selected institutions</div>
                </div>
                <div class="kpi-card success" style="grid-column: span 2;">
                    <div class="kpi-label">Total Funding</div>
                    <div class="kpi-value" id="kpi-grants-amount" style="font-size:32px;white-space:nowrap;">--</div>
                    <div class="kpi-subtext">Sum of award amounts</div>
                </div>
                <div class="kpi-card info">
                    <div class="kpi-label">Unique PIs</div>
                    <div class="kpi-value" id="kpi-grants-pis">--</div>
                    <div class="kpi-subtext">Principal Investigators</div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-label">Top Funding Source</div>
                    <div class="kpi-value" id="kpi-grants-top-source" style="font-size:18px;">--</div>
                    <div class="kpi-subtext" id="kpi-grants-top-source-sub">Institute / Agency</div>
                </div>
                <div class="kpi-card alert">
                    <div class="kpi-label">YoY Change</div>
                    <div class="kpi-value" id="kpi-grants-yoy">--</div>
                    <div class="kpi-subtext">vs. prior fiscal year</div>
                </div>
            </div>

            <div class="sub-tab-bar">
                <button class="sub-tab active" onclick="showGrantsSubTab('nih', this)">NIH RePORTER</button>
                <button class="sub-tab" onclick="showGrantsSubTab('usa', this)">USAspending</button>
                <button class="sub-tab" onclick="showGrantsSubTab('combined', this)">Combined View</button>
            </div>

            <div id="grants-subtab-nih" class="sub-tab-content active">
                <div class="card">
                    <div class="card-header">NIH RePORTER Awards <span class="badge" id="nih-table-badge">0 Records</span></div>
                    <div class="card-body">
                        <div class="table-scroll" style="max-height:500px;">
                            <table class="data-table" id="nih-grants-table">
                                <thead><tr><th>Project #</th><th>Title</th><th>PI</th><th>Organization</th><th>FY</th><th class="text-right">Award Amount</th><th>Institute</th><th>Activity</th><th>Start</th><th>End</th></tr></thead>
                                <tbody id="nih-grants-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="grants-subtab-usa" class="sub-tab-content">
                <div class="card">
                    <div class="card-header">USAspending Awards <span class="badge" id="usa-table-badge">0 Records</span></div>
                    <div class="card-body">
                        <div class="table-scroll" style="max-height:500px;">
                            <table class="data-table" id="usa-grants-table">
                                <thead><tr><th>Award ID</th><th>Recipient</th><th>Awarding Agency</th><th>Funding Agency</th><th>FY</th><th class="text-right">Amount</th><th>Type</th><th>Description</th></tr></thead>
                                <tbody id="usa-grants-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div id="grants-subtab-combined" class="sub-tab-content">
                <div class="card">
                    <div class="card-header">Combined View - Heuristic Matching <span class="badge" id="combined-table-badge">0 Matches</span></div>
                    <div class="card-body">
                        <p style="font-size:12px;color:#666;margin-bottom:12px;">Records matched heuristically by institution + fiscal year + amount proximity (20%%) + keyword overlap. Confidence: <span class="confidence-badge confidence-high">High</span> = all criteria, <span class="confidence-badge confidence-medium">Medium</span> = 3/4, <span class="confidence-badge confidence-low">Low</span> = 2/4.</p>
                        <div class="table-scroll" style="max-height:500px;">
                            <table class="data-table" id="combined-grants-table">
                                <thead><tr><th>NIH Project #</th><th>USA Award ID</th><th>Institution</th><th>PI (NIH)</th><th>FY</th><th class="text-right">NIH Amount</th><th class="text-right">USA Amount</th><th>Confidence</th></tr></thead>
                                <tbody id="combined-grants-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="card" style="margin-top:20px;">
                    <div class="card-header">Unmatched Records <span class="badge" id="unmatched-badge">0</span></div>
                    <div class="card-body">
                        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
                            <div>
                                <h4 style="font-size:13px;margin-bottom:8px;color:var(--umm-blue);">Unmatched NIH Records</h4>
                                <div class="table-scroll" style="max-height:300px;">
                                    <table class="data-table" id="unmatched-nih-table"><thead><tr><th>Project #</th><th>PI</th><th>Org</th><th>FY</th><th class="text-right">Amount</th></tr></thead><tbody id="unmatched-nih-tbody"></tbody></table>
                                </div>
                            </div>
                            <div>
                                <h4 style="font-size:13px;margin-bottom:8px;color:var(--umm-blue);">Unmatched USAspending Records</h4>
                                <div class="table-scroll" style="max-height:300px;">
                                    <table class="data-table" id="unmatched-usa-table"><thead><tr><th>Award ID</th><th>Recipient</th><th>Agency</th><th>FY</th><th class="text-right">Amount</th></tr></thead><tbody id="unmatched-usa-tbody"></tbody></table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card" style="margin-top:20px;">
                    <div class="card-header">Cross-Institution Comparison</div>
                    <div class="card-body">
                        <div class="table-scroll">
                            <table class="data-table" id="cross-institution-table">
                                <thead><tr><th>Institution</th><th class="text-right">NIH Awards</th><th class="text-right">NIH Total $</th><th class="text-right">USA Awards</th><th class="text-right">USA Total $</th><th class="text-right">Combined $</th><th>Matched</th></tr></thead>
                                <tbody id="cross-institution-tbody"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div class="grid-2" style="margin-top:24px;">
                <div class="card"><div class="card-header">Awards by Institution</div><div class="card-body"><div class="chart-container tall"><canvas id="grantsInstitutionChart"></canvas></div></div></div>
                <div class="card"><div class="card-header">Trend by Fiscal Year</div><div class="card-body"><div class="chart-container tall"><canvas id="grantsTrendChart"></canvas></div></div></div>
            </div>
            <div class="grid-2">
                <div class="card"><div class="card-header">Top PIs by Funding</div><div class="card-body"><div class="chart-container tall"><canvas id="grantsTopPIsChart"></canvas></div></div></div>
                <div class="card"><div class="card-header">Top Funding Agencies</div><div class="card-body"><div class="chart-container tall"><canvas id="grantsAgenciesChart"></canvas></div></div></div>
            </div>
            <div style="max-width:500px;margin:0 auto;">
                <div class="card"><div class="card-header">Award Type Breakdown</div><div class="card-body"><div class="chart-container"><canvas id="grantsTypeChart"></canvas></div></div></div>
            </div>
            <div class="grants-footer-branding">
                <strong>University of Michigan Medicine</strong> &bull; FinOps Research Grants Dashboard<br>
                <span class="material-icons" style="font-size:13px;vertical-align:middle;">link</span>
                Data APIs: <a href="https://api.reporter.nih.gov/" target="_blank" rel="noopener" style="color:var(--umm-blue-light);">NIH RePORTER API</a> &bull;
                <a href="https://api.usaspending.gov/" target="_blank" rel="noopener" style="color:var(--umm-blue-light);">USAspending API</a> &bull;
                <a href="https://reporter.nih.gov/" target="_blank" rel="noopener" style="color:var(--umm-blue-light);">NIH RePORTER</a> &bull;
                <a href="https://www.usaspending.gov/" target="_blank" rel="noopener" style="color:var(--umm-blue-light);">USAspending.gov</a>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>University of Michigan Medicine - FinOps Cloud Cost Management Dashboard</p>
        <p>Data aligned to ServiceNow + Azure Cost Management + NIH RePORTER + USAspending | Confidential - Internal Use Only</p>
    </footer>

    <script>
        // ============================================
        // EXPANDED DATA WITH VARIED SCENARIOS
        // ============================================

        const DEPARTMENTS = {
            "DEPT-CARD": { name: "Cardiology", divisions: ["General Cardiology", "Interventional", "Electrophysiology"] },
            "DEPT-ONC": { name: "Oncology", divisions: ["Medical Oncology", "Surgical Oncology", "Radiation Oncology"] },
            "DEPT-NEUR": { name: "Neurology", divisions: ["General Neurology", "Movement Disorders", "Neuro-Oncology"] },
            "DEPT-PEDS": { name: "Pediatrics", divisions: ["General Pediatrics", "Peds Cardiology", "Peds Oncology"] },
            "DEPT-SURG": { name: "Surgery", divisions: ["General Surgery", "Vascular", "Transplant"] },
            "DEPT-PATH": { name: "Pathology", divisions: ["Anatomic", "Clinical", "Molecular"] },
            "DEPT-RADI": { name: "Radiology", divisions: ["Diagnostic", "Interventional", "Nuclear Medicine"] },
            "DEPT-PSYC": { name: "Psychiatry", divisions: ["Adult", "Child", "Addiction Medicine"] }
        };

        // EXPANDED GRANTS - Multiple per PI with varied budget scenarios
        const GRANTS = {
            // Dr. Sarah Chen - Cardiology (WITHIN BUDGET)
            "GRANT-NIH-HL-2024-01": { name: "NIH Heart & Lung Research 2024", dept: "DEPT-CARD", budget: 85000, pi: "Dr. Sarah Chen" },
            "GRANT-AHA-2025-02": { name: "AHA Cardiovascular Innovation", dept: "DEPT-CARD", budget: 45000, pi: "Dr. Sarah Chen" },

            // Dr. Michael Torres - Oncology (OVERSPEND)
            "GRANT-NIH-CA-2025-09": { name: "NIH Cancer Genomics 2025", dept: "DEPT-ONC", budget: 120000, pi: "Dr. Michael Torres" },
            "GRANT-NCI-2024-15": { name: "NCI Tumor Profiling", dept: "DEPT-ONC", budget: 80000, pi: "Dr. Michael Torres" },

            // Dr. Emily Watson - Neurology (AT RISK)
            "GRANT-NIH-NS-2024-15": { name: "NIH Neurological Studies", dept: "DEPT-NEUR", budget: 130000, pi: "Dr. Emily Watson" },

            // Dr. James Park - Pediatrics (COMPLETED + WITHIN BUDGET)
            "GRANT-PCORI-2025-03": { name: "PCORI Pediatric Outcomes", dept: "DEPT-PEDS", budget: 52000, pi: "Dr. James Park" },
            "GRANT-PEDS-2024-08": { name: "Pediatric Asthma Study (Completed)", dept: "DEPT-PEDS", budget: 35000, pi: "Dr. James Park" },

            // Dr. Amanda Foster - Surgery (WITHIN BUDGET)
            "GRANT-DOD-2024-22": { name: "DoD Surgical Innovation", dept: "DEPT-SURG", budget: 115000, pi: "Dr. Amanda Foster" },

            // Dr. Robert Kim - Pathology (OVERSPEND)
            "GRANT-NIH-AI-2025-07": { name: "NIH AI in Pathology", dept: "DEPT-PATH", budget: 65000, pi: "Dr. Robert Kim" },

            // Dr. Lisa Patel - Radiology (UNDERUTILIZED)
            "GRANT-AHRQ-2024-11": { name: "AHRQ Imaging Analytics", dept: "DEPT-RADI", budget: 95000, pi: "Dr. Lisa Patel" },

            // Dr. David Liu - Psychiatry (COMPLETED)
            "GRANT-NIMH-2025-04": { name: "NIMH Mental Health Data", dept: "DEPT-PSYC", budget: 45000, pi: "Dr. David Liu" },
            "GRANT-NIMH-2024-12": { name: "NIMH Depression Study (Completed)", dept: "DEPT-PSYC", budget: 55000, pi: "Dr. David Liu" },

            // Dr. Jennifer Adams - Cardiology (NEW PI - AT RISK)
            "GRANT-NIH-HL-2025-18": { name: "NIH Cardiac Imaging AI", dept: "DEPT-CARD", budget: 70000, pi: "Dr. Jennifer Adams" },

            // Dr. Kevin Wright - Oncology (WITHIN BUDGET)
            "GRANT-DOD-ONC-2025-05": { name: "DoD Cancer Screening", dept: "DEPT-ONC", budget: 90000, pi: "Dr. Kevin Wright" },

            // Dr. Maria Garcia - Neurology (COMPLETED + OVERSPEND on active)
            "GRANT-NINDS-2024-20": { name: "NINDS Stroke Prevention", dept: "DEPT-NEUR", budget: 60000, pi: "Dr. Maria Garcia" },
            "GRANT-NINDS-2023-11": { name: "NINDS MS Study (Completed)", dept: "DEPT-NEUR", budget: 75000, pi: "Dr. Maria Garcia" },

            // Dr. Thomas Brown - Surgery (SEVERE OVERSPEND - 130% over budget)
            "GRANT-DOD-SURG-2025-01": { name: "DoD Trauma Surgery AI", dept: "DEPT-SURG", budget: 55000, pi: "Dr. Thomas Brown" },
            "GRANT-NIH-SURG-2024-09": { name: "NIH Minimally Invasive Procedures", dept: "DEPT-SURG", budget: 48000, pi: "Dr. Thomas Brown" },

            // Dr. Rachel Lee - Pediatrics (OVERSPEND - 122% over budget)
            "GRANT-NIH-PEDS-2025-06": { name: "NIH Pediatric Cancer Genomics", dept: "DEPT-PEDS", budget: 62000, pi: "Dr. Rachel Lee" },
            "GRANT-PCORI-PEDS-2024-14": { name: "PCORI Childhood Diabetes Study", dept: "DEPT-PEDS", budget: 45000, pi: "Dr. Rachel Lee" }
        };

        // EXPANDED REQUESTS with varied statuses
        const REQUESTS = [
            // Dr. Sarah Chen - Cardiology (WITHIN BUDGET - 2 active projects)
            { RequestId: "RITM001001", CatalogItemName: "Cardiac Arrhythmia Genomics Analysis", PIName: "Dr. Sarah Chen", EnvironmentType: "Standard", DepartmentId: "DEPT-CARD", Division: "Electrophysiology", GrantId: "GRANT-NIH-HL-2024-01", ExpectedEndDate: "2026-10-15", RequestStatus: "Active", IRBNumber: "HUM00198234", IRBStatus: "Approved" },
            { RequestId: "RITM001010", CatalogItemName: "Heart Failure Predictive Analytics", PIName: "Dr. Sarah Chen", EnvironmentType: "Standard", DepartmentId: "DEPT-CARD", Division: "General Cardiology", GrantId: "GRANT-AHA-2025-02", ExpectedEndDate: "2026-08-30", RequestStatus: "Active", IRBNumber: "HUM00201456", IRBStatus: "Approved" },

            // Dr. Michael Torres - Oncology (OVERSPEND - high cost projects)
            { RequestId: "RITM001002", CatalogItemName: "Breast Cancer Biomarker Discovery (PHI)", PIName: "Dr. Michael Torres", EnvironmentType: "AVE", DepartmentId: "DEPT-ONC", Division: "Medical Oncology", GrantId: "GRANT-NIH-CA-2025-09", ExpectedEndDate: "2026-12-31", RequestStatus: "Active", IRBNumber: "HUM00187562", IRBStatus: "Approved" },
            { RequestId: "RITM001009", CatalogItemName: "Tumor Genomics Sequencing Cluster", PIName: "Dr. Michael Torres", EnvironmentType: "Standard", DepartmentId: "DEPT-ONC", Division: "Medical Oncology", GrantId: "GRANT-NCI-2024-15", ExpectedEndDate: "2026-06-30", RequestStatus: "Active", IRBNumber: "HUM00187562", IRBStatus: "Approved" },
            { RequestId: "RITM001020", CatalogItemName: "Cancer Drug Response Modeling", PIName: "Dr. Michael Torres", EnvironmentType: "AVE", DepartmentId: "DEPT-ONC", Division: "Medical Oncology", GrantId: "GRANT-NIH-CA-2025-09", ExpectedEndDate: "2026-09-15", RequestStatus: "Active", IRBNumber: "HUM00205891", IRBStatus: "Under Review" },

            // Dr. Emily Watson - Neurology (AT RISK - 85% budget used)
            { RequestId: "RITM001003", CatalogItemName: "Alzheimer's Disease MRI Processing", PIName: "Dr. Emily Watson", EnvironmentType: "Standard", DepartmentId: "DEPT-NEUR", Division: "Movement Disorders", GrantId: "GRANT-NIH-NS-2024-15", ExpectedEndDate: "2026-08-30", RequestStatus: "Active", IRBNumber: "HUM00176543", IRBStatus: "Approved" },
            { RequestId: "RITM001011", CatalogItemName: "Parkinson's Disease Registry (PHI)", PIName: "Dr. Emily Watson", EnvironmentType: "AVE", DepartmentId: "DEPT-NEUR", Division: "Movement Disorders", GrantId: "GRANT-NIH-NS-2024-15", ExpectedEndDate: "2026-08-30", RequestStatus: "Active", IRBNumber: "HUM00189234", IRBStatus: "Approved" },

            // Dr. James Park - Pediatrics (COMPLETED project + ACTIVE within budget)
            { RequestId: "RITM001004", CatalogItemName: "Pediatric Asthma Outcomes Study (PHI)", PIName: "Dr. James Park", EnvironmentType: "AVE", DepartmentId: "DEPT-PEDS", Division: "General Pediatrics", GrantId: "GRANT-PCORI-2025-03", ExpectedEndDate: "2026-02-15", RequestStatus: "Expiring", IRBNumber: "HUM00165432", IRBStatus: "Approved" },
            { RequestId: "RITM001021", CatalogItemName: "Childhood Obesity Analysis (Completed)", PIName: "Dr. James Park", EnvironmentType: "Standard", DepartmentId: "DEPT-PEDS", Division: "General Pediatrics", GrantId: "GRANT-PEDS-2024-08", ExpectedEndDate: "2025-12-31", RequestStatus: "Completed", IRBNumber: "HUM00154321", IRBStatus: "Closed" },

            // Dr. Amanda Foster - Surgery (WITHIN BUDGET)
            { RequestId: "RITM001005", CatalogItemName: "Robotic Surgery ML Training", PIName: "Dr. Amanda Foster", EnvironmentType: "Standard", DepartmentId: "DEPT-SURG", Division: "General Surgery", GrantId: "GRANT-DOD-2024-22", ExpectedEndDate: "2026-11-30", RequestStatus: "Active", IRBNumber: "N/A", IRBStatus: "Exempt" },
            { RequestId: "RITM001012", CatalogItemName: "Surgical Outcomes DevTest Sandbox", PIName: "Dr. Amanda Foster", EnvironmentType: "Standard", DepartmentId: "DEPT-SURG", Division: "General Surgery", GrantId: "GRANT-DOD-2024-22", ExpectedEndDate: "2026-03-15", RequestStatus: "Expiring", IRBNumber: "N/A", IRBStatus: "Exempt" },

            // Dr. Robert Kim - Pathology (OVERSPEND)
            { RequestId: "RITM001006", CatalogItemName: "Digital Pathology AI Diagnostics (PHI)", PIName: "Dr. Robert Kim", EnvironmentType: "AVE", DepartmentId: "DEPT-PATH", Division: "Molecular Pathology", GrantId: "GRANT-NIH-AI-2025-07", ExpectedEndDate: "2026-09-15", RequestStatus: "Active", IRBNumber: "HUM00192876", IRBStatus: "Approved" },
            { RequestId: "RITM001022", CatalogItemName: "Tissue Analysis GPU Cluster", PIName: "Dr. Robert Kim", EnvironmentType: "Standard", DepartmentId: "DEPT-PATH", Division: "Molecular Pathology", GrantId: "GRANT-NIH-AI-2025-07", ExpectedEndDate: "2026-07-30", RequestStatus: "Active", IRBNumber: "HUM00192876", IRBStatus: "Approved" },

            // Dr. Lisa Patel - Radiology (UNDERUTILIZED - only 25% budget used)
            { RequestId: "RITM001007", CatalogItemName: "CT Imaging Reconstruction Pipeline", PIName: "Dr. Lisa Patel", EnvironmentType: "Standard", DepartmentId: "DEPT-RADI", Division: "Diagnostic Radiology", GrantId: "GRANT-AHRQ-2024-11", ExpectedEndDate: "2026-06-30", RequestStatus: "Active", IRBNumber: "N/A", IRBStatus: "Exempt" },

            // Dr. David Liu - Psychiatry (COMPLETED + WITHIN BUDGET on active)
            { RequestId: "RITM001008", CatalogItemName: "Depression Treatment Response (PHI)", PIName: "Dr. David Liu", EnvironmentType: "AVE", DepartmentId: "DEPT-PSYC", Division: "Adult Psychiatry", GrantId: "GRANT-NIMH-2025-04", ExpectedEndDate: "2026-04-30", RequestStatus: "Active", IRBNumber: "HUM00178654", IRBStatus: "Approved" },
            { RequestId: "RITM001023", CatalogItemName: "Mental Health ML Models (Completed)", PIName: "Dr. David Liu", EnvironmentType: "Standard", DepartmentId: "DEPT-PSYC", Division: "Adult Psychiatry", GrantId: "GRANT-NIMH-2024-12", ExpectedEndDate: "2025-11-30", RequestStatus: "Completed", IRBNumber: "HUM00156789", IRBStatus: "Closed" },

            // Dr. Jennifer Adams - Cardiology (AT RISK - new PI)
            { RequestId: "RITM001024", CatalogItemName: "Cardiac MRI AI Analysis (PHI)", PIName: "Dr. Jennifer Adams", EnvironmentType: "AVE", DepartmentId: "DEPT-CARD", Division: "Interventional", GrantId: "GRANT-NIH-HL-2025-18", ExpectedEndDate: "2026-12-15", RequestStatus: "Active", IRBNumber: "HUM00207123", IRBStatus: "Approved" },
            { RequestId: "RITM001025", CatalogItemName: "Echo Analysis Pipeline", PIName: "Dr. Jennifer Adams", EnvironmentType: "Standard", DepartmentId: "DEPT-CARD", Division: "Interventional", GrantId: "GRANT-NIH-HL-2025-18", ExpectedEndDate: "2026-10-30", RequestStatus: "Active", IRBNumber: "HUM00207123", IRBStatus: "Approved" },

            // Dr. Kevin Wright - Oncology (WITHIN BUDGET)
            { RequestId: "RITM001026", CatalogItemName: "Cancer Screening ML Model", PIName: "Dr. Kevin Wright", EnvironmentType: "Standard", DepartmentId: "DEPT-ONC", Division: "Surgical Oncology", GrantId: "GRANT-DOD-ONC-2025-05", ExpectedEndDate: "2026-11-30", RequestStatus: "Active", IRBNumber: "HUM00203456", IRBStatus: "Pending" },

            // Dr. Maria Garcia - Neurology (COMPLETED + OVERSPEND on active)
            { RequestId: "RITM001027", CatalogItemName: "Stroke Risk Prediction (PHI)", PIName: "Dr. Maria Garcia", EnvironmentType: "AVE", DepartmentId: "DEPT-NEUR", Division: "General Neurology", GrantId: "GRANT-NINDS-2024-20", ExpectedEndDate: "2026-05-30", RequestStatus: "Active", IRBNumber: "HUM00185432", IRBStatus: "Approved" },
            { RequestId: "RITM001028", CatalogItemName: "MS Lesion Analysis (Completed)", PIName: "Dr. Maria Garcia", EnvironmentType: "Standard", DepartmentId: "DEPT-NEUR", Division: "Neuro-Oncology", GrantId: "GRANT-NINDS-2023-11", ExpectedEndDate: "2025-10-31", RequestStatus: "Completed", IRBNumber: "HUM00167890", IRBStatus: "Closed" },

            // Dr. Thomas Brown - Surgery (SEVERE OVERSPEND - 130% over budget, high compute costs)
            { RequestId: "RITM001029", CatalogItemName: "Trauma Surgery AI Training (PHI)", PIName: "Dr. Thomas Brown", EnvironmentType: "AVE", DepartmentId: "DEPT-SURG", Division: "General Surgery", GrantId: "GRANT-DOD-SURG-2025-01", ExpectedEndDate: "2026-12-31", RequestStatus: "Active", IRBNumber: "HUM00209876", IRBStatus: "Approved" },
            { RequestId: "RITM001030", CatalogItemName: "Surgical Video Analysis GPU Cluster", PIName: "Dr. Thomas Brown", EnvironmentType: "Standard", DepartmentId: "DEPT-SURG", Division: "General Surgery", GrantId: "GRANT-DOD-SURG-2025-01", ExpectedEndDate: "2026-09-30", RequestStatus: "Active", IRBNumber: "HUM00209876", IRBStatus: "Approved" },
            { RequestId: "RITM001031", CatalogItemName: "Minimally Invasive Procedure Modeling", PIName: "Dr. Thomas Brown", EnvironmentType: "Standard", DepartmentId: "DEPT-SURG", Division: "Vascular", GrantId: "GRANT-NIH-SURG-2024-09", ExpectedEndDate: "2026-06-30", RequestStatus: "Active", IRBNumber: "HUM00211234", IRBStatus: "Under Review" },

            // Dr. Rachel Lee - Pediatrics (OVERSPEND - 122% over budget)
            { RequestId: "RITM001032", CatalogItemName: "Pediatric Cancer Genomics Sequencing (PHI)", PIName: "Dr. Rachel Lee", EnvironmentType: "AVE", DepartmentId: "DEPT-PEDS", Division: "Peds Oncology", GrantId: "GRANT-NIH-PEDS-2025-06", ExpectedEndDate: "2026-11-30", RequestStatus: "Active", IRBNumber: "HUM00206543", IRBStatus: "Approved" },
            { RequestId: "RITM001033", CatalogItemName: "Childhood Leukemia ML Models", PIName: "Dr. Rachel Lee", EnvironmentType: "Standard", DepartmentId: "DEPT-PEDS", Division: "Peds Oncology", GrantId: "GRANT-NIH-PEDS-2025-06", ExpectedEndDate: "2026-08-30", RequestStatus: "Active", IRBNumber: "HUM00206543", IRBStatus: "Approved" },
            { RequestId: "RITM001034", CatalogItemName: "Diabetes Biomarker Analysis (PHI)", PIName: "Dr. Rachel Lee", EnvironmentType: "AVE", DepartmentId: "DEPT-PEDS", Division: "General Pediatrics", GrantId: "GRANT-PCORI-PEDS-2024-14", ExpectedEndDate: "2026-07-31", RequestStatus: "Active", IRBNumber: "HUM00208765", IRBStatus: "Pending" }
        ];

        // Generate environments from requests
        const ENVIRONMENTS = REQUESTS.map((r, idx) => ({
            EnvironmentId: r.EnvironmentType === 'AVE' ? `AVE-00${1001 + idx}` : `ENV-00${1001 + idx}`,
            RequestId: r.RequestId,
            EnvironmentStatus: r.RequestStatus === 'Completed' ? 'Decommissioned' : 'Active'
        }));

        // Enhanced Compliance Data
        const COMPLIANCE = [
            { EnvironmentId: "AVE-001002", PolicyName: "Encryption", ViolationType: "Unencrypted storage on PHI", IssueType: "Security", Severity: "Critical", NonCompliantFlag: true, EstimatedMonthlyImpactUSD: 0, RemediationStatus: "Open" },
            { EnvironmentId: "ENV-001011", PolicyName: "NetworkSecurity", ViolationType: "Public IP exposed", IssueType: "Security", Severity: "Critical", NonCompliantFlag: true, EstimatedMonthlyImpactUSD: 0, RemediationStatus: "Open" },
            { EnvironmentId: "AVE-001007", PolicyName: "DataRetention", ViolationType: "Backup policy missing", IssueType: "Security", Severity: "High", NonCompliantFlag: true, EstimatedMonthlyImpactUSD: 0, RemediationStatus: "Open" },
            { EnvironmentId: "ENV-001005", PolicyName: "IdleResources", ViolationType: "VM idle > 7 days", IssueType: "Cost", Severity: "Medium", NonCompliantFlag: true, EstimatedMonthlyImpactUSD: 450, RemediationStatus: "Pending" },
            { EnvironmentId: "ENV-001009", PolicyName: "IdleResources", ViolationType: "Unused disk attached", IssueType: "Cost", Severity: "Medium", NonCompliantFlag: true, EstimatedMonthlyImpactUSD: 180, RemediationStatus: "Open" },
            { EnvironmentId: "ENV-001012", PolicyName: "IdleResources", ViolationType: "DevTest unused 14+ days", IssueType: "Cost", Severity: "Low", NonCompliantFlag: true, EstimatedMonthlyImpactUSD: 320, RemediationStatus: "Pending" },
            { EnvironmentId: "ENV-001001", PolicyName: "RequiredTags", ViolationType: "Missing GrantId Tag", IssueType: "Hygiene", Severity: "Low", NonCompliantFlag: true, EstimatedMonthlyImpactUSD: 0, RemediationStatus: "Open" },
            { EnvironmentId: "ENV-001003", PolicyName: "RequiredTags", ViolationType: "Missing CostCenter Tag", IssueType: "Hygiene", Severity: "Low", NonCompliantFlag: true, EstimatedMonthlyImpactUSD: 0, RemediationStatus: "Open" },
            { EnvironmentId: "AVE-001008", PolicyName: "RequiredTags", ViolationType: "Missing PI Tag", IssueType: "Hygiene", Severity: "Low", NonCompliantFlag: true, EstimatedMonthlyImpactUSD: 0, RemediationStatus: "Pending" }
        ];

        // Cost generation with varied scenarios
        function generateMonthlyCosts() {
            const costs = [];
            const months = ['2025-02', '2025-03', '2025-04', '2025-05', '2025-06', '2025-07',
                           '2025-08', '2025-09', '2025-10', '2025-11', '2025-12', '2026-01'];

            // Cost profiles per PI scenario
            const piCostMultipliers = {
                "Dr. Sarah Chen": 0.55,      // Within budget
                "Dr. Michael Torres": 1.25,   // Overspend
                "Dr. Emily Watson": 0.85,     // At risk
                "Dr. James Park": 0.45,       // Within budget
                "Dr. Amanda Foster": 0.50,    // Within budget
                "Dr. Robert Kim": 1.15,       // Overspend
                "Dr. Lisa Patel": 0.22,       // Underutilized
                "Dr. David Liu": 0.40,        // Within budget
                "Dr. Jennifer Adams": 0.82,   // At risk
                "Dr. Kevin Wright": 0.55,     // Within budget
                "Dr. Maria Garcia": 1.10,     // Overspend
                "Dr. Thomas Brown": 1.30,     // SEVERE Overspend (130%)
                "Dr. Rachel Lee": 1.22        // Overspend (122%)
            };

            const envBaseCosts = {};
            ENVIRONMENTS.forEach((env, idx) => {
                const request = REQUESTS.find(r => r.RequestId === env.RequestId);
                const multiplier = piCostMultipliers[request?.PIName] || 0.5;
                const baseAmount = request?.EnvironmentType === 'AVE' ? 4500 : 2500;
                envBaseCosts[env.EnvironmentId] = baseAmount * multiplier;
            });

            const envToRequest = {};
            ENVIRONMENTS.forEach(e => envToRequest[e.EnvironmentId] = e.RequestId);

            const requestToGrant = {}, requestToDept = {};
            REQUESTS.forEach(r => {
                requestToGrant[r.RequestId] = r.GrantId;
                requestToDept[r.RequestId] = r.DepartmentId;
            });

            months.forEach((month, monthIdx) => {
                Object.keys(envBaseCosts).forEach(envId => {
                    const env = ENVIRONMENTS.find(e => e.EnvironmentId === envId);
                    const request = REQUESTS.find(r => r.RequestId === env?.RequestId);

                    // Skip costs for completed projects after their end date
                    if (request?.RequestStatus === 'Completed') {
                        const endMonth = request.ExpectedEndDate.substring(0, 7);
                        if (month > endMonth) return;
                    }

                    const requestId = envToRequest[envId];
                    const grantId = requestToGrant[requestId];
                    const deptId = requestToDept[requestId];

                    const growthFactor = 1 + (monthIdx * 0.012);
                    const randomFactor = 0.92 + Math.random() * 0.16;
                    const baseCost = (envBaseCosts[envId] || 2000) * growthFactor * randomFactor;

                    costs.push({ BillingMonth: month, EnvironmentId: envId, DepartmentId: deptId, GrantId: grantId, CostUSD: baseCost * 0.55, ServiceCategory: 'Compute' });
                    costs.push({ BillingMonth: month, EnvironmentId: envId, DepartmentId: deptId, GrantId: grantId, CostUSD: baseCost * 0.20, ServiceCategory: 'Storage' });
                    costs.push({ BillingMonth: month, EnvironmentId: envId, DepartmentId: deptId, GrantId: grantId, CostUSD: baseCost * 0.10, ServiceCategory: 'Networking' });
                    costs.push({ BillingMonth: month, EnvironmentId: envId, DepartmentId: deptId, GrantId: grantId, CostUSD: baseCost * 0.10, ServiceCategory: 'Security' });
                    costs.push({ BillingMonth: month, EnvironmentId: envId, DepartmentId: deptId, GrantId: grantId, CostUSD: baseCost * 0.05, ServiceCategory: 'Database' });
                });
            });
            return costs;
        }

        function generateMonthlyBudgets() {
            const budgets = [];
            const months = ['2025-02', '2025-03', '2025-04', '2025-05', '2025-06', '2025-07',
                           '2025-08', '2025-09', '2025-10', '2025-11', '2025-12', '2026-01'];
            Object.keys(GRANTS).forEach(grantId => {
                const grant = GRANTS[grantId];
                const monthlyBudget = grant.budget / 12;
                months.forEach(month => {
                    budgets.push({ BillingMonth: month, GrantId: grantId, DepartmentId: grant.dept, BudgetUSD: monthlyBudget });
                });
            });
            return budgets;
        }

        const DATA = {
            requests: REQUESTS,
            environments: ENVIRONMENTS,
            costMonthly: generateMonthlyCosts(),
            budgetMonthly: generateMonthlyBudgets(),
            compliance: COMPLIANCE
        };

        // ============================================
        // GLOBAL STATE & FILTERS
        // ============================================
        let currentPersona = 'grants';
        let currentPI = 'Dr. Sarah Chen';
        let showComparisons = false;

        let globalFilters = {
            dept: 'all',
            pi: 'all',
            status: 'all',
            budgetStatus: 'all',
            envType: 'all'
        };

        let charts = {};

        // ============================================
        // GLOBAL FILTER FUNCTIONS
        // ============================================
        function applyGlobalFilters() {
            globalFilters.dept = document.getElementById('global-filter-dept').value;
            globalFilters.pi = document.getElementById('global-filter-pi').value;
            globalFilters.status = document.getElementById('global-filter-status').value;
            globalFilters.budgetStatus = document.getElementById('global-filter-budget').value;
            globalFilters.envType = document.getElementById('global-filter-env').value;

            updateActiveFiltersDisplay();
            refreshAllViews();
        }

        function resetGlobalFilters() {
            document.getElementById('global-filter-dept').value = 'all';
            document.getElementById('global-filter-pi').value = 'all';
            document.getElementById('global-filter-status').value = 'all';
            document.getElementById('global-filter-budget').value = 'all';
            document.getElementById('global-filter-env').value = 'all';
            applyGlobalFilters();
        }

        function updateActiveFiltersDisplay() {
            const container = document.getElementById('active-filters-display');
            const tagsContainer = document.getElementById('active-filter-tags');
            tagsContainer.innerHTML = '';

            let hasFilters = false;

            if (globalFilters.dept !== 'all') {
                hasFilters = true;
                tagsContainer.innerHTML += `<span class="filter-tag">${DEPARTMENTS[globalFilters.dept].name} <span class="remove" onclick="clearFilter('dept')"></span></span>`;
            }
            if (globalFilters.pi !== 'all') {
                hasFilters = true;
                tagsContainer.innerHTML += `<span class="filter-tag">${globalFilters.pi} <span class="remove" onclick="clearFilter('pi')"></span></span>`;
            }
            if (globalFilters.status !== 'all') {
                hasFilters = true;
                tagsContainer.innerHTML += `<span class="filter-tag">${globalFilters.status} <span class="remove" onclick="clearFilter('status')"></span></span>`;
            }
            if (globalFilters.budgetStatus !== 'all') {
                hasFilters = true;
                const labels = { overspend: 'Over Budget', atrisk: 'At Risk', ontrack: 'On Track', underutilized: 'Underutilized' };
                tagsContainer.innerHTML += `<span class="filter-tag">${labels[globalFilters.budgetStatus]} <span class="remove" onclick="clearFilter('budgetStatus')"></span></span>`;
            }
            if (globalFilters.envType !== 'all') {
                hasFilters = true;
                tagsContainer.innerHTML += `<span class="filter-tag">${globalFilters.envType} <span class="remove" onclick="clearFilter('envType')"></span></span>`;
            }

            container.className = hasFilters ? 'active-filters-display visible' : 'active-filters-display';
        }

        function clearFilter(filterName) {
            document.getElementById(`global-filter-${filterName === 'budgetStatus' ? 'budget' : filterName === 'envType' ? 'env' : filterName}`).value = 'all';
            applyGlobalFilters();
        }

        // Get filtered requests based on global filters
        function getFilteredRequests() {
            return REQUESTS.filter(r => {
                if (globalFilters.dept !== 'all' && r.DepartmentId !== globalFilters.dept) return false;
                if (globalFilters.pi !== 'all' && r.PIName !== globalFilters.pi) return false;
                if (globalFilters.status !== 'all') {
                    if (globalFilters.status === 'Expiring' && r.RequestStatus !== 'Expiring') return false;
                    if (globalFilters.status !== 'Expiring' && r.RequestStatus !== globalFilters.status) return false;
                }
                if (globalFilters.envType !== 'all' && r.EnvironmentType !== globalFilters.envType) return false;
                return true;
            });
        }

        function getFilteredCosts() {
            const filteredRequests = getFilteredRequests();
            const filteredEnvIds = ENVIRONMENTS.filter(e =>
                filteredRequests.some(r => r.RequestId === e.RequestId)
            ).map(e => e.EnvironmentId);

            return DATA.costMonthly.filter(c => filteredEnvIds.includes(c.EnvironmentId));
        }

        function getFilteredBudgets() {
            const filteredRequests = getFilteredRequests();
            const grantIds = [...new Set(filteredRequests.map(r => r.GrantId))];
            return DATA.budgetMonthly.filter(b => grantIds.includes(b.GrantId));
        }

        function getBudgetStatus(pct) {
            if (pct > 100) return { status: 'overspend', label: 'Over Budget', class: 'budget-overspend' };
            if (pct > 80) return { status: 'atrisk', label: 'At Risk', class: 'budget-atrisk' };
            if (pct < 30) return { status: 'underutilized', label: 'Underutilized', class: 'budget-underutilized' };
            return { status: 'ontrack', label: 'On Track', class: 'budget-ontrack' };
        }

        function getIRBStatusClass(status) {
            const statusMap = {
                'Approved': 'irb-approved',
                'Pending': 'irb-pending',
                'Under Review': 'irb-under-review',
                'Exempt': 'irb-exempt',
                'Closed': 'irb-closed'
            };
            return statusMap[status] || 'irb-pending';
        }

        function refreshAllViews() {
            if (currentPersona === 'finance') updateFinanceView();
            if (currentPersona === 'pi') updatePIView();
            if (currentPersona === 'cloudops') updateOpsView();
            if (currentPersona === 'governance') updateGovView();
            if (currentPersona === 'grants') updateGrantsView_init();
        }

        // ============================================
        // PERSONA SWITCHING
        // ============================================
        function switchPersona() {
            currentPersona = document.getElementById('persona-select').value;

            // Update current PI based on filter if in PI view
            if (currentPersona === 'pi' && globalFilters.pi !== 'all') {
                currentPI = globalFilters.pi;
            }

            updateNavigation();
            showDefaultPage();
        }

        function updateNavigation() {
            const navTabs = document.getElementById('nav-tabs');
            navTabs.innerHTML = '';

            const config = {
                finance: [{ id: 'page-finance', label: 'Cost Overview', hint: 'Leadership' }],
                pi: [{ id: 'page-pi', label: 'My Research', hint: 'Personal' }],
                cloudops: [{ id: 'page-cloudops', label: 'Compliance Triage', hint: 'IT/Security' }],
                governance: [{ id: 'page-governance', label: 'Department View', hint: 'Admin' }],
                grants: [{ id: 'page-grants', label: 'NIH RePORTER', hint: 'Research' }, { id: 'page-grants', label: 'USAspending', hint: 'Federal' }, { id: 'page-grants', label: 'Combined View', hint: 'Analysis' }]
            };

            (config[currentPersona] || []).forEach((tab, idx) => {
                const btn = document.createElement('button');
                btn.className = 'nav-tab' + (idx === 0 ? ' active' : '');
                if (currentPersona === 'grants') {
                    const subTabIds = ['nih', 'usa', 'combined'];
                    btn.onclick = function() {
                        showPage(tab.id);
                        document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        const subBtns = document.querySelectorAll('#page-grants .sub-tab');
                        if (subBtns[idx]) showGrantsSubTab(subTabIds[idx], subBtns[idx]);
                    };
                } else {
                    btn.onclick = () => showPage(tab.id);
                }
                btn.innerHTML = `${tab.label} <span class="audience-hint">${tab.hint}</span>`;
                navTabs.appendChild(btn);
            });
        }

        function showDefaultPage() {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const pageMap = { finance: 'page-finance', pi: 'page-pi', cloudops: 'page-cloudops', governance: 'page-governance', grants: 'page-grants' };
            document.getElementById(pageMap[currentPersona]).classList.add('active');
            refreshAllViews();
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            event.target.classList.add('active');
        }

        // ============================================
        // POPULATE FILTERS
        // ============================================
        function populateFilters() {
            const deptSelect = document.getElementById('global-filter-dept');
            Object.keys(DEPARTMENTS).forEach(deptId => {
                const opt = document.createElement('option');
                opt.value = deptId;
                opt.textContent = DEPARTMENTS[deptId].name;
                deptSelect.appendChild(opt);
            });

            const piSelect = document.getElementById('global-filter-pi');
            const piNames = [...new Set(REQUESTS.map(r => r.PIName))].sort();
            piNames.forEach(name => {
                const opt = document.createElement('option');
                opt.value = name;
                opt.textContent = name;
                piSelect.appendChild(opt);
            });
        }

        // ============================================
        // FINANCE VIEW
        // ============================================
        function updateFinanceView() {
            const costs = getFilteredCosts();
            const budgets = getFilteredBudgets();
            const filteredRequests = getFilteredRequests();

            const totalCost = costs.reduce((sum, c) => sum + c.CostUSD, 0);
            const totalBudget = budgets.reduce((sum, b) => sum + b.BudgetUSD, 0);
            const completedCount = filteredRequests.filter(r => r.RequestStatus === 'Completed').length;

            // Calculate overspend PIs
            const piData = calculatePIBudgetData(filteredRequests, costs, budgets);
            const overspendPIs = Object.values(piData).filter(p => p.pct > 100).length;

            document.getElementById('kpi-finance-ytd').textContent = formatCurrency(totalCost);
            document.getElementById('kpi-finance-budget').textContent = formatCurrency(totalBudget);
            document.getElementById('kpi-finance-variance').textContent = formatCurrency(totalBudget - totalCost);
            document.getElementById('kpi-finance-variance-sub').textContent = totalBudget > totalCost ? 'Under budget' : 'Over budget';
            document.getElementById('kpi-finance-overspend').textContent = overspendPIs;
            document.getElementById('kpi-finance-completed').textContent = completedCount;

            updateFinanceMatrix(filteredRequests, costs, budgets);
            updateFinanceProjectsTable(filteredRequests, costs, budgets);
            renderFinanceCharts(costs, budgets);
        }

        function updateFinanceProjectsTable(requests, costs, budgets) {
            const tbody = document.getElementById('finance-projects-tbody');
            tbody.innerHTML = '';
            document.getElementById('finance-projects-badge').textContent = `${requests.length} Projects`;

            const costByEnv = {};
            costs.forEach(c => { costByEnv[c.EnvironmentId] = (costByEnv[c.EnvironmentId] || 0) + c.CostUSD; });

            const grantBudgets = {}, grantCosts = {};
            budgets.forEach(b => { grantBudgets[b.GrantId] = (grantBudgets[b.GrantId] || 0) + b.BudgetUSD; });
            costs.forEach(c => { grantCosts[c.GrantId] = (grantCosts[c.GrantId] || 0) + c.CostUSD; });

            requests.forEach(r => {
                const env = ENVIRONMENTS.find(e => e.RequestId === r.RequestId);
                const cost = env ? (costByEnv[env.EnvironmentId] || 0) : 0;
                const grantBudget = grantBudgets[r.GrantId] || 0;
                const grantCost = grantCosts[r.GrantId] || 0;
                const budgetPct = grantBudget > 0 ? (grantCost / grantBudget * 100) : 0;
                const budgetStatus = getBudgetStatus(budgetPct);

                const today = new Date();
                const endDate = new Date(r.ExpectedEndDate);
                const daysUntil = Math.ceil((endDate - today) / 86400000);

                let status = r.RequestStatus, statusClass = 'status-active';
                if (r.RequestStatus === 'Completed') { statusClass = 'status-completed'; }
                else if (daysUntil <= 0) { status = 'Expired'; statusClass = 'status-expired'; }
                else if (daysUntil <= 30) { status = 'Expiring'; statusClass = 'status-expiring'; }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="servicenow-ticket">${r.RequestId}</span></td>
                    <td>${r.CatalogItemName}</td>
                    <td><span class="grant-name">${GRANTS[r.GrantId]?.name || r.GrantId}</span></td>
                    <td><span class="irb-number">${r.IRBNumber || 'N/A'}</span></td>
                    <td><span class="irb-status-badge ${getIRBStatusClass(r.IRBStatus)}">${r.IRBStatus || 'N/A'}</span></td>
                    <td>${r.PIName}</td>
                    <td>${DEPARTMENTS[r.DepartmentId]?.name || r.DepartmentId}</td>
                    <td><span class="env-type-badge ${r.EnvironmentType === 'AVE' ? 'env-ave' : 'env-standard'}">${r.EnvironmentType}</span></td>
                    <td class="text-right">${formatCurrency(cost / 12)}</td>
                    <td><span class="budget-status-badge ${budgetStatus.class}">${budgetStatus.label}</span></td>
                    <td>${formatDate(r.ExpectedEndDate)}</td>
                    <td><span class="status-badge ${statusClass}">${status}</span></td>
                `;
                tbody.appendChild(row);
            });
        }

        function calculatePIBudgetData(requests, costs, budgets) {
            const piData = {};
            const costByEnv = {};
            costs.forEach(c => { costByEnv[c.EnvironmentId] = (costByEnv[c.EnvironmentId] || 0) + c.CostUSD; });

            const grantBudgets = {};
            budgets.forEach(b => { grantBudgets[b.GrantId] = (grantBudgets[b.GrantId] || 0) + b.BudgetUSD; });

            requests.forEach(r => {
                if (!piData[r.PIName]) {
                    piData[r.PIName] = { cost: 0, budget: 0, dept: r.DepartmentId, division: r.Division, projects: 0, completed: 0, active: 0 };
                }
                const env = ENVIRONMENTS.find(e => e.RequestId === r.RequestId);
                if (env) piData[r.PIName].cost += costByEnv[env.EnvironmentId] || 0;
                piData[r.PIName].budget += grantBudgets[r.GrantId] || 0;
                piData[r.PIName].projects++;
                if (r.RequestStatus === 'Completed') piData[r.PIName].completed++;
                else piData[r.PIName].active++;
            });

            Object.keys(piData).forEach(pi => {
                piData[pi].pct = piData[pi].budget > 0 ? (piData[pi].cost / piData[pi].budget * 100) : 0;
            });

            return piData;
        }

        function updateFinanceMatrix(requests, costs, budgets) {
            const tbody = document.getElementById('finance-matrix-tbody');
            tbody.innerHTML = '';

            const piData = calculatePIBudgetData(requests, costs, budgets);

            // Apply budget status filter
            let filteredPIs = Object.keys(piData);
            if (globalFilters.budgetStatus !== 'all') {
                filteredPIs = filteredPIs.filter(pi => {
                    const status = getBudgetStatus(piData[pi].pct).status;
                    return status === globalFilters.budgetStatus;
                });
            }

            // Group by department
            const deptGroups = {};
            filteredPIs.forEach(pi => {
                const dept = piData[pi].dept;
                if (!deptGroups[dept]) deptGroups[dept] = [];
                deptGroups[dept].push(pi);
            });

            let grandCost = 0, grandBudget = 0;

            Object.keys(deptGroups).sort().forEach(deptId => {
                const pis = deptGroups[deptId];
                let deptCost = 0, deptBudget = 0, deptProjects = 0;

                pis.forEach(pi => {
                    deptCost += piData[pi].cost;
                    deptBudget += piData[pi].budget;
                    deptProjects += piData[pi].projects;
                });

                grandCost += deptCost;
                grandBudget += deptBudget;

                const deptPct = deptBudget > 0 ? (deptCost / deptBudget * 100) : 0;
                const deptStatus = getBudgetStatus(deptPct);

                // Department row
                const deptRow = document.createElement('tr');
                deptRow.className = 'row-header expandable-row';
                deptRow.onclick = () => toggleExpand(deptId);
                deptRow.innerHTML = `
                    <td><span class="expand-icon" id="expand-${deptId}"><span class="material-icons" style="font-size:14px;">chevron_right</span></span> <strong>${DEPARTMENTS[deptId].name}</strong></td>
                    <td>${formatCurrency(deptCost)}</td>
                    <td>${formatCurrency(deptBudget)}</td>
                    <td class="${deptBudget - deptCost >= 0 ? 'variance-positive' : 'variance-negative'}">${formatCurrency(deptBudget - deptCost)}</td>
                    <td>${deptPct.toFixed(1)}%</td>
                    <td><span class="budget-status-badge ${deptStatus.class}">${deptStatus.label}</span></td>
                    <td>${deptProjects}</td>
                `;
                tbody.appendChild(deptRow);

                // PI rows
                pis.sort().forEach(pi => {
                    const p = piData[pi];
                    const status = getBudgetStatus(p.pct);
                    const piRow = document.createElement('tr');
                    piRow.className = 'child-row';
                    piRow.dataset.parent = deptId;
                    piRow.innerHTML = `
                        <td style="padding-left: 40px;">${pi} <span style="color:#888;font-size:11px;">(${p.division})</span></td>
                        <td>${formatCurrency(p.cost)}</td>
                        <td>${formatCurrency(p.budget)}</td>
                        <td class="${p.budget - p.cost >= 0 ? 'variance-positive' : 'variance-negative'}">${formatCurrency(p.budget - p.cost)}</td>
                        <td>${p.pct.toFixed(1)}%</td>
                        <td><span class="budget-status-badge ${status.class}">${status.label}</span></td>
                        <td>${p.active} active, ${p.completed} done</td>
                    `;
                    tbody.appendChild(piRow);
                });
            });

            // Grand total
            const grandPct = grandBudget > 0 ? (grandCost / grandBudget * 100) : 0;
            const totalRow = document.createElement('tr');
            totalRow.className = 'subtotal';
            totalRow.innerHTML = `
                <td><strong>Grand Total</strong></td>
                <td><strong>${formatCurrency(grandCost)}</strong></td>
                <td><strong>${formatCurrency(grandBudget)}</strong></td>
                <td class="${grandBudget - grandCost >= 0 ? 'variance-positive' : 'variance-negative'}"><strong>${formatCurrency(grandBudget - grandCost)}</strong></td>
                <td><strong>${grandPct.toFixed(1)}%</strong></td>
                <td></td>
                <td><strong>${requests.length}</strong></td>
            `;
            tbody.appendChild(totalRow);
        }

        function toggleExpand(id) {
            const icon = document.getElementById(`expand-${id}`);
            const rows = document.querySelectorAll(`tr[data-parent="${id}"]`);
            const expanded = icon.classList.toggle('expanded');
            rows.forEach(r => r.classList.toggle('visible', expanded));
        }

        function renderFinanceCharts(costs, budgets) {
            // Trend Chart
            const ctx1 = document.getElementById('financeSpendTrendChart');
            if (ctx1) {
                if (charts.financeSpendTrend) charts.financeSpendTrend.destroy();
                const months = [...new Set(costs.map(c => c.BillingMonth))].sort();
                const monthlyTotals = {}, monthlyBudgets = {};
                months.forEach(m => {
                    monthlyTotals[m] = costs.filter(c => c.BillingMonth === m).reduce((sum, c) => sum + c.CostUSD, 0);
                    monthlyBudgets[m] = budgets.filter(b => b.BillingMonth === m).reduce((sum, b) => sum + b.BudgetUSD, 0);
                });

                charts.financeSpendTrend = new Chart(ctx1, {
                    type: 'line',
                    data: {
                        labels: months.map(formatMonth),
                        datasets: [
                            { label: 'Actual', data: months.map(m => monthlyTotals[m]), borderColor: '#00274C', backgroundColor: 'rgba(0,39,76,0.1)', fill: true, tension: 0.3 },
                            { label: 'Budget', data: months.map(m => monthlyBudgets[m]), borderColor: '#FFCB05', borderDash: [5, 5], fill: false }
                        ]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { position: 'bottom' } },
                        scales: { y: { beginAtZero: true, ticks: { callback: v => '$' + (v/1000).toFixed(0) + 'K' } } }
                    }
                });
            }

            // Budget Chart
            const ctx2 = document.getElementById('financeBudgetChart');
            if (ctx2) {
                if (charts.financeBudget) charts.financeBudget.destroy();
                const deptTotals = {}, deptBudgets = {};
                costs.forEach(c => { deptTotals[c.DepartmentId] = (deptTotals[c.DepartmentId] || 0) + c.CostUSD; });
                budgets.forEach(b => { deptBudgets[b.DepartmentId] = (deptBudgets[b.DepartmentId] || 0) + b.BudgetUSD; });
                const depts = Object.keys(deptTotals);

                charts.financeBudget = new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: depts.map(d => DEPARTMENTS[d]?.name || d),
                        datasets: [
                            { label: 'Actual', data: depts.map(d => deptTotals[d]), backgroundColor: '#00274C' },
                            { label: 'Budget', data: depts.map(d => deptBudgets[d]), backgroundColor: '#FFCB05' }
                        ]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { position: 'bottom' } },
                        scales: { y: { beginAtZero: true, ticks: { callback: v => '$' + (v/1000).toFixed(0) + 'K' } } }
                    }
                });
            }
        }

        // ============================================
        // PI VIEW
        // ============================================
        function updatePIView() {
            // Use global PI filter if set, otherwise use currentPI
            const selectedPI = globalFilters.pi !== 'all' ? globalFilters.pi : currentPI;

            let piRequests = REQUESTS.filter(r => r.PIName === selectedPI);

            // Apply other global filters
            if (globalFilters.dept !== 'all') piRequests = piRequests.filter(r => r.DepartmentId === globalFilters.dept);
            if (globalFilters.status !== 'all') {
                if (globalFilters.status === 'Expiring') piRequests = piRequests.filter(r => r.RequestStatus === 'Expiring');
                else piRequests = piRequests.filter(r => r.RequestStatus === globalFilters.status);
            }
            if (globalFilters.envType !== 'all') piRequests = piRequests.filter(r => r.EnvironmentType === globalFilters.envType);

            const piEnvIds = ENVIRONMENTS.filter(e => piRequests.some(r => r.RequestId === e.RequestId)).map(e => e.EnvironmentId);
            const piGrantIds = [...new Set(piRequests.map(r => r.GrantId))];

            const piCosts = DATA.costMonthly.filter(c => piEnvIds.includes(c.EnvironmentId));
            const piBudgets = DATA.budgetMonthly.filter(b => piGrantIds.includes(b.GrantId));

            const totalCost = piCosts.reduce((sum, c) => sum + c.CostUSD, 0);
            const totalBudget = piBudgets.reduce((sum, b) => sum + b.BudgetUSD, 0);
            const budgetPct = totalBudget > 0 ? (totalCost / totalBudget * 100) : 0;

            // Update banner
            const initials = selectedPI.replace('Dr. ', '').split(' ').map(n => n[0]).join('');
            document.getElementById('pi-avatar').textContent = initials;
            document.getElementById('pi-name').textContent = selectedPI;
            const deptId = piRequests[0]?.DepartmentId;
            document.getElementById('pi-dept').textContent = deptId ? `Department of ${DEPARTMENTS[deptId].name}` : '';

            const today = new Date();
            const expiring = piRequests.filter(r => {
                if (r.RequestStatus === 'Completed') return false;
                const days = Math.ceil((new Date(r.ExpectedEndDate) - today) / 86400000);
                return days > 0 && days <= 30;
            }).length;

            const activeProjects = piRequests.filter(r => r.RequestStatus === 'Active' || r.RequestStatus === 'Expiring').length;

            document.getElementById('kpi-pi-spend').textContent = formatCurrency(totalCost);
            document.getElementById('kpi-pi-remaining').textContent = formatCurrency(totalBudget - totalCost);
            document.getElementById('kpi-pi-pct').textContent = `${budgetPct.toFixed(0)}% of budget used`;
            document.getElementById('kpi-pi-expiring').textContent = expiring;
            document.getElementById('kpi-pi-projects').textContent = activeProjects;

            updatePITables(piRequests, piCosts, piBudgets, piGrantIds);
        }

        function updatePITables(requests, costs, budgets, grantIds) {
            // Projects table
            const tbody = document.getElementById('pi-projects-tbody');
            tbody.innerHTML = '';
            document.getElementById('pi-project-count').textContent = `${requests.length} Projects`;

            const costByEnv = {};
            costs.forEach(c => { costByEnv[c.EnvironmentId] = (costByEnv[c.EnvironmentId] || 0) + c.CostUSD; });

            const grantBudgets = {}, grantCosts = {};
            budgets.forEach(b => { grantBudgets[b.GrantId] = (grantBudgets[b.GrantId] || 0) + b.BudgetUSD; });
            costs.forEach(c => { grantCosts[c.GrantId] = (grantCosts[c.GrantId] || 0) + c.CostUSD; });

            requests.forEach(r => {
                const env = ENVIRONMENTS.find(e => e.RequestId === r.RequestId);
                const cost = env ? (costByEnv[env.EnvironmentId] || 0) : 0;
                const grantBudget = grantBudgets[r.GrantId] || 0;
                const grantCost = grantCosts[r.GrantId] || 0;
                const budgetPct = grantBudget > 0 ? (grantCost / grantBudget * 100) : 0;
                const progressClass = budgetPct > 100 ? 'danger' : budgetPct > 80 ? 'warning' : 'good';

                const today = new Date();
                const endDate = new Date(r.ExpectedEndDate);
                const daysUntil = Math.ceil((endDate - today) / 86400000);

                let status = r.RequestStatus, statusClass = 'status-active';
                if (r.RequestStatus === 'Completed') { statusClass = 'status-completed'; }
                else if (daysUntil <= 0) { status = 'Expired'; statusClass = 'status-expired'; }
                else if (daysUntil <= 30) { status = 'Expiring'; statusClass = 'status-expiring'; }

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="servicenow-ticket">${r.RequestId}</span></td>
                    <td>${r.CatalogItemName}</td>
                    <td><span class="grant-name">${GRANTS[r.GrantId]?.name || r.GrantId}</span></td>
                    <td><span class="irb-number">${r.IRBNumber || 'N/A'}</span></td>
                    <td><span class="irb-status-badge ${getIRBStatusClass(r.IRBStatus)}">${r.IRBStatus || 'N/A'}</span></td>
                    <td><span class="env-type-badge ${r.EnvironmentType === 'AVE' ? 'env-ave' : 'env-standard'}">${r.EnvironmentType}</span></td>
                    <td class="text-right">${formatCurrency(cost / 12)}</td>
                    <td>
                        <div style="min-width:80px;">
                            <div style="font-size:11px;color:#666;">${budgetPct.toFixed(0)}%</div>
                            <div class="progress-bar"><div class="progress-fill ${progressClass}" style="width:${Math.min(budgetPct, 100)}%"></div></div>
                        </div>
                    </td>
                    <td>${formatDate(r.ExpectedEndDate)}</td>
                    <td><span class="status-badge ${statusClass}">${status}</span></td>
                `;
                tbody.appendChild(row);
            });

            // Grants table
            const grantsTbody = document.getElementById('pi-grants-tbody');
            grantsTbody.innerHTML = '';

            grantIds.forEach(grantId => {
                const cost = grantCosts[grantId] || 0;
                const budget = grantBudgets[grantId] || 0;
                const pct = budget > 0 ? (cost / budget * 100) : 0;
                const progressClass = pct > 100 ? 'danger' : pct > 80 ? 'warning' : 'good';
                const status = getBudgetStatus(pct);

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${GRANTS[grantId]?.name || grantId}</td>
                    <td class="text-right">${formatCurrency(cost)}</td>
                    <td class="text-right">${formatCurrency(budget)}</td>
                    <td class="text-right ${budget - cost >= 0 ? 'variance-positive' : 'variance-negative'}">${formatCurrency(budget - cost)}</td>
                    <td>
                        <div style="min-width:100px;">
                            <div style="font-size:11px;color:#666;">${pct.toFixed(0)}%</div>
                            <div class="progress-bar"><div class="progress-fill ${progressClass}" style="width:${Math.min(pct, 100)}%"></div></div>
                        </div>
                    </td>
                    <td><span class="budget-status-badge ${status.class}">${status.label}</span></td>
                `;
                grantsTbody.appendChild(row);
            });
        }

        // ============================================
        // CLOUD OPS VIEW
        // ============================================
        function updateOpsView() {
            let compliance = DATA.compliance.filter(c => {
                const env = ENVIRONMENTS.find(e => e.EnvironmentId === c.EnvironmentId);
                const request = env ? REQUESTS.find(r => r.RequestId === env.RequestId) : null;

                if (globalFilters.dept !== 'all' && request?.DepartmentId !== globalFilters.dept) return false;
                if (globalFilters.pi !== 'all' && request?.PIName !== globalFilters.pi) return false;
                if (globalFilters.envType !== 'all') {
                    const isAVE = c.EnvironmentId.startsWith('AVE');
                    if (globalFilters.envType === 'AVE' && !isAVE) return false;
                    if (globalFilters.envType === 'Standard' && isAVE) return false;
                }
                return true;
            });

            const openIssues = compliance.filter(c => c.NonCompliantFlag && c.RemediationStatus !== 'Closed');
            const bySeverity = { Critical: 0, High: 0, Medium: 0, Low: 0 };
            openIssues.forEach(c => { bySeverity[c.Severity]++; });

            document.getElementById('triage-critical').textContent = bySeverity.Critical;
            document.getElementById('triage-high').textContent = bySeverity.High;
            document.getElementById('triage-medium').textContent = bySeverity.Medium;
            document.getElementById('triage-low').textContent = bySeverity.Low;

            const filteredEnvs = getFilteredRequests().length;
            const compliantCount = compliance.filter(c => !c.NonCompliantFlag || c.RemediationStatus === 'Closed').length;
            const complianceRate = compliance.length > 0 ? (compliantCount / compliance.length * 100) : 100;
            const estSavings = openIssues.reduce((sum, c) => sum + c.EstimatedMonthlyImpactUSD, 0);

            document.getElementById('kpi-ops-issues').textContent = openIssues.length;
            document.getElementById('kpi-ops-envs').textContent = filteredEnvs;
            document.getElementById('kpi-ops-rate').textContent = `${complianceRate.toFixed(0)}%`;
            document.getElementById('kpi-ops-savings').textContent = formatCurrency(estSavings);
            document.getElementById('ops-compliance-badge').textContent = `${openIssues.length} Open`;

            // Compliance table
            const tbody = document.getElementById('ops-compliance-tbody');
            tbody.innerHTML = '';

            const severityOrder = { Critical: 0, High: 1, Medium: 2, Low: 3 };
            const sorted = [...compliance].sort((a, b) => severityOrder[a.Severity] - severityOrder[b.Severity]);

            sorted.forEach(c => {
                const env = ENVIRONMENTS.find(e => e.EnvironmentId === c.EnvironmentId);
                const request = env ? REQUESTS.find(r => r.RequestId === env.RequestId) : null;

                let statusClass = 'status-open';
                if (c.RemediationStatus === 'Closed') statusClass = 'status-closed';
                else if (c.RemediationStatus === 'Pending') statusClass = 'status-pending';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><span class="servicenow-ticket">${request?.RequestId || 'N/A'}</span></td>
                    <td><span class="grant-name">${request ? (GRANTS[request.GrantId]?.name || request.GrantId) : 'N/A'}</span></td>
                    <td><span class="irb-number">${request?.IRBNumber || 'N/A'}</span></td>
                    <td><span class="irb-status-badge ${getIRBStatusClass(request?.IRBStatus)}">${request?.IRBStatus || 'N/A'}</span></td>
                    <td><span class="severity-badge severity-${c.Severity.toLowerCase()}">${c.Severity}</span></td>
                    <td><span class="issue-type-badge issue-${c.IssueType.toLowerCase()}">${c.IssueType}</span></td>
                    <td>${c.EnvironmentId}</td>
                    <td>${request?.PIName || 'N/A'}</td>
                    <td>${c.ViolationType}</td>
                    <td class="text-right">${formatCurrency(c.EstimatedMonthlyImpactUSD)}</td>
                    <td><span class="status-badge ${statusClass}">${c.RemediationStatus}</span></td>
                `;
                tbody.appendChild(row);
            });

            renderOpsCharts(compliance);
        }

        function renderOpsCharts(compliance) {
            const ctx1 = document.getElementById('opsIssueTypeChart');
            if (ctx1) {
                if (charts.opsIssueType) charts.opsIssueType.destroy();
                const byType = { Security: 0, Cost: 0, Hygiene: 0 };
                compliance.filter(c => c.NonCompliantFlag).forEach(c => { byType[c.IssueType]++; });

                charts.opsIssueType = new Chart(ctx1, {
                    type: 'doughnut',
                    data: {
                        labels: Object.keys(byType),
                        datasets: [{ data: Object.values(byType), backgroundColor: ['#C62828', '#1565C0', '#6A1B9A'], borderWidth: 2, borderColor: '#fff' }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
                });
            }

            const ctx2 = document.getElementById('opsSeverityChart');
            if (ctx2) {
                if (charts.opsSeverity) charts.opsSeverity.destroy();
                const bySev = { Critical: 0, High: 0, Medium: 0, Low: 0 };
                compliance.filter(c => c.NonCompliantFlag).forEach(c => { bySev[c.Severity]++; });

                charts.opsSeverity = new Chart(ctx2, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(bySev),
                        datasets: [{ data: Object.values(bySev), backgroundColor: ['#C62828', '#E65100', '#F9A825', '#9E9E9E'] }]
                    },
                    options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true } } }
                });
            }
        }

        // ============================================
        // GOVERNANCE VIEW
        // ============================================
        function toggleComparisons() {
            showComparisons = document.getElementById('toggle-comparisons').checked;
            document.getElementById('comparison-section').style.display = showComparisons ? 'block' : 'none';
            if (showComparisons) renderGovCharts();
        }

        function updateGovView() {
            const deptId = globalFilters.dept !== 'all' ? globalFilters.dept : 'DEPT-CARD';

            let deptRequests = REQUESTS.filter(r => r.DepartmentId === deptId);
            if (globalFilters.pi !== 'all') deptRequests = deptRequests.filter(r => r.PIName === globalFilters.pi);
            if (globalFilters.status !== 'all') {
                if (globalFilters.status === 'Expiring') deptRequests = deptRequests.filter(r => r.RequestStatus === 'Expiring');
                else deptRequests = deptRequests.filter(r => r.RequestStatus === globalFilters.status);
            }
            if (globalFilters.envType !== 'all') deptRequests = deptRequests.filter(r => r.EnvironmentType === globalFilters.envType);

            const deptPIs = [...new Set(deptRequests.map(r => r.PIName))];
            const deptEnvIds = ENVIRONMENTS.filter(e => deptRequests.some(r => r.RequestId === e.RequestId)).map(e => e.EnvironmentId);
            const deptGrantIds = [...new Set(deptRequests.map(r => r.GrantId))];

            const deptCosts = DATA.costMonthly.filter(c => deptEnvIds.includes(c.EnvironmentId));
            const deptBudgets = DATA.budgetMonthly.filter(b => deptGrantIds.includes(b.GrantId));

            const totalCost = deptCosts.reduce((sum, c) => sum + c.CostUSD, 0);
            const totalBudget = deptBudgets.reduce((sum, b) => sum + b.BudgetUSD, 0);

            const deptCompliance = DATA.compliance.filter(c => deptEnvIds.includes(c.EnvironmentId));
            const compliant = deptCompliance.filter(c => !c.NonCompliantFlag || c.RemediationStatus === 'Closed').length;
            const compRate = deptCompliance.length > 0 ? (compliant / deptCompliance.length * 100) : 100;

            // PI Table
            const tbody = document.getElementById('gov-pi-tbody');
            tbody.innerHTML = '';

            const costByEnv = {};
            DATA.costMonthly.forEach(c => { costByEnv[c.EnvironmentId] = (costByEnv[c.EnvironmentId] || 0) + c.CostUSD; });

            const grantBudgets = {};
            DATA.budgetMonthly.forEach(b => { grantBudgets[b.GrantId] = (grantBudgets[b.GrantId] || 0) + b.BudgetUSD; });

            // Pre-calculate PI budget status for filtering
            const piDataForFilter = {};
            deptPIs.forEach(piName => {
                const piRequests = deptRequests.filter(r => r.PIName === piName);
                const piEnvIds = ENVIRONMENTS.filter(e => piRequests.some(r => r.RequestId === e.RequestId)).map(e => e.EnvironmentId);
                let piCost = 0, piBudget = 0;
                piEnvIds.forEach(envId => { piCost += costByEnv[envId] || 0; });
                piRequests.forEach(r => { piBudget += grantBudgets[r.GrantId] || 0; });
                const pct = piBudget > 0 ? (piCost / piBudget * 100) : 0;
                piDataForFilter[piName] = { cost: piCost, budget: piBudget, pct, status: getBudgetStatus(pct), requests: piRequests, envIds: piEnvIds };
            });

            // Apply budget status filter
            let filteredPIs = deptPIs;
            if (globalFilters.budgetStatus !== 'all') {
                filteredPIs = deptPIs.filter(pi => piDataForFilter[pi].status.status === globalFilters.budgetStatus);
            }

            // Calculate totals from filtered PIs
            let filteredCost = 0, filteredBudget = 0;
            filteredPIs.forEach(pi => {
                filteredCost += piDataForFilter[pi].cost;
                filteredBudget += piDataForFilter[pi].budget;
            });

            document.getElementById('kpi-gov-spend').textContent = formatCurrency(filteredCost);
            document.getElementById('kpi-gov-budget').textContent = formatCurrency(filteredBudget);
            document.getElementById('kpi-gov-pis').textContent = filteredPIs.length;
            document.getElementById('kpi-gov-compliance').textContent = `${compRate.toFixed(0)}%`;
            document.getElementById('gov-pi-badge').textContent = `${filteredPIs.length} PIs`;

            filteredPIs.forEach(piName => {
                const p = piDataForFilter[piName];
                const progressClass = p.pct > 100 ? 'danger' : p.pct > 80 ? 'warning' : 'good';
                const division = p.requests[0]?.Division || 'N/A';
                const activeCount = p.requests.filter(r => r.RequestStatus !== 'Completed').length;

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${piName}</td>
                    <td>${division}</td>
                    <td class="text-right">${formatCurrency(p.cost)}</td>
                    <td class="text-right">${formatCurrency(p.budget)}</td>
                    <td>
                        <div style="min-width:80px;">
                            <div style="font-size:11px;color:#666;">${p.pct.toFixed(0)}%</div>
                            <div class="progress-bar"><div class="progress-fill ${progressClass}" style="width:${Math.min(p.pct, 100)}%"></div></div>
                        </div>
                    </td>
                    <td><span class="budget-status-badge ${p.status.class}">${p.status.label}</span></td>
                    <td>${activeCount}</td>
                `;
                tbody.appendChild(row);
            });

            if (showComparisons) renderGovCharts();
        }

        function renderGovCharts() {
            // Placeholder for governance charts
        }

        // ============================================
        // UTILITIES
        // ============================================
        function formatCurrency(v) {
            return '$' + v.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function formatDate(d) {
            return new Date(d).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        }

        function formatMonth(m) {
            const [y, mo] = m.split('-');
            return new Date(y, parseInt(mo) - 1).toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
        }


        // ============================================
        // RESEARCH GRANTS CONTEXT
        // ============================================

        const GRANT_INSTITUTIONS = [
            { id: 'umich', name: 'University of Michigan', nihName: 'UNIVERSITY OF MICHIGAN', usaName: 'REGENTS OF THE UNIVERSITY OF MICHIGAN' },
            { id: 'uw', name: 'University of Washington', nihName: 'UNIVERSITY OF WASHINGTON', usaName: 'UNIVERSITY OF WASHINGTON' },
            { id: 'jhu', name: 'Johns Hopkins University', nihName: 'JOHNS HOPKINS UNIVERSITY', usaName: 'THE JOHNS HOPKINS UNIVERSITY' },
            { id: 'ucsf', name: 'UCSF', nihName: 'UNIVERSITY OF CALIFORNIA SAN FRANCISCO', usaName: 'UNIVERSITY OF CALIFORNIA, SAN FRANCISCO' },
            { id: 'mayo', name: 'Mayo Clinic', nihName: 'MAYO CLINIC ROCHESTER', usaName: 'MAYO CLINIC' },
            { id: 'duke', name: 'Duke University', nihName: 'DUKE UNIVERSITY', usaName: 'DUKE UNIVERSITY' },
            { id: 'stanford', name: 'Stanford University', nihName: 'STANFORD UNIVERSITY', usaName: 'THE BOARD OF TRUSTEES OF THE LELAND STANFORD JUNIOR UNIVERSITY' },
            { id: 'ucla', name: 'UCLA', nihName: 'UNIVERSITY OF CALIFORNIA LOS ANGELES', usaName: 'REGENTS OF THE UNIVERSITY OF CALIFORNIA, LOS ANGELES' },
            { id: 'vanderbilt', name: 'Vanderbilt', nihName: 'VANDERBILT UNIVERSITY MEDICAL CENTER', usaName: 'VANDERBILT UNIVERSITY MEDICAL CENTER' },
            { id: 'penn', name: 'Penn Medicine', nihName: 'UNIVERSITY OF PENNSYLVANIA', usaName: 'TRUSTEES OF THE UNIVERSITY OF PENNSYLVANIA' }
        ];

        let grantsNIHData = [];
        let grantsUSAData = [];
        let grantsFiltered = { nih: [], usa: [] };
        let grantsLiveMode = false;

        function buildInstitutionCheckboxes() {
            const container = document.getElementById('institution-checkboxes');
            if (!container) return;
            container.innerHTML = '';
            GRANT_INSTITUTIONS.forEach(inst => {
                const label = document.createElement('label');
                if (inst.id === 'umich') label.classList.add('umm-highlight');
                const checked = inst.id === 'umich' ? ' checked' : '';
                label.innerHTML = '<input type="checkbox" value="' + inst.id + '"' + checked + ' onchange="applyGrantsFilters()"> ' + inst.name;
                container.appendChild(label);
            });
        }

        function toggleAllInstitutions() {
            var checkboxes = document.querySelectorAll('#institution-checkboxes input[type="checkbox"]');
            var allChecked = Array.from(checkboxes).every(function(cb) { return cb.checked; });
            var btn = document.querySelector('.institution-toggle-link');
            if (allChecked) {
                checkboxes.forEach(function(cb) { cb.checked = false; });
                var umm = document.querySelector('#institution-checkboxes input[value="umich"]');
                if (umm) umm.checked = true;
                if (btn) btn.textContent = 'Select All';
            } else {
                checkboxes.forEach(function(cb) { cb.checked = true; });
                if (btn) btn.textContent = 'UMM Only';
            }
            applyGrantsFilters();
        }

        function getSelectedInstitutions() {
            return ['umich'];
        }

        function normalizeOrgName(name) {
            if (!name) return '';
            return name.toUpperCase()
                .replace(/^(THE |REGENTS OF THE |TRUSTEES OF THE |THE BOARD OF TRUSTEES OF THE LELAND )/i, '')
                .replace(/,/g, '')
                .replace(/\s+/g, ' ')
                .trim();
        }

        function nihOrgToInstId(orgName) {
            const n = (orgName || '').toUpperCase();
            for (const inst of GRANT_INSTITUTIONS) {
                if (n.includes(inst.nihName) || inst.nihName.includes(n)) return inst.id;
            }
            return null;
        }

        function usaRecipientToInstId(recipientName) {
            const n = (recipientName || '').toUpperCase();
            for (const inst of GRANT_INSTITUTIONS) {
                if (n.includes(inst.usaName) || inst.usaName.includes(n) || normalizeOrgName(n) === normalizeOrgName(inst.usaName)) return inst.id;
            }
            return null;
        }

        function guessDepartment(text) {
            if (!text) return 'General';
            const t = text.toLowerCase();
            if (/cardio|heart|cardiac|coronary|vascular/.test(t)) return 'Cardiology';
            if (/neuro|brain|alzheimer|parkinson|stroke|neural/.test(t)) return 'Neurology';
            if (/cancer|oncol|tumor|leukemia|lymphoma|carcinoma/.test(t)) return 'Oncology';
            if (/immuno|allerg|autoimmun|vaccine|infection|hiv|viral|antimicrob/.test(t)) return 'Immunology';
            if (/diabet|kidney|renal|pancrea|endocrin/.test(t)) return 'Endocrinology';
            if (/pediatr|child|neonat/.test(t)) return 'Pediatrics';
            if (/psych|mental|depress|anxiety|schizo/.test(t)) return 'Psychiatry';
            if (/surg|transplant|trauma/.test(t)) return 'Surgery';
            if (/genom|gene|dna|rna|crispr/.test(t)) return 'Genomics';
            if (/radiol|imaging|mri|ct scan/.test(t)) return 'Radiology';
            if (/ophthalm|eye|retina|vision/.test(t)) return 'Ophthalmology';
            if (/pulmon|lung|respiratory|asthma/.test(t)) return 'Pulmonology';
            return 'General';
        }

        async function loadGrantsData() {
            const progress = document.getElementById('grants-progress');
            const isLive = document.getElementById('grants-live-toggle') ? document.getElementById('grants-live-toggle').checked : false;

            if (isLive) {
                progress.style.display = 'block';
                progress.textContent = 'Fetching live data from APIs...';
                try {
                    await fetchLiveGrantsData(progress);
                } catch(e) {
                    console.error('Live fetch failed:', e);
                    progress.textContent = 'Live fetch failed (possibly CORS). Falling back to sample data...';
                    await loadOfflineGrantsData();
                }
                progress.style.display = 'none';
            } else {
                await loadOfflineGrantsData();
            }
            applyGrantsFilters();
        }

        async function loadOfflineGrantsData() {
            try {
                const [nihResp, usaResp] = await Promise.all([
                    fetch('data/nih_sample.json').then(function(r) { return r.ok ? r.json() : Promise.reject('NIH file not found'); }),
                    fetch('data/usaspending_sample.json').then(function(r) { return r.ok ? r.json() : Promise.reject('USA file not found'); })
                ]);
                grantsNIHData = nihResp;
                grantsUSAData = usaResp;
            } catch(e) {
                console.warn('Could not load JSON files, using embedded sample:', e);
                grantsNIHData = generateEmbeddedNIHSample();
                grantsUSAData = generateEmbeddedUSASample();
            }
        }

        async function fetchLiveGrantsData(progress) {
            var nihResults = [];
            var usaResults = [];

            for (var i = 0; i < GRANT_INSTITUTIONS.length; i++) {
                var inst = GRANT_INSTITUTIONS[i];
                var selected = getSelectedInstitutions();
                if (!selected.includes(inst.id)) continue;
                progress.textContent = 'Fetching ' + (i+1) + '/' + GRANT_INSTITUTIONS.length + ': ' + inst.name + '...';

                try {
                    var nihResp = await fetch('https://api.reporter.nih.gov/v2/projects/search', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            criteria: { org_names: [inst.nihName], fiscal_years: [2023,2024,2025], advanced_text_search: { search_field: 'terms', search_text: 'cancer' } },
                            offset: 0, limit: 50
                        })
                    });
                    var nihData = await nihResp.json();
                    (nihData.results || []).forEach(function(p) {
                        var pis = p.principal_investigators || [];
                        var fundings = p.agency_ic_fundings || [];
                        nihResults.push({
                            project_num: p.project_num, project_title: p.project_title, abstract: p.abstract_text || '',
                            fiscal_year: p.fiscal_year, award_amount: p.award_amount || 0,
                            org_name: (p.organization || {}).org_name || inst.nihName,
                            pi_name: pis.length > 0 ? pis[0].full_name : 'Unknown',
                            nih_institute: fundings.length > 0 ? fundings[0].abbreviation : '',
                            activity_code: p.activity_code || '', project_start: p.project_start_date || '', project_end: p.project_end_date || ''
                        });
                    });
                } catch(e) { console.warn('NIH fetch failed for ' + inst.name + ':', e); }

                try {
                    var usaResp = await fetch('https://api.usaspending.gov/api/v2/search/spending_by_award/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            filters: { recipient_search_text: [inst.usaName], time_period: [{start_date:'2022-10-01',end_date:'2023-09-30'},{start_date:'2023-10-01',end_date:'2024-09-30'},{start_date:'2024-10-01',end_date:'2025-09-30'}], keywords: ['cancer'] },
                            fields: ['Award ID','Recipient Name','Awarding Agency','Funding Agency','Award Amount','Start Date','End Date','Award Type','Description'],
                            page: 1, limit: 50, sort: 'Award Amount', order: 'desc'
                        })
                    });
                    var usaData = await usaResp.json();
                    (usaData.results || []).forEach(function(a) {
                        var startDate = a['Start Date'] || '';
                        var fy = startDate ? parseInt(startDate.substring(0,4)) + (parseInt(startDate.substring(5,7)) >= 10 ? 1 : 0) : 2024;
                        usaResults.push({
                            award_id: a['Award ID'] || '', recipient_name: a['Recipient Name'] || inst.usaName,
                            awarding_agency: a['Awarding Agency'] || '', funding_agency: a['Funding Agency'] || '',
                            fiscal_year: fy, award_amount: a['Award Amount'] || 0,
                            award_type: a['Award Type'] || 'Grant', description: a['Description'] || '', pi_name: ''
                        });
                    });
                } catch(e) { console.warn('USAspending fetch failed for ' + inst.name + ':', e); }

                await new Promise(function(r) { setTimeout(r, 300); });
            }

            grantsNIHData = nihResults;
            grantsUSAData = usaResults;
        }

        function generateEmbeddedNIHSample() {
            return [{"project_num":"2U01AG009740-35","project_title":"Health and Retirement Study: Yrs 35-40","abstract":"PROJECT SUMMARY/ABSTRACT\n This competing continuation proposal for Years 35-40 of the Health and Retirement Study (HRS)\ncooperative agreement, including the Harmonized Cognitive Assessment Protocol (H","fiscal_year":2024,"award_amount":32542439,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"KENNETH M LANGA","nih_institute":"NIA","activity_code":"U01","project_start":"1990-09-25","project_end":"2029-12-31"},{"project_num":"5U01AG009740-36","project_title":"Health and Retirement Study: Yrs 35-40","abstract":"PROJECT SUMMARY/ABSTRACT\n This competing continuation proposal for Years 35-40 of the Health and Retirement Study (HRS)\ncooperative agreement, including the Harmonized Cognitive Assessment Protocol (H","fiscal_year":2025,"award_amount":31889689,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"KENNETH M LANGA","nih_institute":"NIA","activity_code":"U01","project_start":"1990-09-25","project_end":"2029-12-31"},{"project_num":"5U01AG009740-34","project_title":"Health and Retirement Study: Years 29-34","abstract":"PROJECT SUMMARY/ABSTRACT\n This competing continuation proposal for Years 29-34 of the Health and Retirement Study (HRS)\ncooperative agreement is in response to NIA RFA #AG-18-005. The primary aim of t","fiscal_year":2023,"award_amount":17305194,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"DAVID R. WEIR","nih_institute":"NIA","activity_code":"U01","project_start":"1990-09-25","project_end":"2024-05-14"},{"project_num":"5U54AG084520-03","project_title":"The National Dementia Workforce Study","abstract":"ABSTRACT: Overall\nThe National Dementia Workforce Study (NDWS) will be launched by a national team of experts in clinical care\nof persons living with dementia, survey research, and health workforce re","fiscal_year":2025,"award_amount":16199653,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"DONOVAN T MAUST","nih_institute":"NIA","activity_code":"U54","project_start":"2023-09-30","project_end":"2028-08-31"},{"project_num":"5U54AG084520-02","project_title":"The National Dementia Workforce Study","abstract":"ABSTRACT: Overall\nThe National Dementia Workforce Study (NDWS) will be launched by a national team of experts in clinical care\nof persons living with dementia, survey research, and health workforce re","fiscal_year":2024,"award_amount":16199445,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"DONOVAN T MAUST","nih_institute":"NIA","activity_code":"U54","project_start":"2023-09-30","project_end":"2028-08-31"},{"project_num":"1U54AG084520-01","project_title":"The National Dementia Workforce Study","abstract":"ABSTRACT: Overall\nThe National Dementia Workforce Study (NDWS) will be launched by a national team of experts in clinical care\nof persons living with dementia, survey research, and health workforce re","fiscal_year":2023,"award_amount":16177759,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"DONOVAN T MAUST","nih_institute":"NIA","activity_code":"U54","project_start":"2023-09-30","project_end":"2028-08-31"},{"project_num":"5U54AG084520-02","project_title":"Data Collection, Linkages, Cleaning and Sharing Core","abstract":"ABSTRACT: Data Collection, Linkages, Cleaning, and Sharing Core\nThe National Dementia Workforce Study (NDWS) will be launched by a national team of experts in clinical care\nof persons living with deme","fiscal_year":2024,"award_amount":10425588,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"James R Wagner","nih_institute":"NIA","activity_code":"U54","project_start":"2023-09-30","project_end":"2028-08-31"},{"project_num":"5UM1TR004404-02","project_title":"Michigan Institute for Clinical and Health Research (MICHR)","abstract":"Project Summary/Abstract\nThe Michigan Institute for Clinical & Health Research (MICHR) catalyzes clinical and translational research\n(CTR) and advances clinical and translational science (CTS) at the","fiscal_year":2024,"award_amount":10140000,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Julie C Lumeng","nih_institute":"NCATS","activity_code":"UM1","project_start":"2023-03-15","project_end":"2030-02-28"},{"project_num":"1UM1TR004404-01","project_title":"Michigan Institute for Clinical and Health Research (MICHR)","abstract":"Project Summary/Abstract\nThe Michigan Institute for Clinical & Health Research (MICHR) catalyzes clinical and translational research\n(CTR) and advances clinical and translational science (CTS) at the","fiscal_year":2023,"award_amount":10140000,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Julie C Lumeng","nih_institute":"NCATS","activity_code":"UM1","project_start":"2023-03-15","project_end":"2030-02-28"},{"project_num":"1U54AG084520-01","project_title":"Data Collection, Linkages, Cleaning and Sharing Core","abstract":"ABSTRACT: Data Collection, Linkages, Cleaning, and Sharing Core\nThe National Dementia Workforce Study (NDWS) will be launched by a national team of experts in clinical care\nof persons living with deme","fiscal_year":2023,"award_amount":10041271,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"James R Wagner","nih_institute":"NIA","activity_code":"U54","project_start":"2023-09-30","project_end":"2028-08-31"},{"project_num":"5U54AG084520-03","project_title":"Data Collection, Linkages, Cleaning and Sharing Core","abstract":"ABSTRACT: Data Collection, Linkages, Cleaning, and Sharing Core\nThe National Dementia Workforce Study (NDWS) will be launched by a national team of experts in clinical care\nof persons living with deme","fiscal_year":2025,"award_amount":9841539,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"James R Wagner","nih_institute":"NIA","activity_code":"U54","project_start":"2023-09-30","project_end":"2028-08-31"},{"project_num":"5UM1TR004404-03","project_title":"Michigan Institute for Clinical and Health Research (MICHR)","abstract":"The Michigan Institute for Clinical & Health Research (MICHR) catalyzes clinical and translational research (CTR) and advances clinical and translational science (CTS) at the University of Michigan (U","fiscal_year":2025,"award_amount":9768018,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Julie C Lumeng","nih_institute":"NCATS","activity_code":"UM1","project_start":"2023-03-15","project_end":"2030-02-28"},{"project_num":"5U01NS099043-03","project_title":"Sleep for Stroke Management And Recovery Trial (Sleep SMART)","abstract":"Treatment of obstructive sleep apnea (OSA) for stroke prevention and recovery represents a rare chance to\nachieve transformative impact on post-stroke care and outcomes. OSA is highly prevalent after","fiscal_year":2024,"award_amount":7753805,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"DEVIN L BROWN","nih_institute":"NINDS","activity_code":"U01","project_start":"2018-08-15","project_end":"2027-04-30"},{"project_num":"2P30CA046592-34","project_title":"University of Michigan Rogel Cancer Center Support Grant 2023-2028","abstract":"PROJECT SUMMARY/ABSTRACT (OVERALL)\nThe University of Michigan (U-M) Rogel Cancer Center (Rogel) has a distinguished history of scientific\nexcellence, collaboration, and impact. Rogel\u2019s Mission is to r","fiscal_year":2023,"award_amount":7339791,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Eric R. Fearon","nih_institute":"NCI","activity_code":"P30","project_start":"1997-06-01","project_end":"2028-05-31"},{"project_num":"5P30CA046592-35","project_title":"University of Michigan Rogel Cancer Center Support Grant 2023-2028","abstract":"PROJECT SUMMARY/ABSTRACT (OVERALL)\nThe University of Michigan (U-M) Rogel Cancer Center (Rogel) has a distinguished history of scientific\nexcellence, collaboration, and impact. Rogel\u2019s Mission is to r","fiscal_year":2024,"award_amount":7194632,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Eric R. Fearon","nih_institute":"NCI","activity_code":"P30","project_start":"1997-06-01","project_end":"2028-05-31"},{"project_num":"5P30CA046592-36","project_title":"University of Michigan Rogel Cancer Center Support Grant 2023-2028","abstract":"The University of Michigan (U-M) Rogel Cancer Center (Rogel) has a distinguished history of scientific excellence, collaboration, and impact. Rogel\u2019s Mission is to reduce the burden of cancer and adva","fiscal_year":2025,"award_amount":7155482,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Eric R. Fearon","nih_institute":"NCI","activity_code":"P30","project_start":"1997-06-01","project_end":"2028-05-31"},{"project_num":"1U19AI181767-01","project_title":"The Michigan Infectious Disease Genomics (MIDGE) Center","abstract":"Project Summary \u2013 Overall\nThe advent of genomic sequencing technologies has revolutionized our understanding of disease transmission,\npathogen evolution, drug resistance, and virulence. Pathogens can","fiscal_year":2024,"award_amount":6233451,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Adam  Lauring","nih_institute":"NIAID","activity_code":"U19","project_start":"2024-06-14","project_end":"2027-05-31"},{"project_num":"5U01NS099043-04","project_title":"Sleep for Stroke Management And Recovery Trial (Sleep SMART)","abstract":"Treatment of obstructive sleep apnea (OSA) for stroke prevention and recovery represents a rare chance to\nachieve transformative impact on post-stroke care and outcomes. OSA is highly prevalent after","fiscal_year":2025,"award_amount":6179571,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"DEVIN L BROWN","nih_institute":"NINDS","activity_code":"U01","project_start":"2018-08-15","project_end":"2027-04-30"},{"project_num":"5U24DE029462-05","project_title":"Michigan-Pittsburgh-Wyss Regenerative Medicine Resource Center: Advancing Dental, Oral, and Craniofacial Regeneration to Clinical Trial Initiation","abstract":"PROJECT SUMMARY\nReconstruction of dental, oral, and craniofacial (DOC) tissues through tissue engineering and regenerative\nmedicine (RM) is a major goal in dentistry. Despite the continuing success an","fiscal_year":2024,"award_amount":6151035,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"WILLIAM V GIANNOBILE","nih_institute":"NIDCR","activity_code":"U24","project_start":"2020-05-01","project_end":"2026-04-30"},{"project_num":"5UH3HL145269-04","project_title":"1/2 ICECAP: Influence of Cooling duration on Efficacy in Cardiac Arrest Patients","abstract":"7. Project Summary/Abstract .\nCardiac arrest is a common and devastating emergency of the heart and the brain. More than 380,000\npatients suffer out of hospital cardiac arrest (OHCA) each year in the","fiscal_year":2023,"award_amount":6108704,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Romergryko  Geocadin","nih_institute":"NHLBI","activity_code":"UH3","project_start":"2019-09-19","project_end":"2025-08-31"},{"project_num":"5R01DA001411-51","project_title":"Monitoring the Future: Drug Use and Lifestyles of American Youth","abstract":"ABSTRACT\nThis application seeks a five-year continuation of the Monitoring the Future (MTF) study, an ongoing\nepidemiological and etiological research and reporting project begun in 1975. In addition","fiscal_year":2025,"award_amount":5874437,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Richard A Miech","nih_institute":"NIDA","activity_code":"R01","project_start":"1975-06-28","project_end":"2027-03-31"},{"project_num":"5U01NS099046-04","project_title":"Brain Oxygen Optimization in Severe Traumatic Brain Injury - Phase 3 (BOOST-3)","abstract":"Traumatic brain injury (TBI) is a major cause of death and disability. Of the 3.5 million Americans who sustain a\nTBI every year, approximately 27,000 experience prolonged traumatic coma, the most sev","fiscal_year":2024,"award_amount":5845998,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"WILLIAM G BARSAN","nih_institute":"NINDS","activity_code":"U01","project_start":"2018-07-01","project_end":"2025-11-30"},{"project_num":"5R01DA001411-50","project_title":"Monitoring the Future: Drug Use and Lifestyles of American Youth","abstract":"ABSTRACT\nThis application seeks a five-year continuation of the Monitoring the Future (MTF) study, an ongoing\nepidemiological and etiological research and reporting project begun in 1975. In addition","fiscal_year":2024,"award_amount":5836745,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Richard A Miech","nih_institute":"NIDA","activity_code":"R01","project_start":"1975-06-28","project_end":"2027-03-31"},{"project_num":"5R01DA001411-49","project_title":"Monitoring the Future: Drug Use and Lifestyles of American Youth","abstract":"ABSTRACT\nThis application seeks a five-year continuation of the Monitoring the Future (MTF) study, an ongoing\nepidemiological and etiological research and reporting project begun in 1975. In addition","fiscal_year":2023,"award_amount":5827038,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Richard A Miech","nih_institute":"NIDA","activity_code":"R01","project_start":"1975-06-28","project_end":"2027-03-31"},{"project_num":"5U54AI170660-02","project_title":"Center for Structural Biology of HIV RNA","abstract":"This application for the Center for Structural Biology of HIV RNA (CRNA) focuses on determining the structural\nand mechanistic bases of HIV-1 RNA-related replication functions and the host\u2019s response","fiscal_year":2023,"award_amount":5439169,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"ALICE  TELESNITSKY","nih_institute":"NIAID","activity_code":"U54","project_start":"2022-06-09","project_end":"2027-03-31"},{"project_num":"5U54AI170660-03","project_title":"Center for Structural Biology of HIV RNA","abstract":"This application for the Center for Structural Biology of HIV RNA (CRNA) focuses on determining the structural\nand mechanistic bases of HIV-1 RNA-related replication functions and the host\u2019s response","fiscal_year":2024,"award_amount":5412171,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"ALICE  TELESNITSKY","nih_institute":"NIAID","activity_code":"U54","project_start":"2022-06-09","project_end":"2027-03-31"},{"project_num":"5U54AI170660-04","project_title":"Center for Structural Biology of HIV RNA","abstract":"This application for the Center for Structural Biology of HIV RNA (CRNA) focuses on determining the structural\nand mechanistic bases of HIV-1 RNA-related replication functions and the host\u2019s response","fiscal_year":2025,"award_amount":5159974,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"ALICE  TELESNITSKY","nih_institute":"NIAID","activity_code":"U54","project_start":"2022-06-09","project_end":"2027-03-31"},{"project_num":"75N92024D00008-0-759202400001-1","project_title":"NHLBI TRANS-OMICS FOR PRECISION MEDICINE (TOPMED) INFORMATICS RESEARCH CENTER (IRC)","abstract":"NHLBI's Trans-Omics for Precision Medicine (TOPMed) program started in 2014 as the flagship program supporting the development of precision medicine for heart, lung, blood diseases and sleep disorders","fiscal_year":2024,"award_amount":5114949,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"JEREMY  STRAUGHN","nih_institute":"NHLBI","activity_code":"N02","project_start":"2024-05-15","project_end":"2025-05-14"},{"project_num":"5U54CA280805-02","project_title":"Michigan Program for Advancing Cultural Transformation (M-PACT) in Biomedical and Health Sciences","abstract":"PROJECT SUMMARY: OVERALL\nEngaging diverse intellectual capital is imperative for finding creative solutions for complex problems at the\nfrontiers of biomedical science. As a large public institution,","fiscal_year":2024,"award_amount":5101670,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Reshma  Jagsi","nih_institute":"OD","activity_code":"U54","project_start":"2023-06-13","project_end":"2029-02-28"},{"project_num":"268201800002I-0-759202300001-1","project_title":"TRANS-OMICS FOR PRECISION MEDICINE (TOPMED) INFORMATICS RESEARCH CENTER (IRC)","abstract":"NHLBI's Trans-Omics for Precision Medicine (TOPMed) program started in 2014 as the flagship program supporting the development of precision medicine for heart, lung, blood diseases and sleep disorders","fiscal_year":2023,"award_amount":4786799,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Goncalo  Abecasis","nih_institute":"NHLBI","activity_code":"N01","project_start":"2023-04-01","project_end":"2024-03-31"},{"project_num":"5U54CA280805-02","project_title":"Administrative Core","abstract":"PROJECT SUMMARY: ADMINISTRATIVE CORE\nTo drive diversity, equity and inclusion (DEI) efforts around faculty hiring, the Michigan Program for Advancing\nCultural Transformation (M-PACT) at the University","fiscal_year":2024,"award_amount":4644802,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"ROBERT M SELLERS","nih_institute":"NCI","activity_code":"U54","project_start":"2023-06-13","project_end":"2029-02-28"},{"project_num":"3U01AG009740-34S5","project_title":"Health and Retirement Study Y34 SSA CoFunding (NIA)","abstract":"PROJECT SUMMARY\n This represents one year of co-funding of the Health and Retirement Study by the Social Security\nAdministration via Jointly Financed Cooperative Arrangement (JFCA) agreement with the","fiscal_year":2023,"award_amount":4575000,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"DAVID R. WEIR","nih_institute":"NIA","activity_code":"U01","project_start":"1990-09-25","project_end":"2024-05-14"},{"project_num":"5UH3HL159134-05","project_title":"1/2 Pediatric Influence of Cooling duration on Efficacy in Cardiac Arrest Patients (P-ICECAP)","abstract":"Project Summary\nOut-of-hospital cardiac arrest (OHCA) in children is a tragic event that usually results in death or permanent\nbrain injury in survivors. More than 7000 children suffer OHCA each year","fiscal_year":2025,"award_amount":4201827,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"FRANK W MOLER","nih_institute":"NHLBI","activity_code":"UH3","project_start":"2021-09-15","project_end":"2028-08-31"},{"project_num":"5UH3HL159134-03","project_title":"1/2 Pediatric Influence of Cooling duration on Efficacy in Cardiac Arrest Patients (P-ICECAP)","abstract":"Project Summary\nOut-of-hospital cardiac arrest (OHCA) in children is a tragic event that usually results in death or permanent\nbrain injury in survivors. More than 7000 children suffer OHCA each year","fiscal_year":2023,"award_amount":4094882,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"FRANK W MOLER","nih_institute":"NHLBI","activity_code":"UH3","project_start":"2021-09-15","project_end":"2028-08-31"},{"project_num":"2U54CA229974-06","project_title":"Center for the Assessment of Tobacco Regulations (CAsToR) TCORS 3.0","abstract":"CENTER Abstract\nThe integrative theme for the Center for the Assessment of Tobacco Regulations (CAsToR) is to provide\nevidence-based and expert-informed modeling of the behavioral and public health im","fiscal_year":2023,"award_amount":4090435,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"David Theodore Levy","nih_institute":"OD","activity_code":"U54","project_start":"2018-09-14","project_end":"2028-08-31"},{"project_num":"5UH3HL159134-04","project_title":"1/2 Pediatric Influence of Cooling duration on Efficacy in Cardiac Arrest Patients (P-ICECAP)","abstract":"Project Summary\nOut-of-hospital cardiac arrest (OHCA) in children is a tragic event that usually results in death or permanent\nbrain injury in survivors. More than 7000 children suffer OHCA each year","fiscal_year":2024,"award_amount":4073947,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"FRANK W MOLER","nih_institute":"NHLBI","activity_code":"UH3","project_start":"2021-09-15","project_end":"2028-08-31"},{"project_num":"5U54CA229974-08","project_title":"Center for the Assessment of Tobacco Regulations (CAsToR) TCORS 3.0","abstract":"CENTER Abstract\nThe integrative theme for the Center for the Assessment of Tobacco Regulations (CAsToR) is to provide\nevidence-based and expert-informed modeling of the behavioral and public health im","fiscal_year":2025,"award_amount":4008400,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"David Theodore Levy","nih_institute":"OD","activity_code":"U54","project_start":"2018-09-14","project_end":"2028-08-31"},{"project_num":"1U01MH136025-01","project_title":"COMPASS: A comprehensive mobile precision approach for scalable solutions in mental health treatment","abstract":"Matching patients to the treatment most effective for them can accelerate recovery and meaningfully\nreduce the growing burden of mental health conditions. Key barriers to tailoring care are the lack o","fiscal_year":2024,"award_amount":3866357,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Amy S B Bohnert","nih_institute":"NIMH","activity_code":"U01","project_start":"2024-07-01","project_end":"2029-04-30"},{"project_num":"5U24DK122927-06","project_title":"University of Michigan Data Coordinating Center for the Diabetic Foot Consortium","abstract":"Diabetes-related foot ulcers (DFUs) are prevalent and devastating complications of diabetes, with few\nFDA-approved therapies. The Diabetic Foot Consortium (DFC) was established in 2018 as the first mu","fiscal_year":2024,"award_amount":3861668,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Catherine A Spino","nih_institute":"NIDDK","activity_code":"U24","project_start":"2019-07-01","project_end":"2027-12-31"},{"project_num":"4U24HD111315-02","project_title":"University of Michigan Multi-disciplinary Coordinating Center for the Community Firearm Injury Prevention Network","abstract":"Modified Project Summary/Abstract Section \n\nFirearm injury is a major U.S. health issue requiring urgent attention. Firearm injuries have increased in the past decade, with >400,000 fatalities and ~1.","fiscal_year":2025,"award_amount":3839621,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Patrick M. Carter","nih_institute":"OD","activity_code":"U24","project_start":"2022-09-15","project_end":"2027-08-31"},{"project_num":"1RF1NS133978-01","project_title":"Reconfigurable 3D Origami Probes for Multi-modal Neural Interface","abstract":"Project Summary\nOver the decades, various neurotechnologies have made significant advancements to meet the highest priority goals enumerated in the BRAIN 2025 Report. However, each tool development ha","fiscal_year":2023,"award_amount":3837586,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"GYORGY  BUZSAKI","nih_institute":"NINDS","activity_code":"RF1","project_start":"2023-09-15","project_end":"2026-08-31"},{"project_num":"5U01MH136025-02","project_title":"COMPASS: A comprehensive mobile precision approach for scalable solutions in mental health treatment","abstract":"Matching patients to the treatment most effective for them can accelerate recovery and meaningfully\nreduce the growing burden of mental health conditions. Key barriers to tailoring care are the lack o","fiscal_year":2025,"award_amount":3797437,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Amy S B Bohnert","nih_institute":"NIMH","activity_code":"U01","project_start":"2024-07-01","project_end":"2029-04-30"},{"project_num":"5U24DK122927-07","project_title":"University of Michigan Data Coordinating Center for the Diabetic Foot Consortium","abstract":"Diabetes-related foot ulcers (DFUs) are prevalent and devastating complications of diabetes, with few\nFDA-approved therapies. The Diabetic Foot Consortium (DFC) was established in 2018 as the first mu","fiscal_year":2025,"award_amount":3790120,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Catherine A Spino","nih_institute":"NIDDK","activity_code":"U24","project_start":"2019-07-01","project_end":"2027-12-31"},{"project_num":"2U24DK122927-05","project_title":"University of Michigan Data Coordinating Center for the Diabetic Foot Consortium","abstract":"Diabetes-related foot ulcers (DFUs) are prevalent and devastating complications of diabetes, with few\nFDA-approved therapies. The Diabetic Foot Consortium (DFC) was established in 2018 as the first mu","fiscal_year":2023,"award_amount":3767901,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Catherine A Spino","nih_institute":"NIDDK","activity_code":"U24","project_start":"2019-07-01","project_end":"2027-12-31"},{"project_num":"5U01NS099046-05","project_title":"Brain Oxygen Optimization in Severe Traumatic Brain Injury - Phase 3 (BOOST-3)","abstract":"Traumatic brain injury (TBI) is a major cause of death and disability. Of the 3.5 million Americans who sustain a\nTBI every year, approximately 27,000 experience prolonged traumatic coma, the most sev","fiscal_year":2025,"award_amount":3711954,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"WILLIAM G BARSAN","nih_institute":"NINDS","activity_code":"U01","project_start":"2018-07-01","project_end":"2025-11-30"},{"project_num":"1RF1AG093689-01A1","project_title":"Network-based neuromodulation for posterior cortical atrophy","abstract":"Abstract\n This is the first study to evaluate the effects of personalized brain stimulation as a potential treatment for\nthose with posterior cortical atrophy (PCA), a condition that is most often cau","fiscal_year":2025,"award_amount":3664645,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Benjamin Michael Hampstead","nih_institute":"NIA","activity_code":"RF1","project_start":"2025-08-01","project_end":"2029-07-31"},{"project_num":"5P30AG072931-03","project_title":"Michigan Alzheimer's Disease Research Center","abstract":"ABSTRACT \u2013 OVERALL\nFour years ago the Michigan ADRC (MADRC) was established as a new consortium linking the three major\nresearch universities in Michigan: University of Michigan, Michigan State Univer","fiscal_year":2023,"award_amount":3574378,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Henry L Paulson","nih_institute":"NIA","activity_code":"P30","project_start":"2021-09-01","project_end":"2026-06-30"},{"project_num":"5U54CA229974-07","project_title":"Center for the Assessment of Tobacco Regulations (CAsToR) TCORS 3.0","abstract":"CENTER Abstract\nThe integrative theme for the Center for the Assessment of Tobacco Regulations (CAsToR) is to provide\nevidence-based and expert-informed modeling of the behavioral and public health im","fiscal_year":2024,"award_amount":3461514,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"David Theodore Levy","nih_institute":"OD","activity_code":"U54","project_start":"2018-09-14","project_end":"2028-08-31"},{"project_num":"5P30AG072931-05","project_title":"Michigan Alzheimer's Disease Research Center","abstract":"ABSTRACT \u2013 OVERALL Four years ago the Michigan ADRC (MADRC) was established as a new consortium linking the three major research universities in Michigan: University of Michigan, Michigan State Univer","fiscal_year":2025,"award_amount":3441683,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Henry L Paulson","nih_institute":"NIA","activity_code":"P30","project_start":"2021-09-01","project_end":"2026-06-30"},{"project_num":"5P30AG072931-04","project_title":"Michigan Alzheimer's Disease Research Center","abstract":"ABSTRACT \u2013 OVERALL\nFour years ago the Michigan ADRC (MADRC) was established as a new consortium linking the three major\nresearch universities in Michigan: University of Michigan, Michigan State Univer","fiscal_year":2024,"award_amount":3437554,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Henry L Paulson","nih_institute":"NIA","activity_code":"P30","project_start":"2021-09-01","project_end":"2026-06-30"},{"project_num":"1R01ES037968-01","project_title":"Integrating the exposome and epigenome identifies determinants of ALS risk, survival, and pathogenesis","abstract":"ABSTRACT\nAmyotrophic lateral sclerosis (ALS) is a fatal neurodegenerative disease with no cure or meaningful treat-\nments. ALS is mostly sporadic, and for most, evidence supports a gene-time-environme","fiscal_year":2025,"award_amount":3133754,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"STUART A BATTERMAN","nih_institute":"NIEHS","activity_code":"R01","project_start":"2025-09-10","project_end":"2029-09-09"},{"project_num":"1R01AI194902-01","project_title":"Next-Generation CMA/CMB Derivatives as Targeted Inhibitors of HIV Nef","abstract":"Current combined antiretroviral therapies (cART) suppress viral levels in the blood but do not eradicate\nreservoirs of cells harboring integrated copies of HIV proviral genomes. These cells persist in","fiscal_year":2025,"award_amount":3110884,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Kathleen L. Collins","nih_institute":"NIAID","activity_code":"R01","project_start":"2025-07-23","project_end":"2029-06-30"},{"project_num":"5K12NS130673-03","project_title":"University of Michigan (UM) HEAL Initiative National K12 Clinical Pain Career Development Program (UM-HCPDP)","abstract":"PROJECT SUMMARY / ABSTRACT\nThe overall goal of the University of Michigan (UM) HEAL National K12 Clinical Pain Career Development\nProgram (UM-HCPDP) is to develop a national training program for early","fiscal_year":2025,"award_amount":3099107,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Daniel J Clauw","nih_institute":"NINDS","activity_code":"K12","project_start":"2022-09-21","project_end":"2027-08-31"},{"project_num":"1RC2TR004899-01A1","project_title":"mHealth Outcomes in Behavioral Interventions & Longitudinal Evaluation (MOBILE) Platform","abstract":"Clinical researchers increasingly recognize the potential for mobile health (mHealth) technologies to transform health and medicine by facilitating real-time data collection, self-management, and info","fiscal_year":2025,"award_amount":3097384,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Megan Rist Haymart","nih_institute":"NCATS","activity_code":"RC2","project_start":"2025-08-15","project_end":"2029-07-31"},{"project_num":"5R01HD052646-16","project_title":"Transition from Preschool through High School: Family, Schools & Neighborhoods","abstract":"Project Summary/Abstract\n This project will continue the collection of data on children in the Panel Study of Income Dynamics (PSID)\nunder Grant R01-HD052646. The current grant has supported the relau","fiscal_year":2024,"award_amount":3041858,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"NARAYAN  SASTRY","nih_institute":"NICHD","activity_code":"R01","project_start":"2007-07-03","project_end":"2028-06-30"},{"project_num":"1U54DE035412-01","project_title":"360\u00b0 Collaborative Hub for AI in TMD Research (360\u00b0 Chat-TMD)","abstract":"360\u00b0 CHAT TMD ABSTRACT\nThe proposed 360\u00b0 Collaborative Hub for AI in TMD Research (360\u00b0 CHAT-TMD) Center will establish a\nnational, interdisciplinary, patient-centered initiative aimed at advancing te","fiscal_year":2025,"award_amount":3017704,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"ALEXANDRE  DASILVA","nih_institute":"NCCIH","activity_code":"U54","project_start":"2025-09-22","project_end":"2030-06-30"},{"project_num":"1RF1AG094801-01","project_title":"Reactive oxygen species as early-in-life modulators of lifespan","abstract":"Why do we age and why do some of us stay healthy longer than others? Thanks to the development of\nshorter-lived aging model organisms, much has been learnt about the processes that contribute to our\ni","fiscal_year":2025,"award_amount":2991725,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Ursula H. Jakob","nih_institute":"NIA","activity_code":"RF1","project_start":"2025-09-01","project_end":"2029-08-31"},{"project_num":"1R01HD117775-01","project_title":"Individual differences in brain morphology and connectivity to identify the mechanisms of comorbidities and treatment-refractory disease in females with endometriosis-associated pelvic pain","abstract":"PROJECT SUMMARY/ABSTRACT\nEndometriosis associated pelvic pain (EAPP) affects millions of females in the United States. Roughly 40% of\nfemales using gonadotropin-releasing hormone (GnRH) agonist therap","fiscal_year":2025,"award_amount":2969745,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Jason J. Kutch","nih_institute":"NINDS","activity_code":"R01","project_start":"2025-08-01","project_end":"2028-07-31"},{"project_num":"1RF1MH141903-01","project_title":"Midbrain Signals for Differential Reinforcement Learning","abstract":"Project Summary/Abstract\nAssociative learning is a fundamental cornerstone of behavior and cognition, but the underlying neural\nmechanisms remain poorly understood. In vertebrates, the inferior collic","fiscal_year":2025,"award_amount":2908921,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Pierre F Apostolides","nih_institute":"NIMH","activity_code":"RF1","project_start":"2025-09-22","project_end":"2029-09-21"},{"project_num":"1R01CA303150-01","project_title":"Understanding and Harnessing Microbial Reprogramming to Combat Carcinogenic Colibactin in Colorectal Cancer","abstract":"Abstract\n In alignment with the FOA PAR-22-085, which emphasizes microbial-based cancer therapies, our\nobjectives are twofold: (1) to develop a novel strategy to enzymatically inhibit colibactin, a pr","fiscal_year":2025,"award_amount":2864671,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Jiahe  Li","nih_institute":"NCI","activity_code":"R01","project_start":"2025-09-10","project_end":"2029-08-31"},{"project_num":"1P01HL172729-01","project_title":"Disease Mechanisms of Early Pulmonary Fibrosis","abstract":"PROGRAM PROJECT SUMMARY\nTo develop novel, transformative therapies that substantially reduce the burden of morbidity and mortality from\nprogressive pulmonary fibrosis (PF), a fundamentally new concept","fiscal_year":2024,"award_amount":2857933,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Timothy S. Blackwell","nih_institute":"NHLBI","activity_code":"P01","project_start":"2024-09-17","project_end":"2029-07-31"},{"project_num":"5P01HL172729-02","project_title":"Disease Mechanisms of Early Pulmonary Fibrosis","abstract":"PROGRAM PROJECT SUMMARY\nTo develop novel, transformative therapies that substantially reduce the burden of morbidity and mortality from\nprogressive pulmonary fibrosis (PF), a fundamentally new concept","fiscal_year":2025,"award_amount":2829683,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Timothy S. Blackwell","nih_institute":"NHLBI","activity_code":"P01","project_start":"2024-09-17","project_end":"2029-07-31"},{"project_num":"1R01CA298159-01A1","project_title":"New methods to measure and interrupt metabolic fluxes in brain cancer","abstract":"ABSTRACT\nGlioblastomas (GBMs) are deadly incurable brain cancers that are treated with resection followed by\nradiation, which is often combined with chemotherapy. GBMs rewire their metabolism to fuel","fiscal_year":2025,"award_amount":2820337,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Deepak  Nagrath","nih_institute":"NCI","activity_code":"R01","project_start":"2025-08-06","project_end":"2029-07-31"},{"project_num":"2R01HD052646-15A1","project_title":"Transition from Preschool through High School: Family, Schools & Neighborhoods","abstract":"Project Summary/Abstract\n This project will continue the collection of data on children in the Panel Study of Income Dynamics (PSID)\nunder Grant R01-HD052646. The current grant has supported the relau","fiscal_year":2023,"award_amount":2817992,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"NARAYAN  SASTRY","nih_institute":"NICHD","activity_code":"R01","project_start":"2007-07-03","project_end":"2028-06-30"},{"project_num":"5U24DK062456-22","project_title":"Childhood Liver Disease Research Network Data Coordinating Center","abstract":"Project Summary Abstract\nChronic pediatric liver disease is a devastating group of conditions that have a profound effect on children,\ntheir families, and our society. Biliary atresia and the other ch","fiscal_year":2023,"award_amount":2750000,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Lisa  Henn","nih_institute":"NIDDK","activity_code":"U24","project_start":"2002-09-18","project_end":"2024-05-31"},{"project_num":"5R01DA016575-22","project_title":"Monitoring the Future: A Cohort-Sequential Panel Study of Drug Use, Ages 19-65","abstract":"ABSTRACT\nThis application is for a 5-year continuation of the national longitudinal panel data collections of the Monitoring\nthe Future (MTF) study, an ongoing epidemiological and etiological substanc","fiscal_year":2024,"award_amount":2675194,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Megan E. Patrick","nih_institute":"NIDA","activity_code":"R01","project_start":"2003-09-30","project_end":"2027-03-31"},{"project_num":"5R01HD052646-17","project_title":"Transition from Preschool through High School: Family, Schools & Neighborhoods","abstract":"Project Summary/Abstract\n This project will continue the collection of data on children in the Panel Study of Income Dynamics (PSID)\nunder Grant R01-HD052646. The current grant has supported the relau","fiscal_year":2025,"award_amount":2671327,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Wei  Zhao","nih_institute":"NICHD","activity_code":"R01","project_start":"2007-07-03","project_end":"2028-06-30"},{"project_num":"5R01DA016575-23","project_title":"Monitoring the Future: A Cohort-Sequential Panel Study of Drug Use, Ages 19-65","abstract":"ABSTRACT\nThis application is for a 5-year continuation of the national longitudinal panel data collections of the Monitoring\nthe Future (MTF) study, an ongoing epidemiological and etiological substanc","fiscal_year":2025,"award_amount":2666307,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Megan E. Patrick","nih_institute":"NIDA","activity_code":"R01","project_start":"2003-09-30","project_end":"2027-03-31"},{"project_num":"1U54AG084520-01","project_title":"Administrative Core","abstract":"ABSTRACT: Administrative Core\nThe National Dementia Workforce Study (NDWS) will be launched by a national team of experts in clinical care\nof persons living with dementia, survey research, and health","fiscal_year":2023,"award_amount":2656533,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"DONOVAN T MAUST","nih_institute":"NIA","activity_code":"U54","project_start":"2023-09-30","project_end":"2028-08-31"},{"project_num":"5P50DA054039-03","project_title":"Center for Methodologies for Adapting and Personalizing Prevention, Treatment and Recovery Services for SUD and HIV (MAPS Center)","abstract":"PROJECT SUMMARY: OVERALL\nEffective prevention, treatment, and recovery services for substance use disorders (SUD) and HIV demand an\nincreasing array of evidence-based interventions to address individu","fiscal_year":2023,"award_amount":2644185,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Daniel  Almirall","nih_institute":"NIDA","activity_code":"P50","project_start":"2021-09-01","project_end":"2026-06-30"},{"project_num":"5U54AG084520-03","project_title":"Administrative Core","abstract":"ABSTRACT: Administrative Core\nThe National Dementia Workforce Study (NDWS) will be launched by a national team of experts in clinical care\nof persons living with dementia, survey research, and health","fiscal_year":2025,"award_amount":2608910,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"DONOVAN T MAUST","nih_institute":"NIA","activity_code":"U54","project_start":"2023-09-30","project_end":"2028-08-31"},{"project_num":"5P50DA054039-05","project_title":"Center for Methodologies for Adapting and Personalizing Prevention, Treatment and Recovery Services for SUD and HIV (MAPS Center)","abstract":"The Center for Methodologies for Adapting and Personalizing Prevention, Treatment, and Recovery Services for SUD and HIV (MAPS Center) will develop, translate, and disseminate novel experimental and d","fiscal_year":2025,"award_amount":2596368,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Daniel  Almirall","nih_institute":"NIDA","activity_code":"P50","project_start":"2021-09-01","project_end":"2026-06-30"},{"project_num":"5P50DA054039-04","project_title":"Center for Methodologies for Adapting and Personalizing Prevention, Treatment and Recovery Services for SUD and HIV (MAPS Center)","abstract":"PROJECT SUMMARY: OVERALL\nEffective prevention, treatment, and recovery services for substance use disorders (SUD) and HIV demand an\nincreasing array of evidence-based interventions to address individu","fiscal_year":2024,"award_amount":2584185,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Daniel  Almirall","nih_institute":"NIDA","activity_code":"P50","project_start":"2021-09-01","project_end":"2026-06-30"},{"project_num":"5R01AG040213-14","project_title":"Health and Well-being Over the Life Course and Across Multiple Generations","abstract":"Project Summary\n This application proposes to collect, process, and disseminate data in the 2021 and 2023 waves of the\nPanel Study of Income Dynamics (PSID). The PSID is a longitudinal survey of a nat","fiscal_year":2024,"award_amount":2545201,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Esther M. Friedman","nih_institute":"NIA","activity_code":"R01","project_start":"2011-09-01","project_end":"2026-02-28"},{"project_num":"5R01AG040213-13","project_title":"Health and Well-being Over the Life Course and Across Multiple Generations","abstract":"Project Summary\n This application proposes to collect, process, and disseminate data in the 2021 and 2023 waves of the\nPanel Study of Income Dynamics (PSID). The PSID is a longitudinal survey of a nat","fiscal_year":2023,"award_amount":2539398,"org_name":"UNIVERSITY OF MICHIGAN AT ANN ARBOR","pi_name":"Esther M. Friedman","nih_institute":"NIA","activity_code":"R01","project_start":"2011-09-01","project_end":"2026-02-28"}];
        }

        function generateEmbeddedUSASample() {
            return [{"award_id":"U01AG009740","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":430833688.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"HEALTH AND RETIREMENT STUDY"},{"award_id":"U01AG009740","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":430833688.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"HEALTH AND RETIREMENT STUDY"},{"award_id":"U01AG009740","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":430833688.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"HEALTH AND RETIREMENT STUDY"},{"award_id":"P30CA046592","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":123361385.0,"award_type":"PROJECT GRANT (B)","description":"UNIVERSITY OF MICHIGAN COMPREHENSIVE CANCER CENTER SUPPORT GRANT"},{"award_id":"P30CA046592","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":123361385.0,"award_type":"PROJECT GRANT (B)","description":"UNIVERSITY OF MICHIGAN COMPREHENSIVE CANCER CENTER SUPPORT GRANT"},{"award_id":"P30CA046592","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":123361385.0,"award_type":"PROJECT GRANT (B)","description":"UNIVERSITY OF MICHIGAN COMPREHENSIVE CANCER CENTER SUPPORT GRANT"},{"award_id":"R01DA001411","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":96202864.24,"award_type":"PROJECT GRANT (B)","description":"DRUG USE AND LIFESTYLES OF AMERICAN YOUTH"},{"award_id":"R01DA001411","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":96202864.24,"award_type":"PROJECT GRANT (B)","description":"DRUG USE AND LIFESTYLES OF AMERICAN YOUTH"},{"award_id":"R01DA001411","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":96202864.24,"award_type":"PROJECT GRANT (B)","description":"DRUG USE AND LIFESTYLES OF AMERICAN YOUTH"},{"award_id":"UL1TR002240","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":54857476.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"MICHIGAN INSTITUTE FOR CLINICAL AND HEALTH RESEARCH (MICHR)"},{"award_id":"UL1TR002240","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":54857476.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"MICHIGAN INSTITUTE FOR CLINICAL AND HEALTH RESEARCH (MICHR)"},{"award_id":"U54AG084520","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":48576857.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"THE NATIONAL DEMENTIA WORKFORCE STUDY - ABSTRACT: OVERALL THE NATIONAL DEMENTIA WORKFORCE STUDY (NDWS) WILL BE LAUNCHED BY A NATIONAL TEAM OF EXPERTS IN CLINICAL CARE OF PERSONS LIVING WITH DEMENTIA, SURVEY RESEARCH, AND HEALTH WORKFORCE RESEARCH. THE GOAL OF THE NDWS DATA INFRASTRUCTURE IS TO ALLOW RESEARCHERS AND POLICYMAKERS TO ASK AND ANSWER SCIENTIFIC QUESTIONS TO HELP BUILD THE WORKFORCE OF CLINICIANS AND OTHER PROFESSIONAL CARE PROVIDERS REQUIRED BY THE GROWING POPULATION OF PERSONS LIVING WITH DEMENTIA IN THE U.S. THE CORE OF NDWS WILL BE FOUR SURVEYS THAT REFLECT KEY ELEMENTS OF THE PROFESSIONAL DEMENTIA CARE WORKFORCE IN THE U.S.: COMMUNITY CLINICIANS, NURSING HOME STAFF, HOME CARE STAFF, AND ASSISTED LIVING STAFF. IN ADDITION TO THESE SURVEYS, THE NDWS TEAM WILL DEVELOP A VARIETY OF ADDITIONAL DATA SOURCES THAT CAN BE LINKED WITH THE SURVEYS IN ORDER TO MAXIMIZE THE SCIENTIFIC POTENTIAL OF THE SURVEYS. THE NDWS TEAM INCLUDES THE COUNTRY\u2019S LEADING DEMENTIA CARE, WORKFORCE, AND SURVEY RESEARCHERS AS CO-INVESTIGATORS AND CONSULTANTS, AND THE PROJECT\u2019S ACTIVITIES WILL BE CONDUCTED THROUGH FIVE CORES: 1) ADMINISTRATIVE (LEAD: DONOVAN MAUST, MD, MS, AND CO-LEAD: JOANNE SPETZ, PHD); 2) SCREENING AND SURVEY INSTRUMENT DEVELOPMENT (CO-LEADS: JOANNE SPETZ, PHD, AND JAMES WAGNER, PHD); 3) ADMINISTRATIVE DATA TRANSFER, MASKING, ACCESS, AND ETHICS (LEAD: STEVEN MARCUS, PHD); 4) DATA COLLECTION, LINKAGES, CLEANING, AND SHARING (LEAD: JAMES WAGNER, PHD); AND 5) RESEARCH STUDIES (LEAD: LAURA WAGNER, PHD, RN). THE OVERALL AIMS ARE TO: 1) LAUNCH A FAMILY OF FOUR NATIONALLY REPRESENTATIVE PROFESSIONAL DEMENTIA WORKFORCE SURVEYS COVERING THE KEY CARE DELIVERY SETTINGS IN THE U.S.; 2) THROUGH THE NATIONAL DEMENTIA WORKFORCE STUDY, BUILD A DATA INFRASTRUCTURE SURROUNDING THE DEMENTIA WORKFORCE SURVEYS THAT ALLOWS RESEARCHERS TO GENERATE CRITICAL INSIGHTS INTO THE PROFESSIONAL DEMENTIA CARE WORKFORCE AND ASSOCIATED OUTCOMES FOR PLWD; AND 3) DEVELOP AND EXPAND THE COMMUNITY OF RESEARCHERS FOCUSED ON THE PROFESSIONAL DEMENTIA CARE WORKFORCE OVERALL AND THAT USE THE NATIONAL DEMENTIA WORKFORCE STUDY DATA INFRASTRUCTURE."},{"award_id":"U54AG084520","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":48576857.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"THE NATIONAL DEMENTIA WORKFORCE STUDY - ABSTRACT: OVERALL THE NATIONAL DEMENTIA WORKFORCE STUDY (NDWS) WILL BE LAUNCHED BY A NATIONAL TEAM OF EXPERTS IN CLINICAL CARE OF PERSONS LIVING WITH DEMENTIA, SURVEY RESEARCH, AND HEALTH WORKFORCE RESEARCH. THE GOAL OF THE NDWS DATA INFRASTRUCTURE IS TO ALLOW RESEARCHERS AND POLICYMAKERS TO ASK AND ANSWER SCIENTIFIC QUESTIONS TO HELP BUILD THE WORKFORCE OF CLINICIANS AND OTHER PROFESSIONAL CARE PROVIDERS REQUIRED BY THE GROWING POPULATION OF PERSONS LIVING WITH DEMENTIA IN THE U.S. THE CORE OF NDWS WILL BE FOUR SURVEYS THAT REFLECT KEY ELEMENTS OF THE PROFESSIONAL DEMENTIA CARE WORKFORCE IN THE U.S.: COMMUNITY CLINICIANS, NURSING HOME STAFF, HOME CARE STAFF, AND ASSISTED LIVING STAFF. IN ADDITION TO THESE SURVEYS, THE NDWS TEAM WILL DEVELOP A VARIETY OF ADDITIONAL DATA SOURCES THAT CAN BE LINKED WITH THE SURVEYS IN ORDER TO MAXIMIZE THE SCIENTIFIC POTENTIAL OF THE SURVEYS. THE NDWS TEAM INCLUDES THE COUNTRY\u2019S LEADING DEMENTIA CARE, WORKFORCE, AND SURVEY RESEARCHERS AS CO-INVESTIGATORS AND CONSULTANTS, AND THE PROJECT\u2019S ACTIVITIES WILL BE CONDUCTED THROUGH FIVE CORES: 1) ADMINISTRATIVE (LEAD: DONOVAN MAUST, MD, MS, AND CO-LEAD: JOANNE SPETZ, PHD); 2) SCREENING AND SURVEY INSTRUMENT DEVELOPMENT (CO-LEADS: JOANNE SPETZ, PHD, AND JAMES WAGNER, PHD); 3) ADMINISTRATIVE DATA TRANSFER, MASKING, ACCESS, AND ETHICS (LEAD: STEVEN MARCUS, PHD); 4) DATA COLLECTION, LINKAGES, CLEANING, AND SHARING (LEAD: JAMES WAGNER, PHD); AND 5) RESEARCH STUDIES (LEAD: LAURA WAGNER, PHD, RN). THE OVERALL AIMS ARE TO: 1) LAUNCH A FAMILY OF FOUR NATIONALLY REPRESENTATIVE PROFESSIONAL DEMENTIA WORKFORCE SURVEYS COVERING THE KEY CARE DELIVERY SETTINGS IN THE U.S.; 2) THROUGH THE NATIONAL DEMENTIA WORKFORCE STUDY, BUILD A DATA INFRASTRUCTURE SURROUNDING THE DEMENTIA WORKFORCE SURVEYS THAT ALLOWS RESEARCHERS TO GENERATE CRITICAL INSIGHTS INTO THE PROFESSIONAL DEMENTIA CARE WORKFORCE AND ASSOCIATED OUTCOMES FOR PLWD; AND 3) DEVELOP AND EXPAND THE COMMUNITY OF RESEARCHERS FOCUSED ON THE PROFESSIONAL DEMENTIA CARE WORKFORCE OVERALL AND THAT USE THE NATIONAL DEMENTIA WORKFORCE STUDY DATA INFRASTRUCTURE."},{"award_id":"U54AG084520","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":48576857.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"THE NATIONAL DEMENTIA WORKFORCE STUDY - ABSTRACT: OVERALL THE NATIONAL DEMENTIA WORKFORCE STUDY (NDWS) WILL BE LAUNCHED BY A NATIONAL TEAM OF EXPERTS IN CLINICAL CARE OF PERSONS LIVING WITH DEMENTIA, SURVEY RESEARCH, AND HEALTH WORKFORCE RESEARCH. THE GOAL OF THE NDWS DATA INFRASTRUCTURE IS TO ALLOW RESEARCHERS AND POLICYMAKERS TO ASK AND ANSWER SCIENTIFIC QUESTIONS TO HELP BUILD THE WORKFORCE OF CLINICIANS AND OTHER PROFESSIONAL CARE PROVIDERS REQUIRED BY THE GROWING POPULATION OF PERSONS LIVING WITH DEMENTIA IN THE U.S. THE CORE OF NDWS WILL BE FOUR SURVEYS THAT REFLECT KEY ELEMENTS OF THE PROFESSIONAL DEMENTIA CARE WORKFORCE IN THE U.S.: COMMUNITY CLINICIANS, NURSING HOME STAFF, HOME CARE STAFF, AND ASSISTED LIVING STAFF. IN ADDITION TO THESE SURVEYS, THE NDWS TEAM WILL DEVELOP A VARIETY OF ADDITIONAL DATA SOURCES THAT CAN BE LINKED WITH THE SURVEYS IN ORDER TO MAXIMIZE THE SCIENTIFIC POTENTIAL OF THE SURVEYS. THE NDWS TEAM INCLUDES THE COUNTRY\u2019S LEADING DEMENTIA CARE, WORKFORCE, AND SURVEY RESEARCHERS AS CO-INVESTIGATORS AND CONSULTANTS, AND THE PROJECT\u2019S ACTIVITIES WILL BE CONDUCTED THROUGH FIVE CORES: 1) ADMINISTRATIVE (LEAD: DONOVAN MAUST, MD, MS, AND CO-LEAD: JOANNE SPETZ, PHD); 2) SCREENING AND SURVEY INSTRUMENT DEVELOPMENT (CO-LEADS: JOANNE SPETZ, PHD, AND JAMES WAGNER, PHD); 3) ADMINISTRATIVE DATA TRANSFER, MASKING, ACCESS, AND ETHICS (LEAD: STEVEN MARCUS, PHD); 4) DATA COLLECTION, LINKAGES, CLEANING, AND SHARING (LEAD: JAMES WAGNER, PHD); AND 5) RESEARCH STUDIES (LEAD: LAURA WAGNER, PHD, RN). THE OVERALL AIMS ARE TO: 1) LAUNCH A FAMILY OF FOUR NATIONALLY REPRESENTATIVE PROFESSIONAL DEMENTIA WORKFORCE SURVEYS COVERING THE KEY CARE DELIVERY SETTINGS IN THE U.S.; 2) THROUGH THE NATIONAL DEMENTIA WORKFORCE STUDY, BUILD A DATA INFRASTRUCTURE SURROUNDING THE DEMENTIA WORKFORCE SURVEYS THAT ALLOWS RESEARCHERS TO GENERATE CRITICAL INSIGHTS INTO THE PROFESSIONAL DEMENTIA CARE WORKFORCE AND ASSOCIATED OUTCOMES FOR PLWD; AND 3) DEVELOP AND EXPAND THE COMMUNITY OF RESEARCHERS FOCUSED ON THE PROFESSIONAL DEMENTIA CARE WORKFORCE OVERALL AND THAT USE THE NATIONAL DEMENTIA WORKFORCE STUDY DATA INFRASTRUCTURE."},{"award_id":"W56HZV1920001","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Defense","funding_agency":"Department of Defense","fiscal_year":2023,"award_amount":44089743.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"AWARD OF BASE AGREEMENT, INCLUDES FIVE AREAS OF TECHNOLOGY: -VEHICLE DYNAMICS, CONTROL, & ADAPTIVE BEHAVIOR, -HUMAN-CENTERED DESIGN & HUMAN-AUTONOMY"},{"award_id":"W56HZV1920001","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Defense","funding_agency":"Department of Defense","fiscal_year":2024,"award_amount":44089743.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"AWARD OF BASE AGREEMENT, INCLUDES FIVE AREAS OF TECHNOLOGY: -VEHICLE DYNAMICS, CONTROL, & ADAPTIVE BEHAVIOR, -HUMAN-CENTERED DESIGN & HUMAN-AUTONOMY"},{"award_id":"2241144","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"National Science Foundation","funding_agency":"National Science Foundation","fiscal_year":2023,"award_amount":41100753.0,"award_type":"PROJECT GRANT (B)","description":"GRADUATE RESEARCH FELLOWSHIP PROGRAM (GRFP) -THE NATIONAL SCIENCE FOUNDATION (NSF) GRADUATE RESEARCH FELLOWSHIP PROGRAM (GRFP) IS A HIGHLY COMPETITIVE, FEDERAL FELLOWSHIP PROGRAM. GRFP HELPS ENSURE THE VITALITY AND DIVERSITY OF THE SCIENTIFIC AND ENGINEERING WORKFORCE OF THE UNITED STATES. THE PROGRAM RECOGNIZES AND SUPPORTS OUTSTANDING GRADUATE STUDENTS WHO ARE PURSUING RESEARCH-BASED MASTER'S AND DOCTORAL DEGREES IN SCIENCE, TECHNOLOGY, ENGINEERING, AND MATHEMATICS (STEM) AND IN STEM EDUCATION. THE GRFP PROVIDES THREE YEARS OF FINANCIAL SUPPORT FOR THE GRADUATE EDUCATION OF INDIVIDUALS WHO HAVE DEMONSTRATED THEIR POTENTIAL FOR SIGNIFICANT RESEARCH ACHIEVEMENTS IN STEM AND STEM EDUCATION. THIS AWARD SUPPORTS THE NSF GRADUATE FELLOWS PURSUING GRADUATE EDUCATION AT THIS GRFP INSTITUTION. THIS AWARD REFLECTS NSF'S STATUTORY MISSION AND HAS BEEN DEEMED WORTHY OF SUPPORT THROUGH EVALUATION USING THE FOUNDATION'S INTELLECTUAL MERIT AND BROADER IMPACTS REVIEW CRITERIA."},{"award_id":"2241144","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"National Science Foundation","funding_agency":"National Science Foundation","fiscal_year":2024,"award_amount":41100753.0,"award_type":"PROJECT GRANT (B)","description":"GRADUATE RESEARCH FELLOWSHIP PROGRAM (GRFP) -THE NATIONAL SCIENCE FOUNDATION (NSF) GRADUATE RESEARCH FELLOWSHIP PROGRAM (GRFP) IS A HIGHLY COMPETITIVE, FEDERAL FELLOWSHIP PROGRAM. GRFP HELPS ENSURE THE VITALITY AND DIVERSITY OF THE SCIENTIFIC AND ENGINEERING WORKFORCE OF THE UNITED STATES. THE PROGRAM RECOGNIZES AND SUPPORTS OUTSTANDING GRADUATE STUDENTS WHO ARE PURSUING RESEARCH-BASED MASTER'S AND DOCTORAL DEGREES IN SCIENCE, TECHNOLOGY, ENGINEERING, AND MATHEMATICS (STEM) AND IN STEM EDUCATION. THE GRFP PROVIDES THREE YEARS OF FINANCIAL SUPPORT FOR THE GRADUATE EDUCATION OF INDIVIDUALS WHO HAVE DEMONSTRATED THEIR POTENTIAL FOR SIGNIFICANT RESEARCH ACHIEVEMENTS IN STEM AND STEM EDUCATION. THIS AWARD SUPPORTS THE NSF GRADUATE FELLOWS PURSUING GRADUATE EDUCATION AT THIS GRFP INSTITUTION. THIS AWARD REFLECTS NSF'S STATUTORY MISSION AND HAS BEEN DEEMED WORTHY OF SUPPORT THROUGH EVALUATION USING THE FOUNDATION'S INTELLECTUAL MERIT AND BROADER IMPACTS REVIEW CRITERIA."},{"award_id":"2241144","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"National Science Foundation","funding_agency":"National Science Foundation","fiscal_year":2025,"award_amount":41100753.0,"award_type":"PROJECT GRANT (B)","description":"GRADUATE RESEARCH FELLOWSHIP PROGRAM (GRFP) -THE NATIONAL SCIENCE FOUNDATION (NSF) GRADUATE RESEARCH FELLOWSHIP PROGRAM (GRFP) IS A HIGHLY COMPETITIVE, FEDERAL FELLOWSHIP PROGRAM. GRFP HELPS ENSURE THE VITALITY AND DIVERSITY OF THE SCIENTIFIC AND ENGINEERING WORKFORCE OF THE UNITED STATES. THE PROGRAM RECOGNIZES AND SUPPORTS OUTSTANDING GRADUATE STUDENTS WHO ARE PURSUING RESEARCH-BASED MASTER'S AND DOCTORAL DEGREES IN SCIENCE, TECHNOLOGY, ENGINEERING, AND MATHEMATICS (STEM) AND IN STEM EDUCATION. THE GRFP PROVIDES THREE YEARS OF FINANCIAL SUPPORT FOR THE GRADUATE EDUCATION OF INDIVIDUALS WHO HAVE DEMONSTRATED THEIR POTENTIAL FOR SIGNIFICANT RESEARCH ACHIEVEMENTS IN STEM AND STEM EDUCATION. THIS AWARD SUPPORTS THE NSF GRADUATE FELLOWS PURSUING GRADUATE EDUCATION AT THIS GRFP INSTITUTION. THIS AWARD REFLECTS NSF'S STATUTORY MISSION AND HAS BEEN DEEMED WORTHY OF SUPPORT THROUGH EVALUATION USING THE FOUNDATION'S INTELLECTUAL MERIT AND BROADER IMPACTS REVIEW CRITERIA."},{"award_id":"UM1TR004404","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":39816036.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"MICHIGAN INSTITUTE FOR CLINICAL AND HEALTH RESEARCH (MICHR) - PROJECT SUMMARY/ABSTRACT THE MICHIGAN INSTITUTE FOR CLINICAL & HEALTH RESEARCH (MICHR) CATALYZES CLINICAL AND TRANSLATIONAL RESEARCH (CTR) AND ADVANCES CLINICAL AND TRANSLATIONAL SCIENCE (CTS) AT THE UNIVERSITY OF MICHIGAN (U-M), THROUGHOUT THE STATE OF MICHIGAN, AND NATIONALLY. WE HAVE TRANSFORMED CTR AT U-M AND HAVE BEEN A COLLABORATIVE PARTNER WITH UNIVERSITY UNITS, MICHIGAN COMMUNITIES, AND THE CLINICAL AND TRANSLATIONAL SCIENCE AWARD (CTSA) CONSORTIUM. IN THE NEXT SEVEN YEARS, MICHR WILL ACHIEVE GREATER INNOVATION, DIVERSITY, EFFICIENCY, EQUITY, QUALITY, INCLUSION, AND REACH IN CTR AND DEVELOP, DEMONSTRATE, AND DISSEMINATE GENERALIZABLE CTS INNOVATIONS. THIS VISION COMPRISES FIVE STRATEGIC GOALS: 1) EXPAND THE DIVERSITY OF VOICES DRIVING THE STRATEGIC DIRECTION OF CTR AND CTS. WITH OUR COMMUNITY PARTNERS, WE WILL CO-DEVELOP STRATEGIES TO ELEVATE DIVERSE VOICES IN CTS LEADERSHIP. THE MICHIGAN COMMUNITY EQUITY REVIEW BOARD WILL ENSURE INTEGRATION OF COMMUNITY VOICE AND CULTURE IN RESEARCH THROUGHOUT THE STATE. THE PATIENTS AS PARTNERS PROGRAM WILL ENGAGE PATIENTS IN STUDY DEVELOPMENT AND MENTORING. 2) EXTEND CTR TO THE STATE AND INCREASE ENGAGEMENT WITH NATIONAL CTR THROUGH CTS INNOVATIONS. WE WILL INCREASE ACCESS TO RESEARCH BY DEVELOPING CTR CAPACITY STATEWIDE. THE M- REACH PLATFORM WILL FACILITATE COMMUNITY-ACADEMIC CONNECTIONS. THE NETWORK CONNECTOR WILL CONNECT STUDY TEAMS, NATIONAL NETWORKS, AND UNIVERSITY PARTNERS. 3) ENGAGE NEW GROUPS IN CTR AND CTS THROUGH NEW PATHWAYS AND SUPPORTS. WE WILL SUPPORT THE CTR WORKFORCE STATEWIDE THROUGH NEW TRAININGS, MENTORING PROGRAMS, APPRENTICESHIPS, AND COMMUNITIES OF PRACTICE. WE WILL DEVELOP RESEARCH TRAINING PROGRAMS TAILORED TO CLINICAL PRACTICE-FOCUSED PHYSICIANS. STUDY TEAMS WILL INCLUDE COMMUNITY MEMBERS AND PATIENTS AND BE SUPPORTED BY TEAM SCIENCE INITIATIVES AND PILOT GRANT FUNDING. 4) EXTEND TRANSLATION THROUGH DISSEMINATION AND IMPLEMENTATION SCIENCE AND APPLICATION. THE DISSEMINATION & IMPLEMENTATION CATALYST WILL ADVANCE THE SCIENCE AND APPLICATION OF DISSEMINATION AND IMPLEMENTATION FOR CTR AND CTS. WITH OUR COMMUNITY PARTNERS, WE WILL CO-DEVELOP TOOLS FOR EFFECTIVE ACADEMIC-COMMUNITY RESEARCH PARTNERSHIPS DURING A PUBLIC HEALTH EMERGENCY. WE WILL ENABLE RAPID TRANSLATION OF IDEAS INTO ACTIONABLE SOLUTIONS THROUGH HUMAN-CENTERED DESIGN. 5) EXTEND MICHR SERVICES TO ADVANCE INNOVATION, QUALITY, AND EFFICIENCY OF DIVERSE TYPES OF CTR. WE WILL HELP ACADEMICS AND COMMUNITY MEMBERS DEVELOP SKILLS IN THE SCIENCE OF COMMUNITY-ENGAGED RESEARCH. WE WILL DEVELOP TRAINING PROGRAMS AND TOOLS AS WELL AS EXTEND AND ADAPT OUR SERVICES TO ENSURE RIGOR AND EFFICIENCY OF HEALTH-RELATED BEHAVIORAL AND SOCIAL SCIENCE RESEARCH. WE WILL ADD NEW FEATURES TO OUR ELECTRONIC MEDICAL RECORD SEARCH ENGINE AND OUR PARTICIPANT RECRUITMENT PLATFORM TO INCREASE INCLUSIVITY. WE WILL DETERMINE COST- EFFECTIVENESS AND EFFECT ON CLINICAL TRIAL PERFORMANCE OF STRATEGIES FOR IMPROVING PROTOCOL QUALITY. IN SUMMARY, MICHR IS POISED TO ENTER ITS THIRD DECADE OF ADVANCING CTR AND CTS THROUGHOUT MICHIGAN AND THE NATION."},{"award_id":"UM1TR004404","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":39816036.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"MICHIGAN INSTITUTE FOR CLINICAL AND HEALTH RESEARCH (MICHR) - PROJECT SUMMARY/ABSTRACT THE MICHIGAN INSTITUTE FOR CLINICAL & HEALTH RESEARCH (MICHR) CATALYZES CLINICAL AND TRANSLATIONAL RESEARCH (CTR) AND ADVANCES CLINICAL AND TRANSLATIONAL SCIENCE (CTS) AT THE UNIVERSITY OF MICHIGAN (U-M), THROUGHOUT THE STATE OF MICHIGAN, AND NATIONALLY. WE HAVE TRANSFORMED CTR AT U-M AND HAVE BEEN A COLLABORATIVE PARTNER WITH UNIVERSITY UNITS, MICHIGAN COMMUNITIES, AND THE CLINICAL AND TRANSLATIONAL SCIENCE AWARD (CTSA) CONSORTIUM. IN THE NEXT SEVEN YEARS, MICHR WILL ACHIEVE GREATER INNOVATION, DIVERSITY, EFFICIENCY, EQUITY, QUALITY, INCLUSION, AND REACH IN CTR AND DEVELOP, DEMONSTRATE, AND DISSEMINATE GENERALIZABLE CTS INNOVATIONS. THIS VISION COMPRISES FIVE STRATEGIC GOALS: 1) EXPAND THE DIVERSITY OF VOICES DRIVING THE STRATEGIC DIRECTION OF CTR AND CTS. WITH OUR COMMUNITY PARTNERS, WE WILL CO-DEVELOP STRATEGIES TO ELEVATE DIVERSE VOICES IN CTS LEADERSHIP. THE MICHIGAN COMMUNITY EQUITY REVIEW BOARD WILL ENSURE INTEGRATION OF COMMUNITY VOICE AND CULTURE IN RESEARCH THROUGHOUT THE STATE. THE PATIENTS AS PARTNERS PROGRAM WILL ENGAGE PATIENTS IN STUDY DEVELOPMENT AND MENTORING. 2) EXTEND CTR TO THE STATE AND INCREASE ENGAGEMENT WITH NATIONAL CTR THROUGH CTS INNOVATIONS. WE WILL INCREASE ACCESS TO RESEARCH BY DEVELOPING CTR CAPACITY STATEWIDE. THE M- REACH PLATFORM WILL FACILITATE COMMUNITY-ACADEMIC CONNECTIONS. THE NETWORK CONNECTOR WILL CONNECT STUDY TEAMS, NATIONAL NETWORKS, AND UNIVERSITY PARTNERS. 3) ENGAGE NEW GROUPS IN CTR AND CTS THROUGH NEW PATHWAYS AND SUPPORTS. WE WILL SUPPORT THE CTR WORKFORCE STATEWIDE THROUGH NEW TRAININGS, MENTORING PROGRAMS, APPRENTICESHIPS, AND COMMUNITIES OF PRACTICE. WE WILL DEVELOP RESEARCH TRAINING PROGRAMS TAILORED TO CLINICAL PRACTICE-FOCUSED PHYSICIANS. STUDY TEAMS WILL INCLUDE COMMUNITY MEMBERS AND PATIENTS AND BE SUPPORTED BY TEAM SCIENCE INITIATIVES AND PILOT GRANT FUNDING. 4) EXTEND TRANSLATION THROUGH DISSEMINATION AND IMPLEMENTATION SCIENCE AND APPLICATION. THE DISSEMINATION & IMPLEMENTATION CATALYST WILL ADVANCE THE SCIENCE AND APPLICATION OF DISSEMINATION AND IMPLEMENTATION FOR CTR AND CTS. WITH OUR COMMUNITY PARTNERS, WE WILL CO-DEVELOP TOOLS FOR EFFECTIVE ACADEMIC-COMMUNITY RESEARCH PARTNERSHIPS DURING A PUBLIC HEALTH EMERGENCY. WE WILL ENABLE RAPID TRANSLATION OF IDEAS INTO ACTIONABLE SOLUTIONS THROUGH HUMAN-CENTERED DESIGN. 5) EXTEND MICHR SERVICES TO ADVANCE INNOVATION, QUALITY, AND EFFICIENCY OF DIVERSE TYPES OF CTR. WE WILL HELP ACADEMICS AND COMMUNITY MEMBERS DEVELOP SKILLS IN THE SCIENCE OF COMMUNITY-ENGAGED RESEARCH. WE WILL DEVELOP TRAINING PROGRAMS AND TOOLS AS WELL AS EXTEND AND ADAPT OUR SERVICES TO ENSURE RIGOR AND EFFICIENCY OF HEALTH-RELATED BEHAVIORAL AND SOCIAL SCIENCE RESEARCH. WE WILL ADD NEW FEATURES TO OUR ELECTRONIC MEDICAL RECORD SEARCH ENGINE AND OUR PARTICIPANT RECRUITMENT PLATFORM TO INCREASE INCLUSIVITY. WE WILL DETERMINE COST- EFFECTIVENESS AND EFFECT ON CLINICAL TRIAL PERFORMANCE OF STRATEGIES FOR IMPROVING PROTOCOL QUALITY. IN SUMMARY, MICHR IS POISED TO ENTER ITS THIRD DECADE OF ADVANCING CTR AND CTS THROUGHOUT MICHIGAN AND THE NATION."},{"award_id":"UM1TR004404","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":39816036.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"MICHIGAN INSTITUTE FOR CLINICAL AND HEALTH RESEARCH (MICHR) - PROJECT SUMMARY/ABSTRACT THE MICHIGAN INSTITUTE FOR CLINICAL & HEALTH RESEARCH (MICHR) CATALYZES CLINICAL AND TRANSLATIONAL RESEARCH (CTR) AND ADVANCES CLINICAL AND TRANSLATIONAL SCIENCE (CTS) AT THE UNIVERSITY OF MICHIGAN (U-M), THROUGHOUT THE STATE OF MICHIGAN, AND NATIONALLY. WE HAVE TRANSFORMED CTR AT U-M AND HAVE BEEN A COLLABORATIVE PARTNER WITH UNIVERSITY UNITS, MICHIGAN COMMUNITIES, AND THE CLINICAL AND TRANSLATIONAL SCIENCE AWARD (CTSA) CONSORTIUM. IN THE NEXT SEVEN YEARS, MICHR WILL ACHIEVE GREATER INNOVATION, DIVERSITY, EFFICIENCY, EQUITY, QUALITY, INCLUSION, AND REACH IN CTR AND DEVELOP, DEMONSTRATE, AND DISSEMINATE GENERALIZABLE CTS INNOVATIONS. THIS VISION COMPRISES FIVE STRATEGIC GOALS: 1) EXPAND THE DIVERSITY OF VOICES DRIVING THE STRATEGIC DIRECTION OF CTR AND CTS. WITH OUR COMMUNITY PARTNERS, WE WILL CO-DEVELOP STRATEGIES TO ELEVATE DIVERSE VOICES IN CTS LEADERSHIP. THE MICHIGAN COMMUNITY EQUITY REVIEW BOARD WILL ENSURE INTEGRATION OF COMMUNITY VOICE AND CULTURE IN RESEARCH THROUGHOUT THE STATE. THE PATIENTS AS PARTNERS PROGRAM WILL ENGAGE PATIENTS IN STUDY DEVELOPMENT AND MENTORING. 2) EXTEND CTR TO THE STATE AND INCREASE ENGAGEMENT WITH NATIONAL CTR THROUGH CTS INNOVATIONS. WE WILL INCREASE ACCESS TO RESEARCH BY DEVELOPING CTR CAPACITY STATEWIDE. THE M- REACH PLATFORM WILL FACILITATE COMMUNITY-ACADEMIC CONNECTIONS. THE NETWORK CONNECTOR WILL CONNECT STUDY TEAMS, NATIONAL NETWORKS, AND UNIVERSITY PARTNERS. 3) ENGAGE NEW GROUPS IN CTR AND CTS THROUGH NEW PATHWAYS AND SUPPORTS. WE WILL SUPPORT THE CTR WORKFORCE STATEWIDE THROUGH NEW TRAININGS, MENTORING PROGRAMS, APPRENTICESHIPS, AND COMMUNITIES OF PRACTICE. WE WILL DEVELOP RESEARCH TRAINING PROGRAMS TAILORED TO CLINICAL PRACTICE-FOCUSED PHYSICIANS. STUDY TEAMS WILL INCLUDE COMMUNITY MEMBERS AND PATIENTS AND BE SUPPORTED BY TEAM SCIENCE INITIATIVES AND PILOT GRANT FUNDING. 4) EXTEND TRANSLATION THROUGH DISSEMINATION AND IMPLEMENTATION SCIENCE AND APPLICATION. THE DISSEMINATION & IMPLEMENTATION CATALYST WILL ADVANCE THE SCIENCE AND APPLICATION OF DISSEMINATION AND IMPLEMENTATION FOR CTR AND CTS. WITH OUR COMMUNITY PARTNERS, WE WILL CO-DEVELOP TOOLS FOR EFFECTIVE ACADEMIC-COMMUNITY RESEARCH PARTNERSHIPS DURING A PUBLIC HEALTH EMERGENCY. WE WILL ENABLE RAPID TRANSLATION OF IDEAS INTO ACTIONABLE SOLUTIONS THROUGH HUMAN-CENTERED DESIGN. 5) EXTEND MICHR SERVICES TO ADVANCE INNOVATION, QUALITY, AND EFFICIENCY OF DIVERSE TYPES OF CTR. WE WILL HELP ACADEMICS AND COMMUNITY MEMBERS DEVELOP SKILLS IN THE SCIENCE OF COMMUNITY-ENGAGED RESEARCH. WE WILL DEVELOP TRAINING PROGRAMS AND TOOLS AS WELL AS EXTEND AND ADAPT OUR SERVICES TO ENSURE RIGOR AND EFFICIENCY OF HEALTH-RELATED BEHAVIORAL AND SOCIAL SCIENCE RESEARCH. WE WILL ADD NEW FEATURES TO OUR ELECTRONIC MEDICAL RECORD SEARCH ENGINE AND OUR PARTICIPANT RECRUITMENT PLATFORM TO INCREASE INCLUSIVITY. WE WILL DETERMINE COST- EFFECTIVENESS AND EFFECT ON CLINICAL TRIAL PERFORMANCE OF STRATEGIES FOR IMPROVING PROTOCOL QUALITY. IN SUMMARY, MICHR IS POISED TO ENTER ITS THIRD DECADE OF ADVANCING CTR AND CTS THROUGHOUT MICHIGAN AND THE NATION."},{"award_id":"1946932","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"National Science Foundation","funding_agency":"National Science Foundation","fiscal_year":2023,"award_amount":38357018.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"MID-SCALE RI-2: THE RESEARCH DATA ECOSYSTEM (RDE), A NATIONAL RESOURCE FOR REPRODUCIBLE, ROBUST, AND TRANSPARENT SOCIAL SCIENCE RESEARCH IN THE 21ST CENTURY -THIS PROJECT WILL IMPLEMENT A NEW PLATFORM FOR SOCIAL AND BEHAVIORAL SCIENCE DATA. DIVERSE TYPES OF DATA ENABLE PATH-BREAKING ANALYSES INTO HUMAN BEHAVIOR BUT ALSO PRESENT CHALLENGES OF SCALE, SENSITIVITY, AND STRUCTURE. CURRENT BARRIERS TO CONDUCTING RESEARCH INCLUDE MULTIPLE INCOMPATIBLE STANDARDS FOR DATA, LACK OF INTEROPERABILITY, AND THE INHERENT DIFFICULTY OF MANAGING BIG DATA. THERE IS AN URGENT NEED FOR NEW MODES OF ACCESS, CONFIDENTIALITY PROTECTION, METHODOLOGICAL APPROACHES, AND TOOLS SO THAT RESEARCH USING A VARIETY OF DATA TYPES MEETS ACCEPTED SCIENTIFIC STANDARDS. THE RESEARCH DATA ECOSYSTEM (RDE) WILL MODERNIZE THE MANAGEMENT OF DATA TO ENABLE A NEW ERA OF INTERCONNECTED RESEARCH FOR THE SOCIAL AND BEHAVIORAL SCIENCES. THE PLATFORM WILL IMPROVE THE QUALITY OF DATA-DRIVEN SOCIAL AND BEHAVIORAL SCIENCE RESEARCH OVER THE ENTIRE DATA LIFE CYCLE. RDE WILL ENABLE RESEARCHERS ACROSS DISCIPLINES TO CONDUCT THEIR WORK MORE EFFICIENTLY AND TO CREATE, ORGANIZE, ARCHIVE, ACCESS, AND ANALYZE DATA IN WAYS THAT THEY CANNOT WITH EXISTING INFRASTRUCTURE. RDE WILL MAKE SOCIAL AND BEHAVIORAL DATA MORE USABLE OUTSIDE OF ACADEMIA BY MAKING IT MORE FINDABLE AND ACCESSIBLE. THE PROJECT WILL PROVIDE TRAINING OPPORTUNITIES FOR GRADUATE AND UNDERGRADUATE STUDENTS AND WILL BROADEN AND DIVERSIFY PARTICIPATION IN THE SOCIAL AND BEHAVIORAL SCIENCES BY REMOVING TECHNICAL BOTTLENECKS TO RESEARCH. THIS PROJECT IS SUPPORTED BY THE FOUNDATION-WIDE MID-SCALE RESEARCH INFRASTRUCTURE PROGRAM. THIS PROJECT WILL DEVELOP AN INTEGRATED SUITE OF SOFTWARE TO ADVANCE RESEARCH IN THE SOCIAL AND BEHAVIORAL SCIENCES. RDE WILL ENABLE: 1) INTEROPERABILITY: AN INTEGRATED SYSTEM FOR THE ENTIRE RESEARCH DATA LIFECYCLE, SO THAT WORK DONE EARLY IN THE DATA LIFECYCLE IS USEFUL AT LATER STAGES, MAKING IT POSSIBLE TO INTEGRATE DATA FROM DIFFERENT SOURCES, 2) REPRODUCIBILITY: MAKING IT EASIER TO REPRODUCE AND BUILD ON PRIOR RESEARCH RESULTS BY BEING ABLE TO FIND AND RE-USE DATA AND CODE, 3) TRANSPARENCY: PROVIDING INFORMATION ABOUT PROVENANCE, INCLUDING SOURCE, CODE, METHOD OF COLLECTION, ETC. FOR RESEARCH DATA, 4) INCREASED EFFICIENCY OF DATA SHARING: REDUCING BURDEN ON DATA PRODUCERS IN SHARING DATA AND ENSURING THAT SHARED DATA ARE FAIR (FINDABLE, ACCESSIBLE, INTEROPERABLE, REUSABLE), AND 5) CONFIDENTIALITY PROTECTION: PROTECTING CONFIDENTIALITY WHILE INCREASING RESEARCH ACCESS. TO ACHIEVE THESE GOALS, THE PROJECT WILL DEVELOP THE RESEARCH DATA DESCRIPTION FRAMEWORK, A METADATA SPECIFICATION SIMILAR TO THE RESOURCE DESCRIPTION FRAMEWORK, FOR DESCRIBING DIFFERENT RESEARCH DATA LIFECYCLE EVENTS. RDE WILL INCLUDE STAND-ALONE FUNCTIONAL COMPONENTS FOR EACH STAGE OF THE RESEARCH LIFECYCLE THAT WILL BE INTEROPERABLE WITH ONE ANOTHER AND WITH KEY EXISTING RESEARCH INFRASTRUCTURE. THE PLATFORM WILL SUPPORT SOCIAL AND BEHAVIORAL SCIENCE RESEARCHERS USING TRADITIONAL (E.G., SURVEY AND EXPERIMENTAL) AND NOVEL (E.G., DIGITAL TRACE, IMAGING) TYPES OF DATA OVER THE ENTIRE RESEARCH LIFECYCLE, FROM DATA COLLECTION TO ANALYSIS TO SHARING TO RE-DISCOVERY AND RE-ANALYSIS. THIS INFRASTRUCTURE WILL IMPROVE THE QUALITY, INTEGRITY, AND SAFETY OF DATA WHILE INCREASING ACCESSIBILITY TO DATA AND COLLABORATION BETWEEN USERS ACROSS ALL SOCIAL SCIENCE AND SOME BEHAVIORAL SCIENCE DISCIPLINES. THIS AWARD REFLECTS NSF'S STATUTORY MISSION AND HAS BEEN DEEMED WORTHY OF SUPPORT THROUGH EVALUATION USING THE FOUNDATION'S INTELLECTUAL MERIT AND BROADER IMPACTS REVIEW CRITERIA."},{"award_id":"1946932","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"National Science Foundation","funding_agency":"National Science Foundation","fiscal_year":2024,"award_amount":38357018.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"MID-SCALE RI-2: THE RESEARCH DATA ECOSYSTEM (RDE), A NATIONAL RESOURCE FOR REPRODUCIBLE, ROBUST, AND TRANSPARENT SOCIAL SCIENCE RESEARCH IN THE 21ST CENTURY -THIS PROJECT WILL IMPLEMENT A NEW PLATFORM FOR SOCIAL AND BEHAVIORAL SCIENCE DATA. DIVERSE TYPES OF DATA ENABLE PATH-BREAKING ANALYSES INTO HUMAN BEHAVIOR BUT ALSO PRESENT CHALLENGES OF SCALE, SENSITIVITY, AND STRUCTURE. CURRENT BARRIERS TO CONDUCTING RESEARCH INCLUDE MULTIPLE INCOMPATIBLE STANDARDS FOR DATA, LACK OF INTEROPERABILITY, AND THE INHERENT DIFFICULTY OF MANAGING BIG DATA. THERE IS AN URGENT NEED FOR NEW MODES OF ACCESS, CONFIDENTIALITY PROTECTION, METHODOLOGICAL APPROACHES, AND TOOLS SO THAT RESEARCH USING A VARIETY OF DATA TYPES MEETS ACCEPTED SCIENTIFIC STANDARDS. THE RESEARCH DATA ECOSYSTEM (RDE) WILL MODERNIZE THE MANAGEMENT OF DATA TO ENABLE A NEW ERA OF INTERCONNECTED RESEARCH FOR THE SOCIAL AND BEHAVIORAL SCIENCES. THE PLATFORM WILL IMPROVE THE QUALITY OF DATA-DRIVEN SOCIAL AND BEHAVIORAL SCIENCE RESEARCH OVER THE ENTIRE DATA LIFE CYCLE. RDE WILL ENABLE RESEARCHERS ACROSS DISCIPLINES TO CONDUCT THEIR WORK MORE EFFICIENTLY AND TO CREATE, ORGANIZE, ARCHIVE, ACCESS, AND ANALYZE DATA IN WAYS THAT THEY CANNOT WITH EXISTING INFRASTRUCTURE. RDE WILL MAKE SOCIAL AND BEHAVIORAL DATA MORE USABLE OUTSIDE OF ACADEMIA BY MAKING IT MORE FINDABLE AND ACCESSIBLE. THE PROJECT WILL PROVIDE TRAINING OPPORTUNITIES FOR GRADUATE AND UNDERGRADUATE STUDENTS AND WILL BROADEN AND DIVERSIFY PARTICIPATION IN THE SOCIAL AND BEHAVIORAL SCIENCES BY REMOVING TECHNICAL BOTTLENECKS TO RESEARCH. THIS PROJECT IS SUPPORTED BY THE FOUNDATION-WIDE MID-SCALE RESEARCH INFRASTRUCTURE PROGRAM. THIS PROJECT WILL DEVELOP AN INTEGRATED SUITE OF SOFTWARE TO ADVANCE RESEARCH IN THE SOCIAL AND BEHAVIORAL SCIENCES. RDE WILL ENABLE: 1) INTEROPERABILITY: AN INTEGRATED SYSTEM FOR THE ENTIRE RESEARCH DATA LIFECYCLE, SO THAT WORK DONE EARLY IN THE DATA LIFECYCLE IS USEFUL AT LATER STAGES, MAKING IT POSSIBLE TO INTEGRATE DATA FROM DIFFERENT SOURCES, 2) REPRODUCIBILITY: MAKING IT EASIER TO REPRODUCE AND BUILD ON PRIOR RESEARCH RESULTS BY BEING ABLE TO FIND AND RE-USE DATA AND CODE, 3) TRANSPARENCY: PROVIDING INFORMATION ABOUT PROVENANCE, INCLUDING SOURCE, CODE, METHOD OF COLLECTION, ETC. FOR RESEARCH DATA, 4) INCREASED EFFICIENCY OF DATA SHARING: REDUCING BURDEN ON DATA PRODUCERS IN SHARING DATA AND ENSURING THAT SHARED DATA ARE FAIR (FINDABLE, ACCESSIBLE, INTEROPERABLE, REUSABLE), AND 5) CONFIDENTIALITY PROTECTION: PROTECTING CONFIDENTIALITY WHILE INCREASING RESEARCH ACCESS. TO ACHIEVE THESE GOALS, THE PROJECT WILL DEVELOP THE RESEARCH DATA DESCRIPTION FRAMEWORK, A METADATA SPECIFICATION SIMILAR TO THE RESOURCE DESCRIPTION FRAMEWORK, FOR DESCRIBING DIFFERENT RESEARCH DATA LIFECYCLE EVENTS. RDE WILL INCLUDE STAND-ALONE FUNCTIONAL COMPONENTS FOR EACH STAGE OF THE RESEARCH LIFECYCLE THAT WILL BE INTEROPERABLE WITH ONE ANOTHER AND WITH KEY EXISTING RESEARCH INFRASTRUCTURE. THE PLATFORM WILL SUPPORT SOCIAL AND BEHAVIORAL SCIENCE RESEARCHERS USING TRADITIONAL (E.G., SURVEY AND EXPERIMENTAL) AND NOVEL (E.G., DIGITAL TRACE, IMAGING) TYPES OF DATA OVER THE ENTIRE RESEARCH LIFECYCLE, FROM DATA COLLECTION TO ANALYSIS TO SHARING TO RE-DISCOVERY AND RE-ANALYSIS. THIS INFRASTRUCTURE WILL IMPROVE THE QUALITY, INTEGRITY, AND SAFETY OF DATA WHILE INCREASING ACCESSIBILITY TO DATA AND COLLABORATION BETWEEN USERS ACROSS ALL SOCIAL SCIENCE AND SOME BEHAVIORAL SCIENCE DISCIPLINES. THIS AWARD REFLECTS NSF'S STATUTORY MISSION AND HAS BEEN DEEMED WORTHY OF SUPPORT THROUGH EVALUATION USING THE FOUNDATION'S INTELLECTUAL MERIT AND BROADER IMPACTS REVIEW CRITERIA."},{"award_id":"1946932","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"National Science Foundation","funding_agency":"National Science Foundation","fiscal_year":2025,"award_amount":38357018.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"MID-SCALE RI-2: THE RESEARCH DATA ECOSYSTEM (RDE), A NATIONAL RESOURCE FOR REPRODUCIBLE, ROBUST, AND TRANSPARENT SOCIAL SCIENCE RESEARCH IN THE 21ST CENTURY -THIS PROJECT WILL IMPLEMENT A NEW PLATFORM FOR SOCIAL AND BEHAVIORAL SCIENCE DATA. DIVERSE TYPES OF DATA ENABLE PATH-BREAKING ANALYSES INTO HUMAN BEHAVIOR BUT ALSO PRESENT CHALLENGES OF SCALE, SENSITIVITY, AND STRUCTURE. CURRENT BARRIERS TO CONDUCTING RESEARCH INCLUDE MULTIPLE INCOMPATIBLE STANDARDS FOR DATA, LACK OF INTEROPERABILITY, AND THE INHERENT DIFFICULTY OF MANAGING BIG DATA. THERE IS AN URGENT NEED FOR NEW MODES OF ACCESS, CONFIDENTIALITY PROTECTION, METHODOLOGICAL APPROACHES, AND TOOLS SO THAT RESEARCH USING A VARIETY OF DATA TYPES MEETS ACCEPTED SCIENTIFIC STANDARDS. THE RESEARCH DATA ECOSYSTEM (RDE) WILL MODERNIZE THE MANAGEMENT OF DATA TO ENABLE A NEW ERA OF INTERCONNECTED RESEARCH FOR THE SOCIAL AND BEHAVIORAL SCIENCES. THE PLATFORM WILL IMPROVE THE QUALITY OF DATA-DRIVEN SOCIAL AND BEHAVIORAL SCIENCE RESEARCH OVER THE ENTIRE DATA LIFE CYCLE. RDE WILL ENABLE RESEARCHERS ACROSS DISCIPLINES TO CONDUCT THEIR WORK MORE EFFICIENTLY AND TO CREATE, ORGANIZE, ARCHIVE, ACCESS, AND ANALYZE DATA IN WAYS THAT THEY CANNOT WITH EXISTING INFRASTRUCTURE. RDE WILL MAKE SOCIAL AND BEHAVIORAL DATA MORE USABLE OUTSIDE OF ACADEMIA BY MAKING IT MORE FINDABLE AND ACCESSIBLE. THE PROJECT WILL PROVIDE TRAINING OPPORTUNITIES FOR GRADUATE AND UNDERGRADUATE STUDENTS AND WILL BROADEN AND DIVERSIFY PARTICIPATION IN THE SOCIAL AND BEHAVIORAL SCIENCES BY REMOVING TECHNICAL BOTTLENECKS TO RESEARCH. THIS PROJECT IS SUPPORTED BY THE FOUNDATION-WIDE MID-SCALE RESEARCH INFRASTRUCTURE PROGRAM. THIS PROJECT WILL DEVELOP AN INTEGRATED SUITE OF SOFTWARE TO ADVANCE RESEARCH IN THE SOCIAL AND BEHAVIORAL SCIENCES. RDE WILL ENABLE: 1) INTEROPERABILITY: AN INTEGRATED SYSTEM FOR THE ENTIRE RESEARCH DATA LIFECYCLE, SO THAT WORK DONE EARLY IN THE DATA LIFECYCLE IS USEFUL AT LATER STAGES, MAKING IT POSSIBLE TO INTEGRATE DATA FROM DIFFERENT SOURCES, 2) REPRODUCIBILITY: MAKING IT EASIER TO REPRODUCE AND BUILD ON PRIOR RESEARCH RESULTS BY BEING ABLE TO FIND AND RE-USE DATA AND CODE, 3) TRANSPARENCY: PROVIDING INFORMATION ABOUT PROVENANCE, INCLUDING SOURCE, CODE, METHOD OF COLLECTION, ETC. FOR RESEARCH DATA, 4) INCREASED EFFICIENCY OF DATA SHARING: REDUCING BURDEN ON DATA PRODUCERS IN SHARING DATA AND ENSURING THAT SHARED DATA ARE FAIR (FINDABLE, ACCESSIBLE, INTEROPERABLE, REUSABLE), AND 5) CONFIDENTIALITY PROTECTION: PROTECTING CONFIDENTIALITY WHILE INCREASING RESEARCH ACCESS. TO ACHIEVE THESE GOALS, THE PROJECT WILL DEVELOP THE RESEARCH DATA DESCRIPTION FRAMEWORK, A METADATA SPECIFICATION SIMILAR TO THE RESOURCE DESCRIPTION FRAMEWORK, FOR DESCRIBING DIFFERENT RESEARCH DATA LIFECYCLE EVENTS. RDE WILL INCLUDE STAND-ALONE FUNCTIONAL COMPONENTS FOR EACH STAGE OF THE RESEARCH LIFECYCLE THAT WILL BE INTEROPERABLE WITH ONE ANOTHER AND WITH KEY EXISTING RESEARCH INFRASTRUCTURE. THE PLATFORM WILL SUPPORT SOCIAL AND BEHAVIORAL SCIENCE RESEARCHERS USING TRADITIONAL (E.G., SURVEY AND EXPERIMENTAL) AND NOVEL (E.G., DIGITAL TRACE, IMAGING) TYPES OF DATA OVER THE ENTIRE RESEARCH LIFECYCLE, FROM DATA COLLECTION TO ANALYSIS TO SHARING TO RE-DISCOVERY AND RE-ANALYSIS. THIS INFRASTRUCTURE WILL IMPROVE THE QUALITY, INTEGRITY, AND SAFETY OF DATA WHILE INCREASING ACCESSIBILITY TO DATA AND COLLABORATION BETWEEN USERS ACROSS ALL SOCIAL SCIENCE AND SOME BEHAVIORAL SCIENCE DISCIPLINES. THIS AWARD REFLECTS NSF'S STATUTORY MISSION AND HAS BEEN DEEMED WORTHY OF SUPPORT THROUGH EVALUATION USING THE FOUNDATION'S INTELLECTUAL MERIT AND BROADER IMPACTS REVIEW CRITERIA."},{"award_id":"R01DA016575","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":36879788.0,"award_type":"PROJECT GRANT (B)","description":"A COHORT-SEQUENTIAL PANAL STUDY OF DRUG USE, AGES 19-50"},{"award_id":"R01DA016575","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":36879788.0,"award_type":"PROJECT GRANT (B)","description":"A COHORT-SEQUENTIAL PANAL STUDY OF DRUG USE, AGES 19-50"},{"award_id":"R01DA016575","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":36879788.0,"award_type":"PROJECT GRANT (B)","description":"A COHORT-SEQUENTIAL PANAL STUDY OF DRUG USE, AGES 19-50"},{"award_id":"DESC0007859","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Energy","funding_agency":"Department of Energy","fiscal_year":2023,"award_amount":36674000.0,"award_type":"PROJECT GRANT (B)","description":"PROPOSAL TO STUDY THE PROPERTIES AND INTERACTIONS OF ELEMENTARY PARTICLES"},{"award_id":"DESC0007859","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Energy","funding_agency":"Department of Energy","fiscal_year":2024,"award_amount":36674000.0,"award_type":"PROJECT GRANT (B)","description":"PROPOSAL TO STUDY THE PROPERTIES AND INTERACTIONS OF ELEMENTARY PARTICLES"},{"award_id":"DESC0007859","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Energy","funding_agency":"Department of Energy","fiscal_year":2025,"award_amount":36674000.0,"award_type":"PROJECT GRANT (B)","description":"PROPOSAL TO STUDY THE PROPERTIES AND INTERACTIONS OF ELEMENTARY PARTICLES"},{"award_id":"R01HD052646","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":34928158.0,"award_type":"PROJECT GRANT (B)","description":"TRANSITIONS FROM PRESCHOOL THROUGH HIGH SCHOOL: FAMILY, SCHOOLS & NEIGHBORHOODS"},{"award_id":"R01HD052646","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":34928158.0,"award_type":"PROJECT GRANT (B)","description":"TRANSITIONS FROM PRESCHOOL THROUGH HIGH SCHOOL: FAMILY, SCHOOLS & NEIGHBORHOODS"},{"award_id":"R01HD052646","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":34928158.0,"award_type":"PROJECT GRANT (B)","description":"TRANSITIONS FROM PRESCHOOL THROUGH HIGH SCHOOL: FAMILY, SCHOOLS & NEIGHBORHOODS"},{"award_id":"U01NS099043","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":31739293.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"SLEEP FOR STROKE MANAGEMENT AND RECOVERY TRIAL (SLEEP SMART)"},{"award_id":"U01NS099043","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":31739293.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"SLEEP FOR STROKE MANAGEMENT AND RECOVERY TRIAL (SLEEP SMART)"},{"award_id":"U01NS099043","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":31739293.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"SLEEP FOR STROKE MANAGEMENT AND RECOVERY TRIAL (SLEEP SMART)"},{"award_id":"U01NS099046","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":31534277.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"BRAIN OXYGEN OPTIMIZATION IN SEVERE TRAUMATIC BRAIN INJURY - PHASE 3 (BOOST-3)"},{"award_id":"U01NS099046","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":31534277.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"BRAIN OXYGEN OPTIMIZATION IN SEVERE TRAUMATIC BRAIN INJURY - PHASE 3 (BOOST-3)"},{"award_id":"U01NS099046","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":31534277.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"BRAIN OXYGEN OPTIMIZATION IN SEVERE TRAUMATIC BRAIN INJURY - PHASE 3 (BOOST-3)"},{"award_id":"U24DE029462","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":31252186.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"MICHIGAN-PITTSBURGH-WYSS REGENERATIVE MEDICINE RESOURCE CENTER: ADVANCING DENTAL, ORAL, AND CRANIOFACIAL REGENERATION TO CLINICAL TRIAL INITIATION"},{"award_id":"U24DE029462","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":31252186.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"MICHIGAN-PITTSBURGH-WYSS REGENERATIVE MEDICINE RESOURCE CENTER: ADVANCING DENTAL, ORAL, AND CRANIOFACIAL REGENERATION TO CLINICAL TRIAL INITIATION"},{"award_id":"U24DE029462","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":31252186.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"MICHIGAN-PITTSBURGH-WYSS REGENERATIVE MEDICINE RESOURCE CENTER: ADVANCING DENTAL, ORAL, AND CRANIOFACIAL REGENERATION TO CLINICAL TRIAL INITIATION"},{"award_id":"R01AG040213","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":31227768.0,"award_type":"PROJECT GRANT (B)","description":"HEALTH, WEALTH, AND WELLBEING OVER THE LIFE COURSE AND ACROSS GENERATIONS"},{"award_id":"R01AG040213","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":31227768.0,"award_type":"PROJECT GRANT (B)","description":"HEALTH, WEALTH, AND WELLBEING OVER THE LIFE COURSE AND ACROSS GENERATIONS"},{"award_id":"R01AG040213","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":31227768.0,"award_type":"PROJECT GRANT (B)","description":"HEALTH, WEALTH, AND WELLBEING OVER THE LIFE COURSE AND ACROSS GENERATIONS"},{"award_id":"U54CA229974","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":30956258.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"CENTER FOR THE ASSESSMENT OF THE PUBLIC HEALTH IMPACT OF TOBACCO REGULATIONS"},{"award_id":"U54CA229974","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":30956258.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"CENTER FOR THE ASSESSMENT OF THE PUBLIC HEALTH IMPACT OF TOBACCO REGULATIONS"},{"award_id":"U54CA229974","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":30956258.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"CENTER FOR THE ASSESSMENT OF THE PUBLIC HEALTH IMPACT OF TOBACCO REGULATIONS"},{"award_id":"T42OH008455","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":29507358.74,"award_type":"PROJECT GRANT (B)","description":"THE UNIVERSITY OF MICHIGAN EDUCATION AND RESEARCH CENTER"},{"award_id":"T42OH008455","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":29507358.74,"award_type":"PROJECT GRANT (B)","description":"THE UNIVERSITY OF MICHIGAN EDUCATION AND RESEARCH CENTER"},{"award_id":"T42OH008455","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":29507358.74,"award_type":"PROJECT GRANT (B)","description":"THE UNIVERSITY OF MICHIGAN EDUCATION AND RESEARCH CENTER"},{"award_id":"DESC0008637","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Energy","funding_agency":"Department of Energy","fiscal_year":2023,"award_amount":28930000.0,"award_type":"PROJECT GRANT (B)","description":"SOFTWARE CENTER FOR PREDICTIVE THEORY AND MODELING"},{"award_id":"DESC0008637","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Energy","funding_agency":"Department of Energy","fiscal_year":2024,"award_amount":28930000.0,"award_type":"PROJECT GRANT (B)","description":"SOFTWARE CENTER FOR PREDICTIVE THEORY AND MODELING"},{"award_id":"DESC0008637","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Energy","funding_agency":"Department of Energy","fiscal_year":2025,"award_amount":28930000.0,"award_type":"PROJECT GRANT (B)","description":"SOFTWARE CENTER FOR PREDICTIVE THEORY AND MODELING"},{"award_id":"UM1HL120877","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":26367043.75,"award_type":"COOPERATIVE AGREEMENT (B)","description":"ANALYSIS AND CHARACTERIZATION OF TRAUMA-INDUCED COAGULOPATHY"},{"award_id":"NA22OAR4320150","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Commerce","funding_agency":"Department of Commerce","fiscal_year":2023,"award_amount":25864922.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"ACCELERATE NOAA'S MISSION IN THE GREAT LAKES BY (1) CONDUCTING PRIMARY RESEARCH NEEDED TO MEET KEY SCIENTIFIC CHALLENGES FACED IN MANAGING THE LAURENTIAN GREAT LAKES, (2) INCREASING THE IMPACTS OF RESEARCH BY FOSTERING ENGAGEMENT WITH RESOURCE MANAGERS AND DECISION-MAKERS THAT HELP TURN SCIENCE INTO ACTION, (3) PROVIDING CUTTING-EDGE CAREER TRAINING THAT PREPARES A DIVERSE AND ADAPTABLE WORKFORCE OF SOCIAL SCIENTISTS, NATURAL SCIENTISTS, ENGINEERS AND DESIGN EXPERTS TO BE THE NEXT GENERATION OF RESEARCHERS AND PRACTITIONERS ON THE GREAT LAKES, AND (4) PROMOTING PUBLIC LITERACY ABOUT THE GREAT LAKES WITH A COORDINATED OUTREACH AND COMMUNICATIONS PROGRAM ACROSS THE REGION."},{"award_id":"NA22OAR4320150","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Commerce","funding_agency":"Department of Commerce","fiscal_year":2024,"award_amount":25864922.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"ACCELERATE NOAA'S MISSION IN THE GREAT LAKES BY (1) CONDUCTING PRIMARY RESEARCH NEEDED TO MEET KEY SCIENTIFIC CHALLENGES FACED IN MANAGING THE LAURENTIAN GREAT LAKES, (2) INCREASING THE IMPACTS OF RESEARCH BY FOSTERING ENGAGEMENT WITH RESOURCE MANAGERS AND DECISION-MAKERS THAT HELP TURN SCIENCE INTO ACTION, (3) PROVIDING CUTTING-EDGE CAREER TRAINING THAT PREPARES A DIVERSE AND ADAPTABLE WORKFORCE OF SOCIAL SCIENTISTS, NATURAL SCIENTISTS, ENGINEERS AND DESIGN EXPERTS TO BE THE NEXT GENERATION OF RESEARCHERS AND PRACTITIONERS ON THE GREAT LAKES, AND (4) PROMOTING PUBLIC LITERACY ABOUT THE GREAT LAKES WITH A COORDINATED OUTREACH AND COMMUNICATIONS PROGRAM ACROSS THE REGION."},{"award_id":"NA22OAR4320150","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Commerce","funding_agency":"Department of Commerce","fiscal_year":2025,"award_amount":25864922.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"ACCELERATE NOAA'S MISSION IN THE GREAT LAKES BY (1) CONDUCTING PRIMARY RESEARCH NEEDED TO MEET KEY SCIENTIFIC CHALLENGES FACED IN MANAGING THE LAURENTIAN GREAT LAKES, (2) INCREASING THE IMPACTS OF RESEARCH BY FOSTERING ENGAGEMENT WITH RESOURCE MANAGERS AND DECISION-MAKERS THAT HELP TURN SCIENCE INTO ACTION, (3) PROVIDING CUTTING-EDGE CAREER TRAINING THAT PREPARES A DIVERSE AND ADAPTABLE WORKFORCE OF SOCIAL SCIENTISTS, NATURAL SCIENTISTS, ENGINEERS AND DESIGN EXPERTS TO BE THE NEXT GENERATION OF RESEARCHERS AND PRACTITIONERS ON THE GREAT LAKES, AND (4) PROMOTING PUBLIC LITERACY ABOUT THE GREAT LAKES WITH A COORDINATED OUTREACH AND COMMUNICATIONS PROGRAM ACROSS THE REGION."},{"award_id":"DENA0003920","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Energy","funding_agency":"Department of Energy","fiscal_year":2023,"award_amount":25000000.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"UNIVERSITY OF MICHIGAN \n\nPROJECT: CONSORTIUM FOR MONITORING, TECHNOLOGY, AND VERIFICATION.\nBASE MOD FULLY FUNDS YEAR 1 OF THE BUDGET."},{"award_id":"DENA0003920","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Energy","funding_agency":"Department of Energy","fiscal_year":2024,"award_amount":25000000.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"UNIVERSITY OF MICHIGAN \n\nPROJECT: CONSORTIUM FOR MONITORING, TECHNOLOGY, AND VERIFICATION.\nBASE MOD FULLY FUNDS YEAR 1 OF THE BUDGET."},{"award_id":"T32GM007863","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":24806257.0,"award_type":"PROJECT GRANT (B)","description":"MICHIGAN MEDICAL SCIENTIST TRAINING PROGRAM"},{"award_id":"T32GM007863","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":24806257.0,"award_type":"PROJECT GRANT (B)","description":"MICHIGAN MEDICAL SCIENTIST TRAINING PROGRAM"},{"award_id":"NA17OAR4320152","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Commerce","funding_agency":"Department of Commerce","fiscal_year":2023,"award_amount":24666440.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"THE COOPERATIVE INSTITUTE FOR GREAT LAKES RESEARCH (CIGLR): A PROPOSAL TO THE OFFICE OF OCEANIC AND ATMOSPHERIC RESEARCH, NOAA, FOR A NEW REGIONAL RE"},{"award_id":"NA17OAR4320152","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Commerce","funding_agency":"Department of Commerce","fiscal_year":2024,"award_amount":24666440.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"THE COOPERATIVE INSTITUTE FOR GREAT LAKES RESEARCH (CIGLR): A PROPOSAL TO THE OFFICE OF OCEANIC AND ATMOSPHERIC RESEARCH, NOAA, FOR A NEW REGIONAL RE"},{"award_id":"UH3HL145269","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":24577614.35,"award_type":"COOPERATIVE AGREEMENT (B)","description":"1/2 ICECAP: INFLUENCE OF COOLING DURATION ON EFFICACY IN CARDIAC ARREST PATIENTS"},{"award_id":"UH3HL145269","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":24577614.35,"award_type":"COOPERATIVE AGREEMENT (B)","description":"1/2 ICECAP: INFLUENCE OF COOLING DURATION ON EFFICACY IN CARDIAC ARREST PATIENTS"},{"award_id":"UH3HL145269","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":24577614.35,"award_type":"COOPERATIVE AGREEMENT (B)","description":"1/2 ICECAP: INFLUENCE OF COOLING DURATION ON EFFICACY IN CARDIAC ARREST PATIENTS"},{"award_id":"P01CA093900","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":23799725.0,"award_type":"PROJECT GRANT (B)","description":"THE BIOLOGY OF PROSTATE CANCER SKELETAL METASTASES"},{"award_id":"P01CA093900","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":23799725.0,"award_type":"PROJECT GRANT (B)","description":"THE BIOLOGY OF PROSTATE CANCER SKELETAL METASTASES"},{"award_id":"P01CA093900","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":23799725.0,"award_type":"PROJECT GRANT (B)","description":"THE BIOLOGY OF PROSTATE CANCER SKELETAL METASTASES"},{"award_id":"P50CA186786","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":22992291.0,"award_type":"PROJECT GRANT (B)","description":"SPORE IN PROSTATE CANCER"},{"award_id":"P50CA186786","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2024,"award_amount":22992291.0,"award_type":"PROJECT GRANT (B)","description":"SPORE IN PROSTATE CANCER"},{"award_id":"P50CA186786","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2025,"award_amount":22992291.0,"award_type":"PROJECT GRANT (B)","description":"SPORE IN PROSTATE CANCER"},{"award_id":"U01DA041106","recipient_name":"REGENTS OF THE UNIVERSITY OF MICHIGAN","awarding_agency":"Department of Health and Human Services","funding_agency":"Department of Health and Human Services","fiscal_year":2023,"award_amount":22822404.0,"award_type":"COOPERATIVE AGREEMENT (B)","description":"ABCD-USA CONSORTIUM: RESEARCH PROJECT"}];
        }

        function applyGrantsFilters() {
            var selectedInsts = getSelectedInstitutions();
            var piFilter = (document.getElementById('grants-filter-pi') ? document.getElementById('grants-filter-pi').value : '').toLowerCase();
            var fyFilter = document.getElementById('grants-filter-fy') ? document.getElementById('grants-filter-fy').value : 'all';
            var typeFilter = document.getElementById('grants-filter-type') ? document.getElementById('grants-filter-type').value : 'all';
            var kwFilter = (document.getElementById('grants-filter-keyword') ? document.getElementById('grants-filter-keyword').value : '').toLowerCase();
            var minAmt = parseFloat(document.getElementById('grants-filter-min') ? document.getElementById('grants-filter-min').value : '') || 0;
            var maxAmt = parseFloat(document.getElementById('grants-filter-max') ? document.getElementById('grants-filter-max').value : '') || Infinity;

            grantsFiltered.nih = grantsNIHData.filter(function(r) {
                var instId = nihOrgToInstId(r.org_name);
                if (instId && !selectedInsts.includes(instId)) return false;
                if (piFilter && !(r.pi_name || '').toLowerCase().includes(piFilter)) return false;
                if (fyFilter !== 'all' && String(r.fiscal_year) !== fyFilter) return false;
                if (typeFilter !== 'all' && r.activity_code !== typeFilter) return false;
                if (kwFilter) {
                    var text = ((r.project_title || '') + ' ' + (r.abstract || '')).toLowerCase();
                    if (!text.includes(kwFilter)) return false;
                }
                if (r.award_amount < minAmt || r.award_amount > maxAmt) return false;
                return true;
            });

            grantsFiltered.usa = grantsUSAData.filter(function(r) {
                var instId = usaRecipientToInstId(r.recipient_name);
                if (instId && !selectedInsts.includes(instId)) return false;
                if (piFilter && !(r.pi_name || '').toLowerCase().includes(piFilter)) return false;
                if (fyFilter !== 'all' && String(r.fiscal_year) !== fyFilter) return false;
                if (typeFilter !== 'all' && r.award_type !== typeFilter) return false;
                if (kwFilter) {
                    var text = ((r.description || '') + ' ' + (r.recipient_name || '')).toLowerCase();
                    if (!text.includes(kwFilter)) return false;
                }
                if ((r.award_amount || 0) < minAmt || (r.award_amount || 0) > maxAmt) return false;
                return true;
            });

            updateGrantsView();
        }

        function resetGrantsFilters() {
            document.getElementById('grants-filter-pi').value = '';
            document.getElementById('grants-filter-fy').value = 'all';
            document.getElementById('grants-filter-type').value = 'all';
            document.getElementById('grants-filter-keyword').value = '';
            document.getElementById('grants-filter-min').value = '';
            document.getElementById('grants-filter-max').value = '';
            document.querySelectorAll('#institution-checkboxes input[type="checkbox"]').forEach(function(cb) {
                cb.checked = (cb.value === 'umich');
            });
            var btn = document.querySelector('.institution-toggle-link');
            if (btn) btn.textContent = 'Select All';
            applyGrantsFilters();
        }

        function updateGrantsView() {
            var nih = grantsFiltered.nih;
            var usa = grantsFiltered.usa;
            var allRecords = nih.concat(usa);

            var totalAwards = nih.length + usa.length;
            var totalAmount = nih.reduce(function(s,r) { return s + (r.award_amount || 0); }, 0) + usa.reduce(function(s,r) { return s + (r.award_amount || 0); }, 0);
            var allPIs = new Set();
            nih.forEach(function(r) { if (r.pi_name) allPIs.add(r.pi_name); });
            usa.forEach(function(r) { if (r.pi_name) allPIs.add(r.pi_name); });

            var sourceCounts = {};
            nih.forEach(function(r) { var src = r.nih_institute || 'Unknown'; sourceCounts[src] = (sourceCounts[src] || 0) + (r.award_amount || 0); });
            usa.forEach(function(r) { var src = r.funding_agency || r.awarding_agency || 'Unknown'; sourceCounts[src] = (sourceCounts[src] || 0) + (r.award_amount || 0); });
            var topSource = Object.entries(sourceCounts).sort(function(a,b) { return b[1] - a[1]; })[0];

            var fy2024Amt = allRecords.filter(function(r) { return r.fiscal_year === 2024; }).reduce(function(s,r) { return s + (r.award_amount || 0); }, 0);
            var fy2025Amt = allRecords.filter(function(r) { return r.fiscal_year === 2025; }).reduce(function(s,r) { return s + (r.award_amount || 0); }, 0);
            var yoyPct = fy2024Amt > 0 ? ((fy2025Amt - fy2024Amt) / fy2024Amt * 100) : 0;

            document.getElementById('kpi-grants-total').textContent = totalAwards.toLocaleString();
            document.getElementById('kpi-grants-amount').textContent = formatCurrency(totalAmount);
            document.getElementById('kpi-grants-pis').textContent = allPIs.size.toLocaleString();
            document.getElementById('kpi-grants-top-source').textContent = topSource ? topSource[0] : '--';
            document.getElementById('kpi-grants-top-source-sub').textContent = topSource ? formatCurrency(topSource[1]) : '--';
            document.getElementById('kpi-grants-yoy').textContent = (yoyPct >= 0 ? '+' : '') + yoyPct.toFixed(1) + '%';

            var typeSelect = document.getElementById('grants-filter-type');
            var currentType = typeSelect.value;
            var allTypes = new Set();
            grantsNIHData.forEach(function(r) { if (r.activity_code) allTypes.add(r.activity_code); });
            grantsUSAData.forEach(function(r) { if (r.award_type) allTypes.add(r.award_type); });
            typeSelect.innerHTML = '<option value="all">All Types</option>';
            Array.from(allTypes).sort().forEach(function(t) {
                var opt = document.createElement('option');
                opt.value = t; opt.textContent = t;
                typeSelect.appendChild(opt);
            });
            typeSelect.value = currentType;

            renderNIHTable(nih);
            renderUSATable(usa);
            renderCombinedView(nih, usa);
            renderGrantsCharts(nih, usa);
        }

        function renderNIHTable(data) {
            var tbody = document.getElementById('nih-grants-tbody');
            tbody.innerHTML = '';
            document.getElementById('nih-table-badge').textContent = data.length + ' Records';
            data.sort(function(a,b) {
                if ((b.fiscal_year || 0) !== (a.fiscal_year || 0)) return (b.fiscal_year || 0) - (a.fiscal_year || 0);
                return (b.award_amount || 0) - (a.award_amount || 0);
            });
            data.forEach(function(r) {
                var row = document.createElement('tr');
                var title = (r.project_title || '').replace(/"/g, '&quot;');
                row.innerHTML = '<td><span class="servicenow-ticket" style="font-size:11px;">' + (r.project_num || '') + '</span></td>' +
                    '<td style="min-width:300px;max-width:350px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="' + title + '">' + (r.project_title || '') + '</td>' +
                    '<td style="white-space:nowrap;">' + (r.pi_name || '') + '</td>' +
                    '<td style="font-size:11px;">' + (r.org_name || '') + '</td>' +
                    '<td>' + (r.fiscal_year || '') + '</td>' +
                    '<td class="text-right" style="min-width:110px;font-variant-numeric:tabular-nums;">' + formatCurrency(r.award_amount || 0) + '</td>' +
                    '<td><span class="audience-badge ops" style="font-size:10px;padding:2px 8px;">' + (r.nih_institute || '') + '</span></td>' +
                    '<td>' + (r.activity_code || '') + '</td>' +
                    '<td style="font-size:11px;">' + (r.project_start || '') + '</td>' +
                    '<td style="font-size:11px;">' + (r.project_end || '') + '</td>';
                tbody.appendChild(row);
            });
        }

        function renderUSATable(data) {
            var tbody = document.getElementById('usa-grants-tbody');
            tbody.innerHTML = '';
            document.getElementById('usa-table-badge').textContent = data.length + ' Records';
            data.sort(function(a,b) {
                if ((b.fiscal_year || 0) !== (a.fiscal_year || 0)) return (b.fiscal_year || 0) - (a.fiscal_year || 0);
                return (b.award_amount || 0) - (a.award_amount || 0);
            });
            data.forEach(function(r) {
                var desc = (r.description || '').replace(/"/g, '&quot;');
                var row = document.createElement('tr');
                row.innerHTML = '<td><span class="servicenow-ticket" style="font-size:10px;">' + (r.award_id || '') + '</span></td>' +
                    '<td style="font-size:11px;">' + (r.recipient_name || '') + '</td>' +
                    '<td style="font-size:11px;">' + (r.awarding_agency || '') + '</td>' +
                    '<td style="font-size:11px;">' + (r.funding_agency || '') + '</td>' +
                    '<td>' + (r.fiscal_year || '') + '</td>' +
                    '<td class="text-right" style="min-width:110px;font-variant-numeric:tabular-nums;">' + formatCurrency(r.award_amount || 0) + '</td>' +
                    '<td>' + (r.award_type || '') + '</td>' +
                    '<td style="min-width:250px;max-width:300px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="' + desc + '">' + (r.description || '') + '</td>';
                tbody.appendChild(row);
            });
        }

        function renderCombinedView(nihData, usaData) {
            var matches = [];
            var matchedNIH = new Set();
            var matchedUSA = new Set();

            nihData.forEach(function(nih, ni) {
                if (matchedNIH.has(ni)) return;
                var nihInstId = nihOrgToInstId(nih.org_name);
                var nihWords = ((nih.project_title || '') + ' ' + (nih.abstract || '')).toLowerCase().split(/\W+/).filter(function(w) { return w.length > 3; });
                var bestMatch = null;
                var bestScore = 0;
                var bestUi = -1;

                usaData.forEach(function(usa, ui) {
                    if (matchedUSA.has(ui)) return;
                    var usaInstId = usaRecipientToInstId(usa.recipient_name);

                    var score = 0;
                    if (nihInstId && usaInstId && nihInstId === usaInstId) score++;
                    if (nih.fiscal_year && usa.fiscal_year && nih.fiscal_year === usa.fiscal_year) score++;
                    if (nih.award_amount > 0 && usa.award_amount > 0) {
                        var ratio = Math.min(nih.award_amount, usa.award_amount) / Math.max(nih.award_amount, usa.award_amount);
                        if (ratio >= 0.8) score++;
                    }
                    var usaWords = ((usa.description || '') + ' ' + (usa.recipient_name || '')).toLowerCase().split(/\W+/).filter(function(w) { return w.length > 3; });
                    var overlap = nihWords.filter(function(w) { return usaWords.includes(w); });
                    if (overlap.length >= 2) score++;

                    if (score > bestScore && score >= 3) {
                        bestScore = score;
                        bestMatch = usa;
                        bestUi = ui;
                    }
                });

                if (bestMatch && bestScore >= 3) {
                    var confidence = bestScore >= 4 ? 'High' : 'Medium';
                    matches.push({ nih: nih, usa: bestMatch, confidence: confidence, score: bestScore, nihIdx: ni, usaIdx: bestUi, instId: nihInstId });
                    matchedNIH.add(ni);
                    matchedUSA.add(bestUi);
                }
            });

            var tbody = document.getElementById('combined-grants-tbody');
            tbody.innerHTML = '';
            document.getElementById('combined-table-badge').textContent = matches.length + ' Matches';
            matches.sort(function(a,b) { return b.score - a.score; }).forEach(function(m) {
                var instObj = GRANT_INSTITUTIONS.find(function(i) { return i.id === m.instId; });
                var instName = instObj ? instObj.name : 'Unknown';
                var confClass = m.confidence === 'High' ? 'confidence-high' : m.confidence === 'Medium' ? 'confidence-medium' : 'confidence-low';
                var row = document.createElement('tr');
                row.innerHTML = '<td><span class="servicenow-ticket" style="font-size:10px;">' + (m.nih.project_num || '') + '</span></td>' +
                    '<td><span class="servicenow-ticket" style="font-size:10px;">' + (m.usa.award_id || '') + '</span></td>' +
                    '<td style="font-size:11px;">' + instName + '</td>' +
                    '<td>' + (m.nih.pi_name || '') + '</td>' +
                    '<td>' + (m.nih.fiscal_year || '') + '</td>' +
                    '<td class="text-right">' + formatCurrency(m.nih.award_amount || 0) + '</td>' +
                    '<td class="text-right">' + formatCurrency(m.usa.award_amount || 0) + '</td>' +
                    '<td><span class="confidence-badge ' + confClass + '">' + m.confidence + '</span></td>';
                tbody.appendChild(row);
            });

            var unmatchedNIHTbody = document.getElementById('unmatched-nih-tbody');
            unmatchedNIHTbody.innerHTML = '';
            var unmatchedNIHCount = 0;
            nihData.forEach(function(r, i) {
                if (matchedNIH.has(i)) return;
                unmatchedNIHCount++;
                var row = document.createElement('tr');
                row.innerHTML = '<td style="font-size:11px;">' + (r.project_num || '') + '</td><td style="font-size:11px;">' + (r.pi_name || '') + '</td><td style="font-size:11px;">' + (r.org_name || '') + '</td><td>' + (r.fiscal_year || '') + '</td><td class="text-right">' + formatCurrency(r.award_amount || 0) + '</td>';
                unmatchedNIHTbody.appendChild(row);
            });

            var unmatchedUSATbody = document.getElementById('unmatched-usa-tbody');
            unmatchedUSATbody.innerHTML = '';
            var unmatchedUSACount = 0;
            usaData.forEach(function(r, i) {
                if (matchedUSA.has(i)) return;
                unmatchedUSACount++;
                var row = document.createElement('tr');
                row.innerHTML = '<td style="font-size:11px;">' + (r.award_id || '') + '</td><td style="font-size:11px;">' + (r.recipient_name || '') + '</td><td style="font-size:11px;">' + (r.awarding_agency || '') + '</td><td>' + (r.fiscal_year || '') + '</td><td class="text-right">' + formatCurrency(r.award_amount || 0) + '</td>';
                unmatchedUSATbody.appendChild(row);
            });
            document.getElementById('unmatched-badge').textContent = (unmatchedNIHCount + unmatchedUSACount).toString();

            var crossTbody = document.getElementById('cross-institution-tbody');
            crossTbody.innerHTML = '';
            GRANT_INSTITUTIONS.forEach(function(inst) {
                var instNIH = nihData.filter(function(r) { return nihOrgToInstId(r.org_name) === inst.id; });
                var instUSA = usaData.filter(function(r) { return usaRecipientToInstId(r.recipient_name) === inst.id; });
                var nihTotal = instNIH.reduce(function(s,r) { return s + (r.award_amount || 0); }, 0);
                var usaTotal = instUSA.reduce(function(s,r) { return s + (r.award_amount || 0); }, 0);
                var instMatches = matches.filter(function(m) { return m.instId === inst.id; }).length;
                if (instNIH.length === 0 && instUSA.length === 0) return;
                var row = document.createElement('tr');
                row.innerHTML = '<td><strong>' + inst.name + '</strong></td><td class="text-right">' + instNIH.length + '</td><td class="text-right">' + formatCurrency(nihTotal) + '</td><td class="text-right">' + instUSA.length + '</td><td class="text-right">' + formatCurrency(usaTotal) + '</td><td class="text-right"><strong>' + formatCurrency(nihTotal + usaTotal) + '</strong></td><td>' + instMatches + ' matched</td>';
                crossTbody.appendChild(row);
            });
        }

        function renderGrantsCharts(nihData, usaData) {
            var chartColors = ['#00274C','#FFCB05','#2F65A7','#00B2A9','#9A3324','#CFC096','#75988D','#1565C0','#E65100','#6A1B9A'];

            var ctx1 = document.getElementById('grantsInstitutionChart');
            if (ctx1) {
                if (charts.grantsInstitution) charts.grantsInstitution.destroy();
                var instLabels = [], nihCounts = [], usaCounts = [], nihBgColors = [], usaBgColors = [];
                GRANT_INSTITUTIONS.forEach(function(inst) {
                    var nc = nihData.filter(function(r) { return nihOrgToInstId(r.org_name) === inst.id; }).length;
                    var uc = usaData.filter(function(r) { return usaRecipientToInstId(r.recipient_name) === inst.id; }).length;
                    if (nc > 0 || uc > 0) {
                        instLabels.push(inst.name);
                        nihCounts.push(nc);
                        usaCounts.push(uc);
                        nihBgColors.push(inst.id === 'umich' ? '#FFCB05' : '#B0C4DE');
                        usaBgColors.push(inst.id === 'umich' ? '#00274C' : '#C8D6E5');
                    }
                });
                charts.grantsInstitution = new Chart(ctx1, { type: 'bar', data: { labels: instLabels, datasets: [{ label: 'NIH', data: nihCounts, backgroundColor: nihBgColors }, { label: 'USAspending', data: usaCounts, backgroundColor: usaBgColors }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, scales: { y: { beginAtZero: true } } } });
            }

            var ctx2 = document.getElementById('grantsTrendChart');
            if (ctx2) {
                if (charts.grantsTrend) charts.grantsTrend.destroy();
                var years = [2023, 2024, 2025];
                var nihAmts = years.map(function(y) { return nihData.filter(function(r) { return r.fiscal_year === y; }).reduce(function(s,r) { return s + (r.award_amount || 0); }, 0); });
                var usaAmts = years.map(function(y) { return usaData.filter(function(r) { return r.fiscal_year === y; }).reduce(function(s,r) { return s + (r.award_amount || 0); }, 0); });
                charts.grantsTrend = new Chart(ctx2, { type: 'bar', data: { labels: years.map(String), datasets: [{ label: 'NIH', data: nihAmts, backgroundColor: '#00274C' }, { label: 'USAspending', data: usaAmts, backgroundColor: '#FFCB05' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } }, scales: { y: { beginAtZero: true, ticks: { callback: function(v) { return '$' + (v/1000000).toFixed(1) + 'M'; } } } } } });
            }

            var ctx3 = document.getElementById('grantsTopPIsChart');
            if (ctx3) {
                if (charts.grantsTopPIs) charts.grantsTopPIs.destroy();
                var piTotals = {};
                nihData.forEach(function(r) { if (r.pi_name) piTotals[r.pi_name] = (piTotals[r.pi_name] || 0) + (r.award_amount || 0); });
                usaData.forEach(function(r) { if (r.pi_name) piTotals[r.pi_name] = (piTotals[r.pi_name] || 0) + (r.award_amount || 0); });
                var topPIs = Object.entries(piTotals).sort(function(a,b) { return b[1] - a[1]; }).slice(0, 10);
                charts.grantsTopPIs = new Chart(ctx3, { type: 'bar', data: { labels: topPIs.map(function(p) { return p[0]; }), datasets: [{ label: 'Total Funding', data: topPIs.map(function(p) { return p[1]; }), backgroundColor: chartColors }] }, options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { beginAtZero: true, ticks: { callback: function(v) { return '$' + (v/1000000).toFixed(1) + 'M'; } } } } } });
            }

            var ctx4 = document.getElementById('grantsAgenciesChart');
            if (ctx4) {
                if (charts.grantsAgencies) charts.grantsAgencies.destroy();
                var agencyTotals = {};
                nihData.forEach(function(r) { var a = r.nih_institute || 'Unknown'; agencyTotals[a] = (agencyTotals[a] || 0) + (r.award_amount || 0); });
                usaData.forEach(function(r) { var a = r.funding_agency || r.awarding_agency || 'Unknown'; agencyTotals[a] = (agencyTotals[a] || 0) + (r.award_amount || 0); });
                var topAgencies = Object.entries(agencyTotals).sort(function(a,b) { return b[1] - a[1]; }).slice(0, 10);
                charts.grantsAgencies = new Chart(ctx4, { type: 'bar', data: { labels: topAgencies.map(function(a) { return a[0]; }), datasets: [{ label: 'Total Funding', data: topAgencies.map(function(a) { return a[1]; }), backgroundColor: chartColors }] }, options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { beginAtZero: true, ticks: { callback: function(v) { return '$' + (v/1000000).toFixed(1) + 'M'; } } } } } });
            }

            var ctx5 = document.getElementById('grantsTypeChart');
            if (ctx5) {
                if (charts.grantsType) charts.grantsType.destroy();
                var typeCounts = {};
                nihData.forEach(function(r) { var t = r.activity_code || 'Unknown'; typeCounts[t] = (typeCounts[t] || 0) + 1; });
                usaData.forEach(function(r) { var t = r.award_type || 'Unknown'; typeCounts[t] = (typeCounts[t] || 0) + 1; });
                var typeEntries = Object.entries(typeCounts).sort(function(a,b) { return b[1] - a[1]; });
                charts.grantsType = new Chart(ctx5, { type: 'doughnut', data: { labels: typeEntries.map(function(t) { return t[0]; }), datasets: [{ data: typeEntries.map(function(t) { return t[1]; }), backgroundColor: chartColors, borderWidth: 2, borderColor: '#fff' }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } } });
            }
        }

        function showGrantsSubTab(tabId, btn) {
            document.querySelectorAll('#page-grants .sub-tab-content').forEach(function(c) { c.classList.remove('active'); });
            document.querySelectorAll('#page-grants .sub-tab').forEach(function(t) { t.classList.remove('active'); });
            document.getElementById('grants-subtab-' + tabId).classList.add('active');
            if (btn) btn.classList.add('active');
        }

        function toggleGrantsMode() {
            grantsLiveMode = document.getElementById('grants-live-toggle').checked;
            loadGrantsData();
        }

        function exportGrantsCSV() {
            var nih = grantsFiltered.nih;
            var usa = grantsFiltered.usa;
            var csv = 'Source,ID,Title/Description,PI,Organization,FiscalYear,Amount,Institute/Agency,Type\n';
            nih.forEach(function(r) {
                csv += 'NIH,"' + (r.project_num || '') + '","' + (r.project_title || '').replace(/"/g, '""') + '","' + (r.pi_name || '') + '","' + (r.org_name || '') + '",' + (r.fiscal_year || '') + ',' + (r.award_amount || 0) + ',"' + (r.nih_institute || '') + '","' + (r.activity_code || '') + '"\n';
            });
            usa.forEach(function(r) {
                csv += 'USAspending,"' + (r.award_id || '') + '","' + (r.description || '').replace(/"/g, '""') + '","' + (r.pi_name || '') + '","' + (r.recipient_name || '') + '",' + (r.fiscal_year || '') + ',' + (r.award_amount || 0) + ',"' + (r.funding_agency || '') + '","' + (r.award_type || '') + '"\n';
            });
            var blob = new Blob([csv], { type: 'text/csv' });
            var url = URL.createObjectURL(blob);
            var a = document.createElement('a');
            a.href = url;
            a.download = 'research_grants_export_' + new Date().toISOString().split('T')[0] + '.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        function updateGrantsView_init() {
            buildInstitutionCheckboxes();
            loadGrantsData();
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            const loading = document.getElementById('loading-overlay');
            loading.style.display = 'flex';

            setTimeout(() => {
                const now = new Date();
                document.getElementById('currentDate').textContent = now.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
                document.getElementById('lastSyncTime').textContent = now.toLocaleString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
                document.getElementById('approvalDate').textContent = new Date(now - 2 * 86400000).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });

                populateFilters();
                updateNavigation();
                showDefaultPage();

                loading.style.display = 'none';
            }, 300);
        });
    </script>
</body>
</html>
